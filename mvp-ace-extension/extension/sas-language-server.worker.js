var e={20:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NotebookDocuments=t.NotebookSyncFeature=void 0;const o=n(4512),i=n(1662);t.NotebookSyncFeature=e=>class extends e{get synchronization(){return{onDidOpenNotebookDocument:e=>this.connection.onNotification(o.DidOpenNotebookDocumentNotification.type,t=>{e(t)}),onDidChangeNotebookDocument:e=>this.connection.onNotification(o.DidChangeNotebookDocumentNotification.type,t=>{e(t)}),onDidSaveNotebookDocument:e=>this.connection.onNotification(o.DidSaveNotebookDocumentNotification.type,t=>{e(t)}),onDidCloseNotebookDocument:e=>this.connection.onNotification(o.DidCloseNotebookDocumentNotification.type,t=>{e(t)})}}};class s{onDidOpenTextDocument(e){return this.openHandler=e,o.Disposable.create(()=>{this.openHandler=void 0})}openTextDocument(e){this.openHandler&&this.openHandler(e)}onDidChangeTextDocument(e){return this.changeHandler=e,o.Disposable.create(()=>{this.changeHandler=e})}changeTextDocument(e){this.changeHandler&&this.changeHandler(e)}onDidCloseTextDocument(e){return this.closeHandler=e,o.Disposable.create(()=>{this.closeHandler=void 0})}closeTextDocument(e){this.closeHandler&&this.closeHandler(e)}onWillSaveTextDocument(){return s.NULL_DISPOSE}onWillSaveTextDocumentWaitUntil(){return s.NULL_DISPOSE}onDidSaveTextDocument(){return s.NULL_DISPOSE}}s.NULL_DISPOSE=Object.freeze({dispose:()=>{}}),t.NotebookDocuments=class{constructor(e){e instanceof i.TextDocuments?this._cellTextDocuments=e:this._cellTextDocuments=new i.TextDocuments(e),this.notebookDocuments=new Map,this.notebookCellMap=new Map,this._onDidOpen=new o.Emitter,this._onDidChange=new o.Emitter,this._onDidSave=new o.Emitter,this._onDidClose=new o.Emitter}get cellTextDocuments(){return this._cellTextDocuments}getCellTextDocument(e){return this._cellTextDocuments.get(e.document)}getNotebookDocument(e){return this.notebookDocuments.get(e)}getNotebookCell(e){const t=this.notebookCellMap.get(e);return t&&t[0]}findNotebookDocumentForCell(e){const t="string"==typeof e?e:e.document,n=this.notebookCellMap.get(t);return n&&n[1]}get onDidOpen(){return this._onDidOpen.event}get onDidSave(){return this._onDidSave.event}get onDidChange(){return this._onDidChange.event}get onDidClose(){return this._onDidClose.event}listen(e){const t=new s,n=[];return n.push(this.cellTextDocuments.listen(t)),n.push(e.notebooks.synchronization.onDidOpenNotebookDocument(e=>{this.notebookDocuments.set(e.notebookDocument.uri,e.notebookDocument);for(const n of e.cellTextDocuments)t.openTextDocument({textDocument:n});this.updateCellMap(e.notebookDocument),this._onDidOpen.fire(e.notebookDocument)})),n.push(e.notebooks.synchronization.onDidChangeNotebookDocument(e=>{const n=this.notebookDocuments.get(e.notebookDocument.uri);if(void 0===n)return;n.version=e.notebookDocument.version;const o=n.metadata;let i=!1;const s=e.change;void 0!==s.metadata&&(i=!0,n.metadata=s.metadata);const r=[],a=[],c=[],l=[];if(void 0!==s.cells){const e=s.cells;if(void 0!==e.structure){const o=e.structure.array;if(n.cells.splice(o.start,o.deleteCount,...void 0!==o.cells?o.cells:[]),void 0!==e.structure.didOpen)for(const n of e.structure.didOpen)t.openTextDocument({textDocument:n}),r.push(n.uri);if(e.structure.didClose)for(const n of e.structure.didClose)t.closeTextDocument({textDocument:n}),a.push(n.uri)}if(void 0!==e.data){const t=new Map(e.data.map(e=>[e.document,e]));for(let e=0;e<=n.cells.length;e++){const o=t.get(n.cells[e].document);if(void 0!==o){const i=n.cells.splice(e,1,o);if(c.push({old:i[0],new:o}),t.delete(o.document),0===t.size)break}}}if(void 0!==e.textContent)for(const n of e.textContent)t.changeTextDocument({textDocument:n.document,contentChanges:n.changes}),l.push(n.document.uri)}this.updateCellMap(n);const u={notebookDocument:n};i&&(u.metadata={old:o,new:n.metadata});const h=[];for(const e of r)h.push(this.getNotebookCell(e));const d=[];for(const e of a)d.push(this.getNotebookCell(e));const p=[];for(const e of l)p.push(this.getNotebookCell(e));(h.length>0||d.length>0||c.length>0||p.length>0)&&(u.cells={added:h,removed:d,changed:{data:c,textContent:p}}),void 0===u.metadata&&void 0===u.cells||this._onDidChange.fire(u)})),n.push(e.notebooks.synchronization.onDidSaveNotebookDocument(e=>{const t=this.notebookDocuments.get(e.notebookDocument.uri);void 0!==t&&this._onDidSave.fire(t)})),n.push(e.notebooks.synchronization.onDidCloseNotebookDocument(e=>{const n=this.notebookDocuments.get(e.notebookDocument.uri);if(void 0!==n){this._onDidClose.fire(n);for(const n of e.cellTextDocuments)t.closeTextDocument({textDocument:n});this.notebookDocuments.delete(e.notebookDocument.uri);for(const e of n.cells)this.notebookCellMap.delete(e.document)}})),o.Disposable.create(()=>{n.forEach(e=>e.dispose())})}updateCellMap(e){for(const t of e.cells)this.notebookCellMap.set(t.document,[t,e])}}},372:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProtocolNotificationType=t.ProtocolNotificationType0=t.ProtocolRequestType=t.ProtocolRequestType0=t.RegistrationType=t.MessageDirection=void 0;const o=n(6439);var i;!function(e){e.clientToServer="clientToServer",e.serverToClient="serverToClient",e.both="both"}(i||(t.MessageDirection=i={})),t.RegistrationType=class{constructor(e){this.method=e}};class s extends o.RequestType0{constructor(e){super(e)}}t.ProtocolRequestType0=s;class r extends o.RequestType{constructor(e){super(e,o.ParameterStructures.byName)}}t.ProtocolRequestType=r;class a extends o.NotificationType0{constructor(e){super(e)}}t.ProtocolNotificationType0=a;class c extends o.NotificationType{constructor(e){super(e,o.ParameterStructures.byName)}}t.ProtocolNotificationType=c},493:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagnosticFeature=void 0;const o=n(4512);t.DiagnosticFeature=e=>class extends e{get diagnostics(){return{refresh:()=>this.connection.sendRequest(o.DiagnosticRefreshRequest.type),on:e=>this.connection.onRequest(o.DocumentDiagnosticRequest.type,(t,n)=>e(t,n,this.attachWorkDoneProgress(t),this.attachPartialResultProgress(o.DocumentDiagnosticRequest.partialResult,t))),onWorkspace:e=>this.connection.onRequest(o.WorkspaceDiagnosticRequest.type,(t,n)=>e(t,n,this.attachWorkDoneProgress(t),this.attachPartialResultProgress(o.WorkspaceDiagnosticRequest.partialResult,t)))}}}},577:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageConnection=t.ConnectionOptions=t.MessageStrategy=t.CancellationStrategy=t.CancellationSenderStrategy=t.CancellationReceiverStrategy=t.RequestCancellationReceiverStrategy=t.IdCancellationReceiverStrategy=t.ConnectionStrategy=t.ConnectionError=t.ConnectionErrors=t.LogTraceNotification=t.SetTraceNotification=t.TraceFormat=t.TraceValues=t.Trace=t.NullLogger=t.ProgressType=t.ProgressToken=void 0;const o=n(9590),i=n(8585),s=n(6177),r=n(3352),a=n(2676),c=n(9850);var l,u,h,d,p,m,_,g,f,T,S,E,y,O,P,C,R,k,D;!function(e){e.type=new s.NotificationType("$/cancelRequest")}(l||(l={})),function(e){e.is=function(e){return"string"==typeof e||"number"==typeof e}}(u||(t.ProgressToken=u={})),function(e){e.type=new s.NotificationType("$/progress")}(h||(h={})),t.ProgressType=class{constructor(){}},function(e){e.is=function(e){return i.func(e)}}(d||(d={})),t.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}}),function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Compact=2]="Compact",e[e.Verbose=3]="Verbose"}(p||(t.Trace=p={})),function(e){e.Off="off",e.Messages="messages",e.Compact="compact",e.Verbose="verbose"}(m||(t.TraceValues=m={})),function(e){e.fromString=function(t){if(!i.string(t))return e.Off;switch(t=t.toLowerCase()){case"off":default:return e.Off;case"messages":return e.Messages;case"compact":return e.Compact;case"verbose":return e.Verbose}},e.toString=function(t){switch(t){case e.Off:return"off";case e.Messages:return"messages";case e.Compact:return"compact";case e.Verbose:return"verbose";default:return"off"}}}(p||(t.Trace=p={})),function(e){e.Text="text",e.JSON="json"}(_||(t.TraceFormat=_={})),function(e){e.fromString=function(t){return i.string(t)&&"json"===(t=t.toLowerCase())?e.JSON:e.Text}}(_||(t.TraceFormat=_={})),function(e){e.type=new s.NotificationType("$/setTrace")}(g||(t.SetTraceNotification=g={})),function(e){e.type=new s.NotificationType("$/logTrace")}(f||(t.LogTraceNotification=f={})),function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"}(T||(t.ConnectionErrors=T={}));class N extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,N.prototype)}}t.ConnectionError=N,function(e){e.is=function(e){const t=e;return t&&i.func(t.cancelUndispatched)}}(S||(t.ConnectionStrategy=S={})),function(e){e.is=function(e){const t=e;return t&&(void 0===t.kind||"id"===t.kind)&&i.func(t.createCancellationTokenSource)&&(void 0===t.dispose||i.func(t.dispose))}}(E||(t.IdCancellationReceiverStrategy=E={})),function(e){e.is=function(e){const t=e;return t&&"request"===t.kind&&i.func(t.createCancellationTokenSource)&&(void 0===t.dispose||i.func(t.dispose))}}(y||(t.RequestCancellationReceiverStrategy=y={})),function(e){e.Message=Object.freeze({createCancellationTokenSource:e=>new c.CancellationTokenSource}),e.is=function(e){return E.is(e)||y.is(e)}}(O||(t.CancellationReceiverStrategy=O={})),function(e){e.Message=Object.freeze({sendCancellation:(e,t)=>e.sendNotification(l.type,{id:t}),cleanup(e){}}),e.is=function(e){const t=e;return t&&i.func(t.sendCancellation)&&i.func(t.cleanup)}}(P||(t.CancellationSenderStrategy=P={})),function(e){e.Message=Object.freeze({receiver:O.Message,sender:P.Message}),e.is=function(e){const t=e;return t&&O.is(t.receiver)&&P.is(t.sender)}}(C||(t.CancellationStrategy=C={})),function(e){e.is=function(e){const t=e;return t&&i.func(t.handleMessage)}}(R||(t.MessageStrategy=R={})),function(e){e.is=function(e){const t=e;return t&&(C.is(t.cancellationStrategy)||S.is(t.connectionStrategy)||R.is(t.messageStrategy))}}(k||(t.ConnectionOptions=k={})),function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"}(D||(D={})),t.createMessageConnection=function(e,n,m,S){const y=void 0!==m?m:t.NullLogger;let O=0,P=0,k=0;const b="2.0";let A;const x=new Map;let v;const M=new Map,L=new Map;let w,I,q=new r.LinkedMap,F=new Map,B=new Set,U=new Map,Y=p.Off,j=_.Text,W=D.New;const K=new a.Emitter,V=new a.Emitter,H=new a.Emitter,G=new a.Emitter,Z=new a.Emitter,$=S&&S.cancellationStrategy?S.cancellationStrategy:C.Message;function z(e){if(null===e)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+e.toString()}function Q(e){}function J(){return W===D.Listening}function X(){return W===D.Closed}function ee(){return W===D.Disposed}function te(){W!==D.New&&W!==D.Listening||(W=D.Closed,V.fire(void 0))}function ne(){w||0===q.size||(w=(0,o.default)().timer.setImmediate(()=>{w=void 0,function(){if(0===q.size)return;const e=q.shift();try{const t=S?.messageStrategy;R.is(t)?t.handleMessage(e,oe):oe(e)}finally{ne()}}()}))}function oe(e){s.Message.isRequest(e)?function(e){if(ee())return;function t(t,o,i){const r={jsonrpc:b,id:e.id};t instanceof s.ResponseError?r.error=t.toJson():r.result=void 0===t?null:t,re(r,o,i),n.write(r).catch(()=>y.error("Sending response failed."))}function o(t,o,i){const s={jsonrpc:b,id:e.id,error:t.toJson()};re(s,o,i),n.write(s).catch(()=>y.error("Sending response failed."))}!function(e){if(Y!==p.Off&&I)if(j===_.Text){let t;Y!==p.Verbose&&Y!==p.Compact||!e.params||(t=`Params: ${se(e.params)}\n\n`),I.log(`Received request '${e.method} - (${e.id})'.`,t)}else ce("receive-request",e)}(e);const r=x.get(e.method);let a,c;r&&(a=r.type,c=r.handler);const l=Date.now();if(c||A){const r=e.id??String(Date.now()),u=E.is($.receiver)?$.receiver.createCancellationTokenSource(r):$.receiver.createCancellationTokenSource(e);null!==e.id&&B.has(e.id)&&u.cancel(),null!==e.id&&U.set(r,u);try{let h;if(c)if(void 0===e.params){if(void 0!==a&&0!==a.numberOfParams)return void o(new s.ResponseError(s.ErrorCodes.InvalidParams,`Request ${e.method} defines ${a.numberOfParams} params but received none.`),e.method,l);h=c(u.token)}else if(Array.isArray(e.params)){if(void 0!==a&&a.parameterStructures===s.ParameterStructures.byName)return void o(new s.ResponseError(s.ErrorCodes.InvalidParams,`Request ${e.method} defines parameters by name but received parameters by position`),e.method,l);h=c(...e.params,u.token)}else{if(void 0!==a&&a.parameterStructures===s.ParameterStructures.byPosition)return void o(new s.ResponseError(s.ErrorCodes.InvalidParams,`Request ${e.method} defines parameters by position but received parameters by name`),e.method,l);h=c(e.params,u.token)}else A&&(h=A(e.method,e.params,u.token));const d=h;h?d.then?d.then(n=>{U.delete(r),t(n,e.method,l)},t=>{U.delete(r),t instanceof s.ResponseError?o(t,e.method,l):t&&i.string(t.message)?o(new s.ResponseError(s.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,l):o(new s.ResponseError(s.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,l)}):(U.delete(r),t(h,e.method,l)):(U.delete(r),function(t,o,i){void 0===t&&(t=null);const s={jsonrpc:b,id:e.id,result:t};re(s,o,i),n.write(s).catch(()=>y.error("Sending response failed."))}(h,e.method,l))}catch(n){U.delete(r),n instanceof s.ResponseError?t(n,e.method,l):n&&i.string(n.message)?o(new s.ResponseError(s.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${n.message}`),e.method,l):o(new s.ResponseError(s.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,l)}}else o(new s.ResponseError(s.ErrorCodes.MethodNotFound,`Unhandled method ${e.method}`),e.method,l)}(e):s.Message.isNotification(e)?function(e){if(ee())return;let t,n;if(e.method===l.type.method){const t=e.params.id;return B.delete(t),void ae(e)}{const o=M.get(e.method);o&&(n=o.handler,t=o.type)}if(n||v)try{if(ae(e),n)if(void 0===e.params)void 0!==t&&0!==t.numberOfParams&&t.parameterStructures!==s.ParameterStructures.byName&&y.error(`Notification ${e.method} defines ${t.numberOfParams} params but received none.`),n();else if(Array.isArray(e.params)){const o=e.params;e.method===h.type.method&&2===o.length&&u.is(o[0])?n({token:o[0],value:o[1]}):(void 0!==t&&(t.parameterStructures===s.ParameterStructures.byName&&y.error(`Notification ${e.method} defines parameters by name but received parameters by position`),t.numberOfParams!==e.params.length&&y.error(`Notification ${e.method} defines ${t.numberOfParams} params but received ${o.length} arguments`)),n(...o))}else void 0!==t&&t.parameterStructures===s.ParameterStructures.byPosition&&y.error(`Notification ${e.method} defines parameters by position but received parameters by name`),n(e.params);else v&&v(e.method,e.params)}catch(t){t.message?y.error(`Notification handler '${e.method}' failed with message: ${t.message}`):y.error(`Notification handler '${e.method}' failed unexpectedly.`)}else H.fire(e)}(e):s.Message.isResponse(e)?function(e){if(!ee())if(null===e.id)e.error?y.error(`Received response message without id: Error is: \n${JSON.stringify(e.error,void 0,4)}`):y.error("Received response message without id. No further error information provided.");else{const t=e.id,n=F.get(t);if(function(e,t){if(Y!==p.Off&&I)if(j===_.Text){let n;if(Y!==p.Verbose&&Y!==p.Compact||(e.error&&e.error.data?n=`Error data: ${se(e.error.data)}\n\n`:e.result?n=`Result: ${se(e.result)}\n\n`:void 0===e.error&&(n="No result returned.\n\n")),t){const o=e.error?` Request failed: ${e.error.message} (${e.error.code}).`:"";I.log(`Received response '${t.method} - (${e.id})' in ${Date.now()-t.timerStart}ms.${o}`,n)}else I.log(`Received response ${e.id} without active response promise.`,n)}else ce("receive-response",e)}(e,n),void 0!==n){F.delete(t);try{if(e.error){const t=e.error;n.reject(new s.ResponseError(t.code,t.message,t.data))}else{if(void 0===e.result)throw new Error("Should never happen.");n.resolve(e.result)}}catch(e){e.message?y.error(`Response handler '${n.method}' failed with message: ${e.message}`):y.error(`Response handler '${n.method}' failed unexpectedly.`)}}}}(e):function(e){if(!e)return void y.error("Received empty message.");y.error(`Received message which is neither a response nor a notification message:\n${JSON.stringify(e,null,4)}`);const t=e;if(i.string(t.id)||i.number(t.id)){const e=t.id,n=F.get(e);n&&n.reject(new Error("The received response has neither a result nor an error property."))}}(e)}e.onClose(te),e.onError(function(e){K.fire([e,void 0,void 0])}),n.onClose(te),n.onError(function(e){K.fire(e)});const ie=e=>{try{if(s.Message.isNotification(e)&&e.method===l.type.method){const t=e.params.id,o=z(t),i=q.get(o);if(s.Message.isRequest(i)){const s=S?.connectionStrategy,r=s&&s.cancelUndispatched?s.cancelUndispatched(i,Q):void 0;if(r&&(void 0!==r.error||void 0!==r.result))return q.delete(o),U.delete(t),r.id=i.id,re(r,e.method,Date.now()),void n.write(r).catch(()=>y.error("Sending response for canceled message failed."))}const r=U.get(t);if(void 0!==r)return r.cancel(),void ae(e);B.add(t)}!function(e,t){var n;s.Message.isRequest(t)?e.set(z(t.id),t):s.Message.isResponse(t)?e.set(null===(n=t.id)?"res-unknown-"+(++k).toString():"res-"+n.toString(),t):e.set("not-"+(++P).toString(),t)}(q,e)}finally{ne()}};function se(e){if(null!=e)switch(Y){case p.Verbose:return JSON.stringify(e,null,4);case p.Compact:return JSON.stringify(e);default:return}}function re(e,t,n){if(Y!==p.Off&&I)if(j===_.Text){let o;Y!==p.Verbose&&Y!==p.Compact||(e.error&&e.error.data?o=`Error data: ${se(e.error.data)}\n\n`:e.result?o=`Result: ${se(e.result)}\n\n`:void 0===e.error&&(o="No result returned.\n\n")),I.log(`Sending response '${t} - (${e.id})'. Processing request took ${Date.now()-n}ms`,o)}else ce("send-response",e)}function ae(e){if(Y!==p.Off&&I&&e.method!==f.type.method)if(j===_.Text){let t;Y!==p.Verbose&&Y!==p.Compact||(t=e.params?`Params: ${se(e.params)}\n\n`:"No parameters provided.\n\n"),I.log(`Received notification '${e.method}'.`,t)}else ce("receive-notification",e)}function ce(e,t){if(!I||Y===p.Off)return;const n={isLSPMessage:!0,type:e,message:t,timestamp:Date.now()};I.log(n)}function le(){if(X())throw new N(T.Closed,"Connection is closed.");if(ee())throw new N(T.Disposed,"Connection is disposed.")}function ue(e){return void 0===e?null:e}function he(e){return null===e?void 0:e}function de(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function pe(e,t){switch(e){case s.ParameterStructures.auto:return de(t)?he(t):[ue(t)];case s.ParameterStructures.byName:if(!de(t))throw new Error("Received parameters by name but param is not an object literal.");return he(t);case s.ParameterStructures.byPosition:return[ue(t)];default:throw new Error(`Unknown parameter structure ${e.toString()}`)}}function me(e,t){let n;const o=e.numberOfParams;switch(o){case 0:n=void 0;break;case 1:n=pe(e.parameterStructures,t[0]);break;default:n=[];for(let e=0;e<t.length&&e<o;e++)n.push(ue(t[e]));if(t.length<o)for(let e=t.length;e<o;e++)n.push(null)}return n}const _e={sendNotification:(e,...t)=>{let o,r;if(le(),i.string(e)){o=e;const n=t[0];let i=0,a=s.ParameterStructures.auto;s.ParameterStructures.is(n)&&(i=1,a=n);let c=t.length;const l=c-i;switch(l){case 0:r=void 0;break;case 1:r=pe(a,t[i]);break;default:if(a===s.ParameterStructures.byName)throw new Error(`Received ${l} parameters for 'by Name' notification parameter structure.`);r=t.slice(i,c).map(e=>ue(e))}}else{const n=t;o=e.method,r=me(e,n)}const a={jsonrpc:b,method:o,params:r};return function(e){if(Y!==p.Off&&I)if(j===_.Text){let t;Y!==p.Verbose&&Y!==p.Compact||(t=e.params?`Params: ${se(e.params)}\n\n`:"No parameters provided.\n\n"),I.log(`Sending notification '${e.method}'.`,t)}else ce("send-notification",e)}(a),n.write(a).catch(e=>{throw y.error("Sending notification failed."),e})},onNotification:(e,t)=>{let n;return le(),i.func(e)?v=e:t&&(i.string(e)?(n=e,M.set(e,{type:void 0,handler:t})):(n=e.method,M.set(e.method,{type:e,handler:t}))),{dispose:()=>{void 0!==n?M.delete(n):v=void 0}}},onProgress:(e,t,n)=>{if(L.has(t))throw new Error(`Progress handler for token ${t} already registered`);return L.set(t,n),{dispose:()=>{L.delete(t)}}},sendProgress:(e,t,n)=>_e.sendNotification(h.type,{token:t,value:n}),onUnhandledProgress:G.event,sendRequest:(e,...t)=>{let o,r,a;if(le(),function(){if(!J())throw new Error("Call listen() first.")}(),i.string(e)){o=e;const n=t[0],i=t[t.length-1];let l=0,u=s.ParameterStructures.auto;s.ParameterStructures.is(n)&&(l=1,u=n);let h=t.length;c.CancellationToken.is(i)&&(h-=1,a=i);const d=h-l;switch(d){case 0:r=void 0;break;case 1:r=pe(u,t[l]);break;default:if(u===s.ParameterStructures.byName)throw new Error(`Received ${d} parameters for 'by Name' request parameter structure.`);r=t.slice(l,h).map(e=>ue(e))}}else{const n=t;o=e.method,r=me(e,n);const i=e.numberOfParams;a=c.CancellationToken.is(n[i])?n[i]:void 0}const l=O++;let u;a&&(u=a.onCancellationRequested(()=>{const e=$.sender.sendCancellation(_e,l);return void 0===e?(y.log(`Received no promise from cancellation strategy when cancelling id ${l}`),Promise.resolve()):e.catch(()=>{y.log(`Sending cancellation messages for id ${l} failed`)})}));const h={jsonrpc:b,id:l,method:o,params:r};return function(e){if(Y!==p.Off&&I)if(j===_.Text){let t;Y!==p.Verbose&&Y!==p.Compact||!e.params||(t=`Params: ${se(e.params)}\n\n`),I.log(`Sending request '${e.method} - (${e.id})'.`,t)}else ce("send-request",e)}(h),"function"==typeof $.sender.enableCancellation&&$.sender.enableCancellation(h),new Promise(async(e,t)=>{const i={method:o,timerStart:Date.now(),resolve:t=>{e(t),$.sender.cleanup(l),u?.dispose()},reject:e=>{t(e),$.sender.cleanup(l),u?.dispose()}};try{await n.write(h),F.set(l,i)}catch(e){throw y.error("Sending request failed."),i.reject(new s.ResponseError(s.ErrorCodes.MessageWriteError,e.message?e.message:"Unknown reason")),e}})},onRequest:(e,t)=>{le();let n=null;return d.is(e)?(n=void 0,A=e):i.string(e)?(n=null,void 0!==t&&(n=e,x.set(e,{handler:t,type:void 0}))):void 0!==t&&(n=e.method,x.set(e.method,{type:e,handler:t})),{dispose:()=>{null!==n&&(void 0!==n?x.delete(n):A=void 0)}}},hasPendingResponse:()=>F.size>0,trace:async(e,t,n)=>{let o=!1,s=_.Text;void 0!==n&&(i.boolean(n)?o=n:(o=n.sendNotification||!1,s=n.traceFormat||_.Text)),Y=e,j=s,I=Y===p.Off?void 0:t,!o||X()||ee()||await _e.sendNotification(g.type,{value:p.toString(e)})},onError:K.event,onClose:V.event,onUnhandledNotification:H.event,onDispose:Z.event,end:()=>{n.end()},dispose:()=>{if(ee())return;W=D.Disposed,Z.fire(void 0);const t=new s.ResponseError(s.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(const e of F.values())e.reject(t);F=new Map,U=new Map,B=new Set,q=new r.LinkedMap,i.func(n.dispose)&&n.dispose(),i.func(e.dispose)&&e.dispose()},listen:()=>{le(),function(){if(J())throw new N(T.AlreadyListening,"Connection is already listening")}(),W=D.Listening,e.listen(ie)},inspect:()=>{(0,o.default)().console.log("inspect")}};return _e.onNotification(f.type,e=>{if(Y===p.Off||!I)return;const t=Y===p.Verbose||Y===p.Compact;I.log(e.message,t?e.verbose:void 0)}),_e.onNotification(h.type,e=>{const t=L.get(e.token);t?t(e.value):G.fire(e)}),_e}},645:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TypeHierarchySubtypesRequest=t.TypeHierarchySupertypesRequest=t.TypeHierarchyPrepareRequest=void 0;const o=n(372);var i,s,r;!function(e){e.method="textDocument/prepareTypeHierarchy",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.TypeHierarchyPrepareRequest=i={})),function(e){e.method="typeHierarchy/supertypes",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(s||(t.TypeHierarchySupertypesRequest=s={})),function(e){e.method="typeHierarchy/subtypes",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(r||(t.TypeHierarchySubtypesRequest=r={}))},908:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShowDocumentRequest=void 0;const o=n(372);var i;!function(e){e.method="window/showDocument",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType(e.method)}(i||(t.ShowDocumentRequest=i={}))},1248:(e,t)=>{function n(e){return"string"==typeof e||e instanceof String}function o(e){return"function"==typeof e}function i(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.thenable=t.typedArray=t.stringArray=t.array=t.func=t.error=t.number=t.string=t.boolean=void 0,t.boolean=function(e){return!0===e||!1===e},t.string=n,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=o,t.array=i,t.stringArray=function(e){return i(e)&&e.every(e=>n(e))},t.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)},t.thenable=function(e){return e&&o(e.then)}},1276:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InlineCompletionFeature=void 0;const o=n(4512);t.InlineCompletionFeature=e=>class extends e{get inlineCompletion(){return{on:e=>this.connection.onRequest(o.InlineCompletionRequest.type,(t,n)=>e(t,n,this.attachWorkDoneProgress(t)))}}}},1560:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceSymbolRequest=t.CodeActionResolveRequest=t.CodeActionRequest=t.DocumentSymbolRequest=t.DocumentHighlightRequest=t.ReferencesRequest=t.DefinitionRequest=t.SignatureHelpRequest=t.SignatureHelpTriggerKind=t.HoverRequest=t.CompletionResolveRequest=t.CompletionRequest=t.CompletionTriggerKind=t.PublishDiagnosticsNotification=t.WatchKind=t.RelativePattern=t.FileChangeType=t.DidChangeWatchedFilesNotification=t.WillSaveTextDocumentWaitUntilRequest=t.WillSaveTextDocumentNotification=t.TextDocumentSaveReason=t.DidSaveTextDocumentNotification=t.DidCloseTextDocumentNotification=t.DidChangeTextDocumentNotification=t.TextDocumentContentChangeEvent=t.DidOpenTextDocumentNotification=t.TextDocumentSyncKind=t.TelemetryEventNotification=t.LogMessageNotification=t.ShowMessageRequest=t.ShowMessageNotification=t.MessageType=t.DidChangeConfigurationNotification=t.ExitNotification=t.ShutdownRequest=t.InitializedNotification=t.InitializeErrorCodes=t.InitializeRequest=t.WorkDoneProgressOptions=t.TextDocumentRegistrationOptions=t.StaticRegistrationOptions=t.PositionEncodingKind=t.FailureHandlingKind=t.ResourceOperationKind=t.UnregistrationRequest=t.RegistrationRequest=t.DocumentSelector=t.NotebookCellTextDocumentFilter=t.NotebookDocumentFilter=t.TextDocumentFilter=void 0,t.MonikerRequest=t.MonikerKind=t.UniquenessLevel=t.WillDeleteFilesRequest=t.DidDeleteFilesNotification=t.WillRenameFilesRequest=t.DidRenameFilesNotification=t.WillCreateFilesRequest=t.DidCreateFilesNotification=t.FileOperationPatternKind=t.LinkedEditingRangeRequest=t.ShowDocumentRequest=t.SemanticTokensRegistrationType=t.SemanticTokensRefreshRequest=t.SemanticTokensRangeRequest=t.SemanticTokensDeltaRequest=t.SemanticTokensRequest=t.TokenFormat=t.CallHierarchyPrepareRequest=t.CallHierarchyOutgoingCallsRequest=t.CallHierarchyIncomingCallsRequest=t.WorkDoneProgressCancelNotification=t.WorkDoneProgressCreateRequest=t.WorkDoneProgress=t.SelectionRangeRequest=t.DeclarationRequest=t.FoldingRangeRefreshRequest=t.FoldingRangeRequest=t.ColorPresentationRequest=t.DocumentColorRequest=t.ConfigurationRequest=t.DidChangeWorkspaceFoldersNotification=t.WorkspaceFoldersRequest=t.TypeDefinitionRequest=t.ImplementationRequest=t.ApplyWorkspaceEditRequest=t.ExecuteCommandRequest=t.PrepareRenameRequest=t.RenameRequest=t.PrepareSupportDefaultBehavior=t.DocumentOnTypeFormattingRequest=t.DocumentRangesFormattingRequest=t.DocumentRangeFormattingRequest=t.DocumentFormattingRequest=t.DocumentLinkResolveRequest=t.DocumentLinkRequest=t.CodeLensRefreshRequest=t.CodeLensResolveRequest=t.CodeLensRequest=t.WorkspaceSymbolResolveRequest=void 0,t.InlineCompletionRequest=t.DidCloseNotebookDocumentNotification=t.DidSaveNotebookDocumentNotification=t.DidChangeNotebookDocumentNotification=t.NotebookCellArrayChange=t.DidOpenNotebookDocumentNotification=t.NotebookDocumentSyncRegistrationType=t.NotebookDocument=t.NotebookCell=t.ExecutionSummary=t.NotebookCellKind=t.DiagnosticRefreshRequest=t.WorkspaceDiagnosticRequest=t.DocumentDiagnosticRequest=t.DocumentDiagnosticReportKind=t.DiagnosticServerCancellationData=t.InlayHintRefreshRequest=t.InlayHintResolveRequest=t.InlayHintRequest=t.InlineValueRefreshRequest=t.InlineValueRequest=t.TypeHierarchySupertypesRequest=t.TypeHierarchySubtypesRequest=t.TypeHierarchyPrepareRequest=void 0;const o=n(372),i=n(6203),s=n(8598),r=n(9574);Object.defineProperty(t,"ImplementationRequest",{enumerable:!0,get:function(){return r.ImplementationRequest}});const a=n(8461);Object.defineProperty(t,"TypeDefinitionRequest",{enumerable:!0,get:function(){return a.TypeDefinitionRequest}});const c=n(9935);Object.defineProperty(t,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return c.WorkspaceFoldersRequest}}),Object.defineProperty(t,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return c.DidChangeWorkspaceFoldersNotification}});const l=n(1660);Object.defineProperty(t,"ConfigurationRequest",{enumerable:!0,get:function(){return l.ConfigurationRequest}});const u=n(7672);Object.defineProperty(t,"DocumentColorRequest",{enumerable:!0,get:function(){return u.DocumentColorRequest}}),Object.defineProperty(t,"ColorPresentationRequest",{enumerable:!0,get:function(){return u.ColorPresentationRequest}});const h=n(2874);Object.defineProperty(t,"FoldingRangeRequest",{enumerable:!0,get:function(){return h.FoldingRangeRequest}}),Object.defineProperty(t,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return h.FoldingRangeRefreshRequest}});const d=n(6914);Object.defineProperty(t,"DeclarationRequest",{enumerable:!0,get:function(){return d.DeclarationRequest}});const p=n(3487);Object.defineProperty(t,"SelectionRangeRequest",{enumerable:!0,get:function(){return p.SelectionRangeRequest}});const m=n(2687);Object.defineProperty(t,"WorkDoneProgress",{enumerable:!0,get:function(){return m.WorkDoneProgress}}),Object.defineProperty(t,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return m.WorkDoneProgressCreateRequest}}),Object.defineProperty(t,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return m.WorkDoneProgressCancelNotification}});const _=n(8765);Object.defineProperty(t,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return _.CallHierarchyIncomingCallsRequest}}),Object.defineProperty(t,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return _.CallHierarchyOutgoingCallsRequest}}),Object.defineProperty(t,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return _.CallHierarchyPrepareRequest}});const g=n(2478);Object.defineProperty(t,"TokenFormat",{enumerable:!0,get:function(){return g.TokenFormat}}),Object.defineProperty(t,"SemanticTokensRequest",{enumerable:!0,get:function(){return g.SemanticTokensRequest}}),Object.defineProperty(t,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return g.SemanticTokensDeltaRequest}}),Object.defineProperty(t,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return g.SemanticTokensRangeRequest}}),Object.defineProperty(t,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return g.SemanticTokensRefreshRequest}}),Object.defineProperty(t,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return g.SemanticTokensRegistrationType}});const f=n(908);Object.defineProperty(t,"ShowDocumentRequest",{enumerable:!0,get:function(){return f.ShowDocumentRequest}});const T=n(5316);Object.defineProperty(t,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return T.LinkedEditingRangeRequest}});const S=n(9840);Object.defineProperty(t,"FileOperationPatternKind",{enumerable:!0,get:function(){return S.FileOperationPatternKind}}),Object.defineProperty(t,"DidCreateFilesNotification",{enumerable:!0,get:function(){return S.DidCreateFilesNotification}}),Object.defineProperty(t,"WillCreateFilesRequest",{enumerable:!0,get:function(){return S.WillCreateFilesRequest}}),Object.defineProperty(t,"DidRenameFilesNotification",{enumerable:!0,get:function(){return S.DidRenameFilesNotification}}),Object.defineProperty(t,"WillRenameFilesRequest",{enumerable:!0,get:function(){return S.WillRenameFilesRequest}}),Object.defineProperty(t,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return S.DidDeleteFilesNotification}}),Object.defineProperty(t,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return S.WillDeleteFilesRequest}});const E=n(9047);Object.defineProperty(t,"UniquenessLevel",{enumerable:!0,get:function(){return E.UniquenessLevel}}),Object.defineProperty(t,"MonikerKind",{enumerable:!0,get:function(){return E.MonikerKind}}),Object.defineProperty(t,"MonikerRequest",{enumerable:!0,get:function(){return E.MonikerRequest}});const y=n(645);Object.defineProperty(t,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return y.TypeHierarchyPrepareRequest}}),Object.defineProperty(t,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return y.TypeHierarchySubtypesRequest}}),Object.defineProperty(t,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return y.TypeHierarchySupertypesRequest}});const O=n(3124);Object.defineProperty(t,"InlineValueRequest",{enumerable:!0,get:function(){return O.InlineValueRequest}}),Object.defineProperty(t,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return O.InlineValueRefreshRequest}});const P=n(7752);Object.defineProperty(t,"InlayHintRequest",{enumerable:!0,get:function(){return P.InlayHintRequest}}),Object.defineProperty(t,"InlayHintResolveRequest",{enumerable:!0,get:function(){return P.InlayHintResolveRequest}}),Object.defineProperty(t,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return P.InlayHintRefreshRequest}});const C=n(6011);Object.defineProperty(t,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return C.DiagnosticServerCancellationData}}),Object.defineProperty(t,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return C.DocumentDiagnosticReportKind}}),Object.defineProperty(t,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return C.DocumentDiagnosticRequest}}),Object.defineProperty(t,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return C.WorkspaceDiagnosticRequest}}),Object.defineProperty(t,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return C.DiagnosticRefreshRequest}});const R=n(3557);Object.defineProperty(t,"NotebookCellKind",{enumerable:!0,get:function(){return R.NotebookCellKind}}),Object.defineProperty(t,"ExecutionSummary",{enumerable:!0,get:function(){return R.ExecutionSummary}}),Object.defineProperty(t,"NotebookCell",{enumerable:!0,get:function(){return R.NotebookCell}}),Object.defineProperty(t,"NotebookDocument",{enumerable:!0,get:function(){return R.NotebookDocument}}),Object.defineProperty(t,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return R.NotebookDocumentSyncRegistrationType}}),Object.defineProperty(t,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return R.DidOpenNotebookDocumentNotification}}),Object.defineProperty(t,"NotebookCellArrayChange",{enumerable:!0,get:function(){return R.NotebookCellArrayChange}}),Object.defineProperty(t,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return R.DidChangeNotebookDocumentNotification}}),Object.defineProperty(t,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return R.DidSaveNotebookDocumentNotification}}),Object.defineProperty(t,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return R.DidCloseNotebookDocumentNotification}});const k=n(3307);var D,N,b,A,x,v,M,L,w,I,q,F,B,U,Y,j,W,K,V,H,G,Z,$,z,Q,J,X,ee,te,ne,oe,ie,se,re,ae,ce,le,ue,he,de,pe,me,_e,ge,fe,Te,Se,Ee,ye,Oe,Pe,Ce,Re,ke,De,Ne,be,Ae,xe,ve,Me,Le,we,Ie,qe;Object.defineProperty(t,"InlineCompletionRequest",{enumerable:!0,get:function(){return k.InlineCompletionRequest}}),function(e){e.is=function(e){const t=e;return s.string(t)||s.string(t.language)||s.string(t.scheme)||s.string(t.pattern)}}(D||(t.TextDocumentFilter=D={})),function(e){e.is=function(e){const t=e;return s.objectLiteral(t)&&(s.string(t.notebookType)||s.string(t.scheme)||s.string(t.pattern))}}(N||(t.NotebookDocumentFilter=N={})),function(e){e.is=function(e){const t=e;return s.objectLiteral(t)&&(s.string(t.notebook)||N.is(t.notebook))&&(void 0===t.language||s.string(t.language))}}(b||(t.NotebookCellTextDocumentFilter=b={})),function(e){e.is=function(e){if(!Array.isArray(e))return!1;for(let t of e)if(!s.string(t)&&!D.is(t)&&!b.is(t))return!1;return!0}}(A||(t.DocumentSelector=A={})),function(e){e.method="client/registerCapability",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType(e.method)}(x||(t.RegistrationRequest=x={})),function(e){e.method="client/unregisterCapability",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType(e.method)}(v||(t.UnregistrationRequest=v={})),function(e){e.Create="create",e.Rename="rename",e.Delete="delete"}(M||(t.ResourceOperationKind=M={})),function(e){e.Abort="abort",e.Transactional="transactional",e.TextOnlyTransactional="textOnlyTransactional",e.Undo="undo"}(L||(t.FailureHandlingKind=L={})),function(e){e.UTF8="utf-8",e.UTF16="utf-16",e.UTF32="utf-32"}(w||(t.PositionEncodingKind=w={})),function(e){e.hasId=function(e){const t=e;return t&&s.string(t.id)&&t.id.length>0}}(I||(t.StaticRegistrationOptions=I={})),function(e){e.is=function(e){const t=e;return t&&(null===t.documentSelector||A.is(t.documentSelector))}}(q||(t.TextDocumentRegistrationOptions=q={})),function(e){e.is=function(e){const t=e;return s.objectLiteral(t)&&(void 0===t.workDoneProgress||s.boolean(t.workDoneProgress))},e.hasWorkDoneProgress=function(e){const t=e;return t&&s.boolean(t.workDoneProgress)}}(F||(t.WorkDoneProgressOptions=F={})),function(e){e.method="initialize",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(B||(t.InitializeRequest=B={})),function(e){e.unknownProtocolVersion=1}(U||(t.InitializeErrorCodes=U={})),function(e){e.method="initialized",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(Y||(t.InitializedNotification=Y={})),function(e){e.method="shutdown",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType0(e.method)}(j||(t.ShutdownRequest=j={})),function(e){e.method="exit",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType0(e.method)}(W||(t.ExitNotification=W={})),function(e){e.method="workspace/didChangeConfiguration",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(K||(t.DidChangeConfigurationNotification=K={})),function(e){e.Error=1,e.Warning=2,e.Info=3,e.Log=4,e.Debug=5}(V||(t.MessageType=V={})),function(e){e.method="window/showMessage",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolNotificationType(e.method)}(H||(t.ShowMessageNotification=H={})),function(e){e.method="window/showMessageRequest",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType(e.method)}(G||(t.ShowMessageRequest=G={})),function(e){e.method="window/logMessage",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolNotificationType(e.method)}(Z||(t.LogMessageNotification=Z={})),function(e){e.method="telemetry/event",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolNotificationType(e.method)}($||(t.TelemetryEventNotification=$={})),function(e){e.None=0,e.Full=1,e.Incremental=2}(z||(t.TextDocumentSyncKind=z={})),function(e){e.method="textDocument/didOpen",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(Q||(t.DidOpenTextDocumentNotification=Q={})),function(e){e.isIncremental=function(e){let t=e;return null!=t&&"string"==typeof t.text&&void 0!==t.range&&(void 0===t.rangeLength||"number"==typeof t.rangeLength)},e.isFull=function(e){let t=e;return null!=t&&"string"==typeof t.text&&void 0===t.range&&void 0===t.rangeLength}}(J||(t.TextDocumentContentChangeEvent=J={})),function(e){e.method="textDocument/didChange",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(X||(t.DidChangeTextDocumentNotification=X={})),function(e){e.method="textDocument/didClose",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(ee||(t.DidCloseTextDocumentNotification=ee={})),function(e){e.method="textDocument/didSave",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(te||(t.DidSaveTextDocumentNotification=te={})),function(e){e.Manual=1,e.AfterDelay=2,e.FocusOut=3}(ne||(t.TextDocumentSaveReason=ne={})),function(e){e.method="textDocument/willSave",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(oe||(t.WillSaveTextDocumentNotification=oe={})),function(e){e.method="textDocument/willSaveWaitUntil",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(ie||(t.WillSaveTextDocumentWaitUntilRequest=ie={})),function(e){e.method="workspace/didChangeWatchedFiles",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(se||(t.DidChangeWatchedFilesNotification=se={})),function(e){e.Created=1,e.Changed=2,e.Deleted=3}(re||(t.FileChangeType=re={})),function(e){e.is=function(e){const t=e;return s.objectLiteral(t)&&(i.URI.is(t.baseUri)||i.WorkspaceFolder.is(t.baseUri))&&s.string(t.pattern)}}(ae||(t.RelativePattern=ae={})),function(e){e.Create=1,e.Change=2,e.Delete=4}(ce||(t.WatchKind=ce={})),function(e){e.method="textDocument/publishDiagnostics",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolNotificationType(e.method)}(le||(t.PublishDiagnosticsNotification=le={})),function(e){e.Invoked=1,e.TriggerCharacter=2,e.TriggerForIncompleteCompletions=3}(ue||(t.CompletionTriggerKind=ue={})),function(e){e.method="textDocument/completion",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(he||(t.CompletionRequest=he={})),function(e){e.method="completionItem/resolve",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(de||(t.CompletionResolveRequest=de={})),function(e){e.method="textDocument/hover",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(pe||(t.HoverRequest=pe={})),function(e){e.Invoked=1,e.TriggerCharacter=2,e.ContentChange=3}(me||(t.SignatureHelpTriggerKind=me={})),function(e){e.method="textDocument/signatureHelp",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(_e||(t.SignatureHelpRequest=_e={})),function(e){e.method="textDocument/definition",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(ge||(t.DefinitionRequest=ge={})),function(e){e.method="textDocument/references",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(fe||(t.ReferencesRequest=fe={})),function(e){e.method="textDocument/documentHighlight",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Te||(t.DocumentHighlightRequest=Te={})),function(e){e.method="textDocument/documentSymbol",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Se||(t.DocumentSymbolRequest=Se={})),function(e){e.method="textDocument/codeAction",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Ee||(t.CodeActionRequest=Ee={})),function(e){e.method="codeAction/resolve",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(ye||(t.CodeActionResolveRequest=ye={})),function(e){e.method="workspace/symbol",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Oe||(t.WorkspaceSymbolRequest=Oe={})),function(e){e.method="workspaceSymbol/resolve",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Pe||(t.WorkspaceSymbolResolveRequest=Pe={})),function(e){e.method="textDocument/codeLens",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Ce||(t.CodeLensRequest=Ce={})),function(e){e.method="codeLens/resolve",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Re||(t.CodeLensResolveRequest=Re={})),function(e){e.method="workspace/codeLens/refresh",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType0(e.method)}(ke||(t.CodeLensRefreshRequest=ke={})),function(e){e.method="textDocument/documentLink",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(De||(t.DocumentLinkRequest=De={})),function(e){e.method="documentLink/resolve",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Ne||(t.DocumentLinkResolveRequest=Ne={})),function(e){e.method="textDocument/formatting",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(be||(t.DocumentFormattingRequest=be={})),function(e){e.method="textDocument/rangeFormatting",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Ae||(t.DocumentRangeFormattingRequest=Ae={})),function(e){e.method="textDocument/rangesFormatting",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(xe||(t.DocumentRangesFormattingRequest=xe={})),function(e){e.method="textDocument/onTypeFormatting",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(ve||(t.DocumentOnTypeFormattingRequest=ve={})),function(e){e.Identifier=1}(Me||(t.PrepareSupportDefaultBehavior=Me={})),function(e){e.method="textDocument/rename",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Le||(t.RenameRequest=Le={})),function(e){e.method="textDocument/prepareRename",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(we||(t.PrepareRenameRequest=we={})),function(e){e.method="workspace/executeCommand",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(Ie||(t.ExecuteCommandRequest=Ie={})),function(e){e.method="workspace/applyEdit",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType("workspace/applyEdit")}(qe||(t.ApplyWorkspaceEditRequest=qe={}))},1580:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createProtocolConnection=void 0;const o=n(6439);t.createProtocolConnection=function(e,t,n,i){return o.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),(0,o.createMessageConnection)(e,t,n,i)}},1660:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationRequest=void 0;const o=n(372);var i;!function(e){e.method="workspace/configuration",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType(e.method)}(i||(t.ConfigurationRequest=i={}))},1662:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextDocuments=void 0;const o=n(4512);t.TextDocuments=class{constructor(e){this._configuration=e,this._syncedDocuments=new Map,this._onDidChangeContent=new o.Emitter,this._onDidOpen=new o.Emitter,this._onDidClose=new o.Emitter,this._onDidSave=new o.Emitter,this._onWillSave=new o.Emitter}get onDidOpen(){return this._onDidOpen.event}get onDidChangeContent(){return this._onDidChangeContent.event}get onWillSave(){return this._onWillSave.event}onWillSaveWaitUntil(e){this._willSaveWaitUntil=e}get onDidSave(){return this._onDidSave.event}get onDidClose(){return this._onDidClose.event}get(e){return this._syncedDocuments.get(e)}all(){return Array.from(this._syncedDocuments.values())}keys(){return Array.from(this._syncedDocuments.keys())}listen(e){e.__textDocumentSync=o.TextDocumentSyncKind.Incremental;const t=[];return t.push(e.onDidOpenTextDocument(e=>{const t=e.textDocument,n=this._configuration.create(t.uri,t.languageId,t.version,t.text);this._syncedDocuments.set(t.uri,n);const o=Object.freeze({document:n});this._onDidOpen.fire(o),this._onDidChangeContent.fire(o)})),t.push(e.onDidChangeTextDocument(e=>{const t=e.textDocument,n=e.contentChanges;if(0===n.length)return;const{version:o}=t;if(null==o)throw new Error(`Received document change event for ${t.uri} without valid version identifier`);let i=this._syncedDocuments.get(t.uri);void 0!==i&&(i=this._configuration.update(i,n,o),this._syncedDocuments.set(t.uri,i),this._onDidChangeContent.fire(Object.freeze({document:i})))})),t.push(e.onDidCloseTextDocument(e=>{let t=this._syncedDocuments.get(e.textDocument.uri);void 0!==t&&(this._syncedDocuments.delete(e.textDocument.uri),this._onDidClose.fire(Object.freeze({document:t})))})),t.push(e.onWillSaveTextDocument(e=>{let t=this._syncedDocuments.get(e.textDocument.uri);void 0!==t&&this._onWillSave.fire(Object.freeze({document:t,reason:e.reason}))})),t.push(e.onWillSaveTextDocumentWaitUntil((e,t)=>{let n=this._syncedDocuments.get(e.textDocument.uri);return void 0!==n&&this._willSaveWaitUntil?this._willSaveWaitUntil(Object.freeze({document:n,reason:e.reason}),t):[]})),t.push(e.onDidSaveTextDocument(e=>{let t=this._syncedDocuments.get(e.textDocument.uri);void 0!==t&&this._onDidSave.fire(Object.freeze({document:t}))})),o.Disposable.create(()=>{t.forEach(e=>e.dispose())})}}},1815:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InlineValueFeature=void 0;const o=n(4512);t.InlineValueFeature=e=>class extends e{get inlineValue(){return{refresh:()=>this.connection.sendRequest(o.InlineValueRefreshRequest.type),on:e=>this.connection.onRequest(o.InlineValueRequest.type,(t,n)=>e(t,n,this.attachWorkDoneProgress(t)))}}}},2112:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceFoldersFeature=void 0;const o=n(4512);t.WorkspaceFoldersFeature=e=>class extends e{constructor(){super(),this._notificationIsAutoRegistered=!1}initialize(e){super.initialize(e);let t=e.workspace;t&&t.workspaceFolders&&(this._onDidChangeWorkspaceFolders=new o.Emitter,this.connection.onNotification(o.DidChangeWorkspaceFoldersNotification.type,e=>{this._onDidChangeWorkspaceFolders.fire(e.event)}))}fillServerCapabilities(e){super.fillServerCapabilities(e);const t=e.workspace?.workspaceFolders?.changeNotifications;this._notificationIsAutoRegistered=!0===t||"string"==typeof t}getWorkspaceFolders(){return this.connection.sendRequest(o.WorkspaceFoldersRequest.type)}get onDidChangeWorkspaceFolders(){if(!this._onDidChangeWorkspaceFolders)throw new Error("Client doesn't support sending workspace folder change events.");return this._notificationIsAutoRegistered||this._unregistration||(this._unregistration=this.connection.client.register(o.DidChangeWorkspaceFoldersNotification.type)),this._onDidChangeWorkspaceFolders.event}}},2478:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SemanticTokensRefreshRequest=t.SemanticTokensRangeRequest=t.SemanticTokensDeltaRequest=t.SemanticTokensRequest=t.SemanticTokensRegistrationType=t.TokenFormat=void 0;const o=n(372);var i,s,r,a,c,l;!function(e){e.Relative="relative"}(i||(t.TokenFormat=i={})),function(e){e.method="textDocument/semanticTokens",e.type=new o.RegistrationType(e.method)}(s||(t.SemanticTokensRegistrationType=s={})),function(e){e.method="textDocument/semanticTokens/full",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method),e.registrationMethod=s.method}(r||(t.SemanticTokensRequest=r={})),function(e){e.method="textDocument/semanticTokens/full/delta",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method),e.registrationMethod=s.method}(a||(t.SemanticTokensDeltaRequest=a={})),function(e){e.method="textDocument/semanticTokens/range",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method),e.registrationMethod=s.method}(c||(t.SemanticTokensRangeRequest=c={})),function(e){e.method="workspace/semanticTokens/refresh",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType0(e.method)}(l||(t.SemanticTokensRefreshRequest=l={}))},2655:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SemanticTokensBuilder=t.SemanticTokensDiff=t.SemanticTokensFeature=void 0;const o=n(4512);t.SemanticTokensFeature=e=>class extends e{get semanticTokens(){return{refresh:()=>this.connection.sendRequest(o.SemanticTokensRefreshRequest.type),on:e=>{const t=o.SemanticTokensRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))},onDelta:e=>{const t=o.SemanticTokensDeltaRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))},onRange:e=>{const t=o.SemanticTokensRangeRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))}}}};class i{constructor(e,t){this.originalSequence=e,this.modifiedSequence=t}computeDiff(){const e=this.originalSequence.length,t=this.modifiedSequence.length;let n=0;for(;n<t&&n<e&&this.originalSequence[n]===this.modifiedSequence[n];)n++;if(n<t&&n<e){let o=e-1,i=t-1;for(;o>=n&&i>=n&&this.originalSequence[o]===this.modifiedSequence[i];)o--,i--;(o<n||i<n)&&(o++,i++);const s=o-n+1,r=this.modifiedSequence.slice(n,i+1);return 1===r.length&&r[0]===this.originalSequence[o]?[{start:n,deleteCount:s-1}]:[{start:n,deleteCount:s,data:r}]}return n<t?[{start:n,deleteCount:0,data:this.modifiedSequence.slice(n)}]:n<e?[{start:n,deleteCount:e-n}]:[]}}t.SemanticTokensDiff=i,t.SemanticTokensBuilder=class{constructor(){this._prevData=void 0,this.initialize()}initialize(){this._id=Date.now(),this._prevLine=0,this._prevChar=0,this._data=[],this._dataLen=0}push(e,t,n,o,i){let s=e,r=t;this._dataLen>0&&(s-=this._prevLine,0===s&&(r-=this._prevChar)),this._data[this._dataLen++]=s,this._data[this._dataLen++]=r,this._data[this._dataLen++]=n,this._data[this._dataLen++]=o,this._data[this._dataLen++]=i,this._prevLine=e,this._prevChar=t}get id(){return this._id.toString()}previousResult(e){this.id===e&&(this._prevData=this._data),this.initialize()}build(){return this._prevData=void 0,{resultId:this.id,data:this._data}}canBuildEdits(){return void 0!==this._prevData}buildEdits(){return void 0!==this._prevData?{resultId:this.id,edits:new i(this._prevData,this._data).computeDiff()}:this.build()}}},2676:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Emitter=t.Event=void 0;const o=n(9590);var i;!function(e){const t={dispose(){}};e.None=function(){return t}}(i||(t.Event=i={}));class s{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let o=0,i=this._callbacks.length;o<i;o++)if(this._callbacks[o]===e){if(this._contexts[o]===t)return this._callbacks.splice(o,1),void this._contexts.splice(o,1);n=!0}if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];const t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,r=n.length;s<r;s++)try{t.push(n[s].apply(i[s],e))}catch(e){(0,o.default)().console.error(e)}return t}isEmpty(){return!this._callbacks||0===this._callbacks.length}dispose(){this._callbacks=void 0,this._contexts=void 0}}class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new s),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);const o={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),o.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(o),o}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}t.Emitter=r,r._noop=function(){}},2687:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkDoneProgressCancelNotification=t.WorkDoneProgressCreateRequest=t.WorkDoneProgress=void 0;const o=n(6439),i=n(372);var s,r,a;!function(e){e.type=new o.ProgressType,e.is=function(t){return t===e.type}}(s||(t.WorkDoneProgress=s={})),function(e){e.method="window/workDoneProgress/create",e.messageDirection=i.MessageDirection.serverToClient,e.type=new i.ProtocolRequestType(e.method)}(r||(t.WorkDoneProgressCreateRequest=r={})),function(e){e.method="window/workDoneProgress/cancel",e.messageDirection=i.MessageDirection.clientToServer,e.type=new i.ProtocolNotificationType(e.method)}(a||(t.WorkDoneProgressCancelNotification=a={}))},2697:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileOperationsFeature=void 0;const o=n(4512);t.FileOperationsFeature=e=>class extends e{onDidCreateFiles(e){return this.connection.onNotification(o.DidCreateFilesNotification.type,t=>{e(t)})}onDidRenameFiles(e){return this.connection.onNotification(o.DidRenameFilesNotification.type,t=>{e(t)})}onDidDeleteFiles(e){return this.connection.onNotification(o.DidDeleteFilesNotification.type,t=>{e(t)})}onWillCreateFiles(e){return this.connection.onRequest(o.WillCreateFilesRequest.type,(t,n)=>e(t,n))}onWillRenameFiles(e){return this.connection.onRequest(o.WillRenameFilesRequest.type,(t,n)=>e(t,n))}onWillDeleteFiles(e){return this.connection.onRequest(o.WillDeleteFilesRequest.type,(t,n)=>e(t,n))}}},2861:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ProposedFeatures=t.NotebookDocuments=t.TextDocuments=t.SemanticTokensBuilder=void 0;const s=n(2655);Object.defineProperty(t,"SemanticTokensBuilder",{enumerable:!0,get:function(){return s.SemanticTokensBuilder}});const r=n(1276);i(n(4512),t);const a=n(1662);Object.defineProperty(t,"TextDocuments",{enumerable:!0,get:function(){return a.TextDocuments}});const c=n(20);var l;Object.defineProperty(t,"NotebookDocuments",{enumerable:!0,get:function(){return c.NotebookDocuments}}),i(n(7874),t),function(e){e.all={__brand:"features",languages:r.InlineCompletionFeature}}(l||(t.ProposedFeatures=l={}))},2874:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FoldingRangeRefreshRequest=t.FoldingRangeRequest=void 0;const o=n(372);var i,s;!function(e){e.method="textDocument/foldingRange",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.FoldingRangeRequest=i={})),function(e){e.method="workspace/foldingRange/refresh",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType0(e.method)}(s||(t.FoldingRangeRefreshRequest=s={}))},2936:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MonikerFeature=void 0;const o=n(4512);t.MonikerFeature=e=>class extends e{get moniker(){return{on:e=>{const t=o.MonikerRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))}}}}},2938:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.attachPartialResult=t.ProgressFeature=t.attachWorkDone=void 0;const o=n(4512),i=n(6116);class s{constructor(e,t){this._connection=e,this._token=t,s.Instances.set(this._token,this)}begin(e,t,n,i){let s={kind:"begin",title:e,percentage:t,message:n,cancellable:i};this._connection.sendProgress(o.WorkDoneProgress.type,this._token,s)}report(e,t){let n={kind:"report"};"number"==typeof e?(n.percentage=e,void 0!==t&&(n.message=t)):n.message=e,this._connection.sendProgress(o.WorkDoneProgress.type,this._token,n)}done(){s.Instances.delete(this._token),this._connection.sendProgress(o.WorkDoneProgress.type,this._token,{kind:"end"})}}s.Instances=new Map;class r extends s{constructor(e,t){super(e,t),this._source=new o.CancellationTokenSource}get token(){return this._source.token}done(){this._source.dispose(),super.done()}cancel(){this._source.cancel()}}class a{constructor(){}begin(){}report(){}done(){}}class c extends a{constructor(){super(),this._source=new o.CancellationTokenSource}get token(){return this._source.token}done(){this._source.dispose()}cancel(){this._source.cancel()}}var l;t.attachWorkDone=function(e,t){if(void 0===t||void 0===t.workDoneToken)return new a;const n=t.workDoneToken;return delete t.workDoneToken,new s(e,n)},t.ProgressFeature=e=>class extends e{constructor(){super(),this._progressSupported=!1}initialize(e){super.initialize(e),!0===e?.window?.workDoneProgress&&(this._progressSupported=!0,this.connection.onNotification(o.WorkDoneProgressCancelNotification.type,e=>{let t=s.Instances.get(e.token);(t instanceof r||t instanceof c)&&t.cancel()}))}attachWorkDoneProgress(e){return void 0===e?new a:new s(this.connection,e)}createWorkDoneProgress(){if(this._progressSupported){const e=(0,i.generateUuid)();return this.connection.sendRequest(o.WorkDoneProgressCreateRequest.type,{token:e}).then(()=>new r(this.connection,e))}return Promise.resolve(new c)}},function(e){e.type=new o.ProgressType}(l||(l={}));class u{constructor(e,t){this._connection=e,this._token=t}report(e){this._connection.sendProgress(l.type,this._token,e)}}t.attachPartialResult=function(e,t){if(void 0===t||void 0===t.partialResultToken)return;const n=t.partialResultToken;return delete t.partialResultToken,new u(e,n)}},3124:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InlineValueRefreshRequest=t.InlineValueRequest=void 0;const o=n(372);var i,s;!function(e){e.method="textDocument/inlineValue",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.InlineValueRequest=i={})),function(e){e.method="workspace/inlineValue/refresh",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType0(e.method)}(s||(t.InlineValueRefreshRequest=s={}))},3193:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteableStreamMessageWriter=t.AbstractMessageWriter=t.MessageWriter=void 0;const o=n(9590),i=n(8585),s=n(4323),r=n(2676);var a,c;!function(e){e.is=function(e){let t=e;return t&&i.func(t.dispose)&&i.func(t.onClose)&&i.func(t.onError)&&i.func(t.write)}}(a||(t.MessageWriter=a={}));class l{constructor(){this.errorEmitter=new r.Emitter,this.closeEmitter=new r.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${i.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageWriter=l,function(e){e.fromOptions=function(e){return void 0===e||"string"==typeof e?{charset:e??"utf-8",contentTypeEncoder:(0,o.default)().applicationJson.encoder}:{charset:e.charset??"utf-8",contentEncoder:e.contentEncoder,contentTypeEncoder:e.contentTypeEncoder??(0,o.default)().applicationJson.encoder}}}(c||(c={})),t.WriteableStreamMessageWriter=class extends l{constructor(e,t){super(),this.writable=e,this.options=c.fromOptions(t),this.errorCount=0,this.writeSemaphore=new s.Semaphore(1),this.writable.onError(e=>this.fireError(e)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(e=>void 0!==this.options.contentEncoder?this.options.contentEncoder.encode(e):e).then(t=>{const n=[];return n.push("Content-Length: ",t.byteLength.toString(),"\r\n"),n.push("\r\n"),this.doWrite(e,n,t)},e=>{throw this.fireError(e),e}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}}},3281:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressType=t.ProgressToken=t.createMessageConnection=t.NullLogger=t.ConnectionOptions=t.ConnectionStrategy=t.AbstractMessageBuffer=t.WriteableStreamMessageWriter=t.AbstractMessageWriter=t.MessageWriter=t.ReadableStreamMessageReader=t.AbstractMessageReader=t.MessageReader=t.SharedArrayReceiverStrategy=t.SharedArraySenderStrategy=t.CancellationToken=t.CancellationTokenSource=t.Emitter=t.Event=t.Disposable=t.LRUCache=t.Touch=t.LinkedMap=t.ParameterStructures=t.NotificationType9=t.NotificationType8=t.NotificationType7=t.NotificationType6=t.NotificationType5=t.NotificationType4=t.NotificationType3=t.NotificationType2=t.NotificationType1=t.NotificationType0=t.NotificationType=t.ErrorCodes=t.ResponseError=t.RequestType9=t.RequestType8=t.RequestType7=t.RequestType6=t.RequestType5=t.RequestType4=t.RequestType3=t.RequestType2=t.RequestType1=t.RequestType0=t.RequestType=t.Message=t.RAL=void 0,t.MessageStrategy=t.CancellationStrategy=t.CancellationSenderStrategy=t.CancellationReceiverStrategy=t.ConnectionError=t.ConnectionErrors=t.LogTraceNotification=t.SetTraceNotification=t.TraceFormat=t.TraceValues=t.Trace=void 0;const o=n(6177);Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return o.Message}}),Object.defineProperty(t,"RequestType",{enumerable:!0,get:function(){return o.RequestType}}),Object.defineProperty(t,"RequestType0",{enumerable:!0,get:function(){return o.RequestType0}}),Object.defineProperty(t,"RequestType1",{enumerable:!0,get:function(){return o.RequestType1}}),Object.defineProperty(t,"RequestType2",{enumerable:!0,get:function(){return o.RequestType2}}),Object.defineProperty(t,"RequestType3",{enumerable:!0,get:function(){return o.RequestType3}}),Object.defineProperty(t,"RequestType4",{enumerable:!0,get:function(){return o.RequestType4}}),Object.defineProperty(t,"RequestType5",{enumerable:!0,get:function(){return o.RequestType5}}),Object.defineProperty(t,"RequestType6",{enumerable:!0,get:function(){return o.RequestType6}}),Object.defineProperty(t,"RequestType7",{enumerable:!0,get:function(){return o.RequestType7}}),Object.defineProperty(t,"RequestType8",{enumerable:!0,get:function(){return o.RequestType8}}),Object.defineProperty(t,"RequestType9",{enumerable:!0,get:function(){return o.RequestType9}}),Object.defineProperty(t,"ResponseError",{enumerable:!0,get:function(){return o.ResponseError}}),Object.defineProperty(t,"ErrorCodes",{enumerable:!0,get:function(){return o.ErrorCodes}}),Object.defineProperty(t,"NotificationType",{enumerable:!0,get:function(){return o.NotificationType}}),Object.defineProperty(t,"NotificationType0",{enumerable:!0,get:function(){return o.NotificationType0}}),Object.defineProperty(t,"NotificationType1",{enumerable:!0,get:function(){return o.NotificationType1}}),Object.defineProperty(t,"NotificationType2",{enumerable:!0,get:function(){return o.NotificationType2}}),Object.defineProperty(t,"NotificationType3",{enumerable:!0,get:function(){return o.NotificationType3}}),Object.defineProperty(t,"NotificationType4",{enumerable:!0,get:function(){return o.NotificationType4}}),Object.defineProperty(t,"NotificationType5",{enumerable:!0,get:function(){return o.NotificationType5}}),Object.defineProperty(t,"NotificationType6",{enumerable:!0,get:function(){return o.NotificationType6}}),Object.defineProperty(t,"NotificationType7",{enumerable:!0,get:function(){return o.NotificationType7}}),Object.defineProperty(t,"NotificationType8",{enumerable:!0,get:function(){return o.NotificationType8}}),Object.defineProperty(t,"NotificationType9",{enumerable:!0,get:function(){return o.NotificationType9}}),Object.defineProperty(t,"ParameterStructures",{enumerable:!0,get:function(){return o.ParameterStructures}});const i=n(3352);Object.defineProperty(t,"LinkedMap",{enumerable:!0,get:function(){return i.LinkedMap}}),Object.defineProperty(t,"LRUCache",{enumerable:!0,get:function(){return i.LRUCache}}),Object.defineProperty(t,"Touch",{enumerable:!0,get:function(){return i.Touch}});const s=n(4019);Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return s.Disposable}});const r=n(2676);Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return r.Event}}),Object.defineProperty(t,"Emitter",{enumerable:!0,get:function(){return r.Emitter}});const a=n(9850);Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return a.CancellationTokenSource}}),Object.defineProperty(t,"CancellationToken",{enumerable:!0,get:function(){return a.CancellationToken}});const c=n(4996);Object.defineProperty(t,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return c.SharedArraySenderStrategy}}),Object.defineProperty(t,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return c.SharedArrayReceiverStrategy}});const l=n(9085);Object.defineProperty(t,"MessageReader",{enumerable:!0,get:function(){return l.MessageReader}}),Object.defineProperty(t,"AbstractMessageReader",{enumerable:!0,get:function(){return l.AbstractMessageReader}}),Object.defineProperty(t,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return l.ReadableStreamMessageReader}});const u=n(3193);Object.defineProperty(t,"MessageWriter",{enumerable:!0,get:function(){return u.MessageWriter}}),Object.defineProperty(t,"AbstractMessageWriter",{enumerable:!0,get:function(){return u.AbstractMessageWriter}}),Object.defineProperty(t,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return u.WriteableStreamMessageWriter}});const h=n(9244);Object.defineProperty(t,"AbstractMessageBuffer",{enumerable:!0,get:function(){return h.AbstractMessageBuffer}});const d=n(577);Object.defineProperty(t,"ConnectionStrategy",{enumerable:!0,get:function(){return d.ConnectionStrategy}}),Object.defineProperty(t,"ConnectionOptions",{enumerable:!0,get:function(){return d.ConnectionOptions}}),Object.defineProperty(t,"NullLogger",{enumerable:!0,get:function(){return d.NullLogger}}),Object.defineProperty(t,"createMessageConnection",{enumerable:!0,get:function(){return d.createMessageConnection}}),Object.defineProperty(t,"ProgressToken",{enumerable:!0,get:function(){return d.ProgressToken}}),Object.defineProperty(t,"ProgressType",{enumerable:!0,get:function(){return d.ProgressType}}),Object.defineProperty(t,"Trace",{enumerable:!0,get:function(){return d.Trace}}),Object.defineProperty(t,"TraceValues",{enumerable:!0,get:function(){return d.TraceValues}}),Object.defineProperty(t,"TraceFormat",{enumerable:!0,get:function(){return d.TraceFormat}}),Object.defineProperty(t,"SetTraceNotification",{enumerable:!0,get:function(){return d.SetTraceNotification}}),Object.defineProperty(t,"LogTraceNotification",{enumerable:!0,get:function(){return d.LogTraceNotification}}),Object.defineProperty(t,"ConnectionErrors",{enumerable:!0,get:function(){return d.ConnectionErrors}}),Object.defineProperty(t,"ConnectionError",{enumerable:!0,get:function(){return d.ConnectionError}}),Object.defineProperty(t,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return d.CancellationReceiverStrategy}}),Object.defineProperty(t,"CancellationSenderStrategy",{enumerable:!0,get:function(){return d.CancellationSenderStrategy}}),Object.defineProperty(t,"CancellationStrategy",{enumerable:!0,get:function(){return d.CancellationStrategy}}),Object.defineProperty(t,"MessageStrategy",{enumerable:!0,get:function(){return d.MessageStrategy}});const p=n(9590);t.RAL=p.default},3307:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InlineCompletionRequest=void 0;const o=n(372);var i;!function(e){e.method="textDocument/inlineCompletion",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.InlineCompletionRequest=i={}))},3352:(e,t)=>{var n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=t.LinkedMap=t.Touch=void 0,function(e){e.None=0,e.First=1,e.AsOld=e.First,e.Last=2,e.AsNew=e.Last}(o||(t.Touch=o={}));class i{constructor(){this[n]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=o.None){const n=this._map.get(e);if(n)return t!==o.None&&this.touch(n,t),n.value}set(e,t,n=o.None){let i=this._map.get(e);if(i)i.value=t,n!==o.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case o.None:this.addItemLast(i);break;case o.First:this.addItemFirst(i);break;case o.Last:default:this.addItemLast(i)}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){const t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){const n=this._state;let o=this._head;for(;o;){if(t?e.bind(t)(o.value,o.key,this):e(o.value,o.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");o=o.next}}keys(){const e=this._state;let t=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:t.key,done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return n}values(){const e=this._state;let t=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:t.value,done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return n}entries(){const e=this._state;let t=this._head;const n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){const e={value:[t.key,t.value],done:!1};return t=t.next,e}return{value:void 0,done:!0}}};return n}[(n=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(0===e)return void this.clear();let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e,this._state++}addItemLast(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(t===o.First||t===o.Last)if(t===o.First){if(e===this._head)return;const t=e.next,n=e.previous;e===this._tail?(n.next=void 0,this._tail=n):(t.previous=n,n.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===o.Last){if(e===this._tail)return;const t=e.next,n=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=n,n.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}toJSON(){const e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(const[t,n]of e)this.set(t,n)}}t.LinkedMap=i,t.LRUCache=class extends i{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=o.AsNew){return super.get(e,t)}peek(e){return super.get(e,o.None)}set(e,t){return super.set(e,t,o.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}},3487:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionRangeRequest=void 0;const o=n(372);var i;!function(e){e.method="textDocument/selectionRange",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.SelectionRangeRequest=i={}))},3557:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DidCloseNotebookDocumentNotification=t.DidSaveNotebookDocumentNotification=t.DidChangeNotebookDocumentNotification=t.NotebookCellArrayChange=t.DidOpenNotebookDocumentNotification=t.NotebookDocumentSyncRegistrationType=t.NotebookDocument=t.NotebookCell=t.ExecutionSummary=t.NotebookCellKind=void 0;const o=n(6203),i=n(8598),s=n(372);var r,a,c,l,u,h,d,p,m,_;!function(e){e.Markup=1,e.Code=2,e.is=function(e){return 1===e||2===e}}(r||(t.NotebookCellKind=r={})),function(e){e.create=function(e,t){const n={executionOrder:e};return!0!==t&&!1!==t||(n.success=t),n},e.is=function(e){const t=e;return i.objectLiteral(t)&&o.uinteger.is(t.executionOrder)&&(void 0===t.success||i.boolean(t.success))},e.equals=function(e,t){return e===t||null!=e&&null!=t&&e.executionOrder===t.executionOrder&&e.success===t.success}}(a||(t.ExecutionSummary=a={})),function(e){function t(e,n){if(e===n)return!0;if(null==e||null==n)return!1;if(typeof e!=typeof n)return!1;if("object"!=typeof e)return!1;const o=Array.isArray(e),s=Array.isArray(n);if(o!==s)return!1;if(o&&s){if(e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!t(e[o],n[o]))return!1}if(i.objectLiteral(e)&&i.objectLiteral(n)){const o=Object.keys(e),i=Object.keys(n);if(o.length!==i.length)return!1;if(o.sort(),i.sort(),!t(o,i))return!1;for(let i=0;i<o.length;i++){const s=o[i];if(!t(e[s],n[s]))return!1}}return!0}e.create=function(e,t){return{kind:e,document:t}},e.is=function(e){const t=e;return i.objectLiteral(t)&&r.is(t.kind)&&o.DocumentUri.is(t.document)&&(void 0===t.metadata||i.objectLiteral(t.metadata))},e.diff=function(e,n){const o=new Set;return e.document!==n.document&&o.add("document"),e.kind!==n.kind&&o.add("kind"),e.executionSummary!==n.executionSummary&&o.add("executionSummary"),void 0===e.metadata&&void 0===n.metadata||t(e.metadata,n.metadata)||o.add("metadata"),void 0===e.executionSummary&&void 0===n.executionSummary||a.equals(e.executionSummary,n.executionSummary)||o.add("executionSummary"),o}}(c||(t.NotebookCell=c={})),function(e){e.create=function(e,t,n,o){return{uri:e,notebookType:t,version:n,cells:o}},e.is=function(e){const t=e;return i.objectLiteral(t)&&i.string(t.uri)&&o.integer.is(t.version)&&i.typedArray(t.cells,c.is)}}(l||(t.NotebookDocument=l={})),function(e){e.method="notebookDocument/sync",e.messageDirection=s.MessageDirection.clientToServer,e.type=new s.RegistrationType(e.method)}(u||(t.NotebookDocumentSyncRegistrationType=u={})),function(e){e.method="notebookDocument/didOpen",e.messageDirection=s.MessageDirection.clientToServer,e.type=new s.ProtocolNotificationType(e.method),e.registrationMethod=u.method}(h||(t.DidOpenNotebookDocumentNotification=h={})),function(e){e.is=function(e){const t=e;return i.objectLiteral(t)&&o.uinteger.is(t.start)&&o.uinteger.is(t.deleteCount)&&(void 0===t.cells||i.typedArray(t.cells,c.is))},e.create=function(e,t,n){const o={start:e,deleteCount:t};return void 0!==n&&(o.cells=n),o}}(d||(t.NotebookCellArrayChange=d={})),function(e){e.method="notebookDocument/didChange",e.messageDirection=s.MessageDirection.clientToServer,e.type=new s.ProtocolNotificationType(e.method),e.registrationMethod=u.method}(p||(t.DidChangeNotebookDocumentNotification=p={})),function(e){e.method="notebookDocument/didSave",e.messageDirection=s.MessageDirection.clientToServer,e.type=new s.ProtocolNotificationType(e.method),e.registrationMethod=u.method}(m||(t.DidSaveNotebookDocumentNotification=m={})),function(e){e.method="notebookDocument/didClose",e.messageDirection=s.MessageDirection.clientToServer,e.type=new s.ProtocolNotificationType(e.method),e.registrationMethod=u.method}(_||(t.DidCloseNotebookDocumentNotification=_={}))},3918:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallHierarchyFeature=void 0;const o=n(4512);t.CallHierarchyFeature=e=>class extends e{get callHierarchy(){return{onPrepare:e=>this.connection.onRequest(o.CallHierarchyPrepareRequest.type,(t,n)=>e(t,n,this.attachWorkDoneProgress(t),void 0)),onIncomingCalls:e=>{const t=o.CallHierarchyIncomingCallsRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))},onOutgoingCalls:e=>{const t=o.CallHierarchyOutgoingCallsRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))}}}}},4019:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Disposable=void 0,function(e){e.create=function(e){return{dispose:e}}}(n||(t.Disposable=n={}))},4323:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;const o=n(9590);t.Semaphore=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){0!==this._waiting.length&&this._active!==this._capacity&&(0,o.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(0===this._waiting.length||this._active===this._capacity)return;const e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{const t=e.thunk();t instanceof Promise?t.then(t=>{this._active--,e.resolve(t),this.runNext()},t=>{this._active--,e.reject(t),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}}},4512:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.createProtocolConnection=void 0;const s=n(6087);i(n(6087),t),i(n(8766),t),t.createProtocolConnection=function(e,t,n,o){return(0,s.createMessageConnection)(e,t,n,o)}},4615:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=n(3281);class i extends o.AbstractMessageBuffer{constructor(e="utf-8"){super(e),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return i.emptyBuffer}fromString(e,t){return(new TextEncoder).encode(e)}toString(e,t){return"ascii"===t?this.asciiDecoder.decode(e):new TextDecoder(t).decode(e)}asNative(e,t){return void 0===t?e:e.slice(0,t)}allocNative(e){return new Uint8Array(e)}}i.emptyBuffer=new Uint8Array(0);class s{constructor(e){this.socket=e,this._onData=new o.Emitter,this._messageListener=e=>{e.data.arrayBuffer().then(e=>{this._onData.fire(new Uint8Array(e))},()=>{(0,o.RAL)().console.error("Converting blob to array buffer failed.")})},this.socket.addEventListener("message",this._messageListener)}onClose(e){return this.socket.addEventListener("close",e),o.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),o.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),o.Disposable.create(()=>this.socket.removeEventListener("end",e))}onData(e){return this._onData.event(e)}}class r{constructor(e){this.socket=e}onClose(e){return this.socket.addEventListener("close",e),o.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),o.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),o.Disposable.create(()=>this.socket.removeEventListener("end",e))}write(e,t){if("string"==typeof e){if(void 0!==t&&"utf-8"!==t)throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${t}`);this.socket.send(e)}else this.socket.send(e);return Promise.resolve()}end(){this.socket.close()}}const a=new TextEncoder,c=Object.freeze({messageBuffer:Object.freeze({create:e=>new i(e)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(e,t)=>{if("utf-8"!==t.charset)throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${t.charset}`);return Promise.resolve(a.encode(JSON.stringify(e,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(e,t)=>{if(!(e instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(t.charset).decode(e)))}})}),stream:Object.freeze({asReadableStream:e=>new s(e),asWritableStream:e=>new r(e)}),console,timer:Object.freeze({setTimeout(e,t,...n){const o=setTimeout(e,t,...n);return{dispose:()=>clearTimeout(o)}},setImmediate(e,...t){const n=setTimeout(e,0,...t);return{dispose:()=>clearTimeout(n)}},setInterval(e,t,...n){const o=setInterval(e,t,...n);return{dispose:()=>clearInterval(o)}}})});function l(){return c}!function(e){e.install=function(){o.RAL.install(c)}}(l||(l={})),t.default=l},4635:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InlayHintFeature=void 0;const o=n(4512);t.InlayHintFeature=e=>class extends e{get inlayHint(){return{refresh:()=>this.connection.sendRequest(o.InlayHintRefreshRequest.type),on:e=>this.connection.onRequest(o.InlayHintRequest.type,(t,n)=>e(t,n,this.attachWorkDoneProgress(t))),resolve:e=>this.connection.onRequest(o.InlayHintResolveRequest.type,(t,n)=>e(t,n))}}}},4996:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SharedArrayReceiverStrategy=t.SharedArraySenderStrategy=void 0;const o=n(9850);var i;!function(e){e.Continue=0,e.Cancelled=1}(i||(i={})),t.SharedArraySenderStrategy=class{constructor(){this.buffers=new Map}enableCancellation(e){if(null===e.id)return;const t=new SharedArrayBuffer(4);new Int32Array(t,0,1)[0]=i.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){const n=this.buffers.get(t);if(void 0===n)return;const o=new Int32Array(n,0,1);Atomics.store(o,0,i.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};class s{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===i.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}}class r{constructor(e){this.token=new s(e)}cancel(){}dispose(){}}t.SharedArrayReceiverStrategy=class{constructor(){this.kind="request"}createCancellationTokenSource(e){const t=e.$cancellationData;return void 0===t?new o.CancellationTokenSource:new r(t)}}},5026:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TypeHierarchyFeature=void 0;const o=n(4512);t.TypeHierarchyFeature=e=>class extends e{get typeHierarchy(){return{onPrepare:e=>this.connection.onRequest(o.TypeHierarchyPrepareRequest.type,(t,n)=>e(t,n,this.attachWorkDoneProgress(t),void 0)),onSupertypes:e=>{const t=o.TypeHierarchySupertypesRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))},onSubtypes:e=>{const t=o.TypeHierarchySubtypesRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))}}}}},5316:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedEditingRangeRequest=void 0;const o=n(372);var i;!function(e){e.method="textDocument/linkedEditingRange",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.LinkedEditingRangeRequest=i={}))},5678:(e,t,n)=>{e.exports=n(4512)},6007:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FoldingRangeFeature=void 0;const o=n(4512);t.FoldingRangeFeature=e=>class extends e{get foldingRange(){return{refresh:()=>this.connection.sendRequest(o.FoldingRangeRefreshRequest.type),on:e=>{const t=o.FoldingRangeRequest.type;return this.connection.onRequest(t,(n,o)=>e(n,o,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(t,n)))}}}}},6011:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagnosticRefreshRequest=t.WorkspaceDiagnosticRequest=t.DocumentDiagnosticRequest=t.DocumentDiagnosticReportKind=t.DiagnosticServerCancellationData=void 0;const o=n(6439),i=n(8598),s=n(372);var r,a,c,l,u;!function(e){e.is=function(e){const t=e;return t&&i.boolean(t.retriggerRequest)}}(r||(t.DiagnosticServerCancellationData=r={})),function(e){e.Full="full",e.Unchanged="unchanged"}(a||(t.DocumentDiagnosticReportKind=a={})),function(e){e.method="textDocument/diagnostic",e.messageDirection=s.MessageDirection.clientToServer,e.type=new s.ProtocolRequestType(e.method),e.partialResult=new o.ProgressType}(c||(t.DocumentDiagnosticRequest=c={})),function(e){e.method="workspace/diagnostic",e.messageDirection=s.MessageDirection.clientToServer,e.type=new s.ProtocolRequestType(e.method),e.partialResult=new o.ProgressType}(l||(t.WorkspaceDiagnosticRequest=l={})),function(e){e.method="workspace/diagnostic/refresh",e.messageDirection=s.MessageDirection.serverToClient,e.type=new s.ProtocolRequestType0(e.method)}(u||(t.DiagnosticRefreshRequest=u={}))},6087:(e,t,n)=>{e.exports=n(6439)},6116:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateUuid=t.parse=t.isUUID=t.v4=t.empty=void 0;class n{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}}class o extends n{static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return o._oneOf(o._chars)}constructor(){super([o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),"-",o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),"-","4",o._randomHex(),o._randomHex(),o._randomHex(),"-",o._oneOf(o._timeHighBits),o._randomHex(),o._randomHex(),o._randomHex(),"-",o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex(),o._randomHex()].join(""))}}function i(){return new o}o._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"],o._timeHighBits=["8","9","a","b"],t.empty=new n("00000000-0000-0000-0000-000000000000"),t.v4=i;const s=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function r(e){return s.test(e)}t.isUUID=r,t.parse=function(e){if(!r(e))throw new Error("invalid uuid");return new n(e)},t.generateUuid=function(){return i().asHex()}},6177:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Message=t.NotificationType9=t.NotificationType8=t.NotificationType7=t.NotificationType6=t.NotificationType5=t.NotificationType4=t.NotificationType3=t.NotificationType2=t.NotificationType1=t.NotificationType0=t.NotificationType=t.RequestType9=t.RequestType8=t.RequestType7=t.RequestType6=t.RequestType5=t.RequestType4=t.RequestType3=t.RequestType2=t.RequestType1=t.RequestType=t.RequestType0=t.AbstractMessageSignature=t.ParameterStructures=t.ResponseError=t.ErrorCodes=void 0;const o=n(8585);var i,s;!function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.jsonrpcReservedErrorRangeStart=-32099,e.serverErrorStart=-32099,e.MessageWriteError=-32099,e.MessageReadError=-32098,e.PendingResponseRejected=-32097,e.ConnectionInactive=-32096,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.jsonrpcReservedErrorRangeEnd=-32e3,e.serverErrorEnd=-32e3}(i||(t.ErrorCodes=i={}));class r extends Error{constructor(e,t,n){super(t),this.code=o.number(e)?e:i.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){const e={code:this.code,message:this.message};return void 0!==this.data&&(e.data=this.data),e}}t.ResponseError=r;class a{constructor(e){this.kind=e}static is(e){return e===a.auto||e===a.byName||e===a.byPosition}toString(){return this.kind}}t.ParameterStructures=a,a.auto=new a("auto"),a.byPosition=new a("byPosition"),a.byName=new a("byName");class c{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return a.auto}}t.AbstractMessageSignature=c,t.RequestType0=class extends c{constructor(e){super(e,0)}},t.RequestType=class extends c{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.RequestType1=class extends c{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.RequestType2=class extends c{constructor(e){super(e,2)}},t.RequestType3=class extends c{constructor(e){super(e,3)}},t.RequestType4=class extends c{constructor(e){super(e,4)}},t.RequestType5=class extends c{constructor(e){super(e,5)}},t.RequestType6=class extends c{constructor(e){super(e,6)}},t.RequestType7=class extends c{constructor(e){super(e,7)}},t.RequestType8=class extends c{constructor(e){super(e,8)}},t.RequestType9=class extends c{constructor(e){super(e,9)}},t.NotificationType=class extends c{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.NotificationType0=class extends c{constructor(e){super(e,0)}},t.NotificationType1=class extends c{constructor(e,t=a.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}},t.NotificationType2=class extends c{constructor(e){super(e,2)}},t.NotificationType3=class extends c{constructor(e){super(e,3)}},t.NotificationType4=class extends c{constructor(e){super(e,4)}},t.NotificationType5=class extends c{constructor(e){super(e,5)}},t.NotificationType6=class extends c{constructor(e){super(e,6)}},t.NotificationType7=class extends c{constructor(e){super(e,7)}},t.NotificationType8=class extends c{constructor(e){super(e,8)}},t.NotificationType9=class extends c{constructor(e){super(e,9)}},function(e){e.isRequest=function(e){const t=e;return t&&o.string(t.method)&&(o.string(t.id)||o.number(t.id))},e.isNotification=function(e){const t=e;return t&&o.string(t.method)&&void 0===e.id},e.isResponse=function(e){const t=e;return t&&(void 0!==t.result||!!t.error)&&(o.string(t.id)||o.number(t.id)||null===t.id)}}(s||(t.Message=s={}))},6203:(e,t,n)=>{var o,i,s,r,a,c,l,u,h,d,p,m,_,g,f,T,S,E,y,O,P,C,R,k,D,N,b,A,x,v,M,L,w,I,q,F,B,U,Y,j,W,K,V,H,G,Z,$,z,Q,J,X,ee,te,ne,oe,ie,se,re,ae,ce,le,ue,he,de,pe,me,_e,ge,fe,Te,Se,Ee,ye,Oe,Pe,Ce,Re,ke;n.r(t),n.d(t,{AnnotatedTextEdit:()=>R,ChangeAnnotation:()=>P,ChangeAnnotationIdentifier:()=>C,CodeAction:()=>se,CodeActionContext:()=>ie,CodeActionKind:()=>ne,CodeActionTriggerKind:()=>oe,CodeDescription:()=>S,CodeLens:()=>re,Color:()=>h,ColorInformation:()=>d,ColorPresentation:()=>p,Command:()=>y,CompletionItem:()=>W,CompletionItemKind:()=>q,CompletionItemLabelDetails:()=>j,CompletionItemTag:()=>B,CompletionList:()=>K,CreateFile:()=>D,DeleteFile:()=>b,Diagnostic:()=>E,DiagnosticRelatedInformation:()=>g,DiagnosticSeverity:()=>f,DiagnosticTag:()=>T,DocumentHighlight:()=>z,DocumentHighlightKind:()=>$,DocumentLink:()=>ce,DocumentSymbol:()=>te,DocumentUri:()=>o,EOL:()=>Ae,FoldingRange:()=>_,FoldingRangeKind:()=>m,FormattingOptions:()=>ae,Hover:()=>H,InlayHint:()=>Se,InlayHintKind:()=>fe,InlayHintLabelPart:()=>Te,InlineCompletionContext:()=>Re,InlineCompletionItem:()=>ye,InlineCompletionList:()=>Oe,InlineCompletionTriggerKind:()=>Pe,InlineValueContext:()=>ge,InlineValueEvaluatableExpression:()=>_e,InlineValueText:()=>pe,InlineValueVariableLookup:()=>me,InsertReplaceEdit:()=>U,InsertTextFormat:()=>F,InsertTextMode:()=>Y,Location:()=>l,LocationLink:()=>u,MarkedString:()=>V,MarkupContent:()=>I,MarkupKind:()=>w,OptionalVersionedTextDocumentIdentifier:()=>M,ParameterInformation:()=>G,Position:()=>a,Range:()=>c,RenameFile:()=>N,SelectedCompletionInfo:()=>Ce,SelectionRange:()=>le,SemanticTokenModifiers:()=>he,SemanticTokenTypes:()=>ue,SemanticTokens:()=>de,SignatureInformation:()=>Z,StringValue:()=>Ee,SymbolInformation:()=>X,SymbolKind:()=>Q,SymbolTag:()=>J,TextDocument:()=>xe,TextDocumentEdit:()=>k,TextDocumentIdentifier:()=>x,TextDocumentItem:()=>L,TextEdit:()=>O,URI:()=>i,VersionedTextDocumentIdentifier:()=>v,WorkspaceChange:()=>be,WorkspaceEdit:()=>A,WorkspaceFolder:()=>ke,WorkspaceSymbol:()=>ee,integer:()=>s,uinteger:()=>r}),function(e){e.is=function(e){return"string"==typeof e}}(o||(o={})),function(e){e.is=function(e){return"string"==typeof e}}(i||(i={})),function(e){e.MIN_VALUE=-2147483648,e.MAX_VALUE=2147483647,e.is=function(t){return"number"==typeof t&&e.MIN_VALUE<=t&&t<=e.MAX_VALUE}}(s||(s={})),function(e){e.MIN_VALUE=0,e.MAX_VALUE=2147483647,e.is=function(t){return"number"==typeof t&&e.MIN_VALUE<=t&&t<=e.MAX_VALUE}}(r||(r={})),function(e){e.create=function(e,t){return e===Number.MAX_VALUE&&(e=r.MAX_VALUE),t===Number.MAX_VALUE&&(t=r.MAX_VALUE),{line:e,character:t}},e.is=function(e){let t=e;return ve.objectLiteral(t)&&ve.uinteger(t.line)&&ve.uinteger(t.character)}}(a||(a={})),function(e){e.create=function(e,t,n,o){if(ve.uinteger(e)&&ve.uinteger(t)&&ve.uinteger(n)&&ve.uinteger(o))return{start:a.create(e,t),end:a.create(n,o)};if(a.is(e)&&a.is(t))return{start:e,end:t};throw new Error(`Range#create called with invalid arguments[${e}, ${t}, ${n}, ${o}]`)},e.is=function(e){let t=e;return ve.objectLiteral(t)&&a.is(t.start)&&a.is(t.end)}}(c||(c={})),function(e){e.create=function(e,t){return{uri:e,range:t}},e.is=function(e){let t=e;return ve.objectLiteral(t)&&c.is(t.range)&&(ve.string(t.uri)||ve.undefined(t.uri))}}(l||(l={})),function(e){e.create=function(e,t,n,o){return{targetUri:e,targetRange:t,targetSelectionRange:n,originSelectionRange:o}},e.is=function(e){let t=e;return ve.objectLiteral(t)&&c.is(t.targetRange)&&ve.string(t.targetUri)&&c.is(t.targetSelectionRange)&&(c.is(t.originSelectionRange)||ve.undefined(t.originSelectionRange))}}(u||(u={})),function(e){e.create=function(e,t,n,o){return{red:e,green:t,blue:n,alpha:o}},e.is=function(e){const t=e;return ve.objectLiteral(t)&&ve.numberRange(t.red,0,1)&&ve.numberRange(t.green,0,1)&&ve.numberRange(t.blue,0,1)&&ve.numberRange(t.alpha,0,1)}}(h||(h={})),function(e){e.create=function(e,t){return{range:e,color:t}},e.is=function(e){const t=e;return ve.objectLiteral(t)&&c.is(t.range)&&h.is(t.color)}}(d||(d={})),function(e){e.create=function(e,t,n){return{label:e,textEdit:t,additionalTextEdits:n}},e.is=function(e){const t=e;return ve.objectLiteral(t)&&ve.string(t.label)&&(ve.undefined(t.textEdit)||O.is(t))&&(ve.undefined(t.additionalTextEdits)||ve.typedArray(t.additionalTextEdits,O.is))}}(p||(p={})),function(e){e.Comment="comment",e.Imports="imports",e.Region="region"}(m||(m={})),function(e){e.create=function(e,t,n,o,i,s){const r={startLine:e,endLine:t};return ve.defined(n)&&(r.startCharacter=n),ve.defined(o)&&(r.endCharacter=o),ve.defined(i)&&(r.kind=i),ve.defined(s)&&(r.collapsedText=s),r},e.is=function(e){const t=e;return ve.objectLiteral(t)&&ve.uinteger(t.startLine)&&ve.uinteger(t.startLine)&&(ve.undefined(t.startCharacter)||ve.uinteger(t.startCharacter))&&(ve.undefined(t.endCharacter)||ve.uinteger(t.endCharacter))&&(ve.undefined(t.kind)||ve.string(t.kind))}}(_||(_={})),function(e){e.create=function(e,t){return{location:e,message:t}},e.is=function(e){let t=e;return ve.defined(t)&&l.is(t.location)&&ve.string(t.message)}}(g||(g={})),function(e){e.Error=1,e.Warning=2,e.Information=3,e.Hint=4}(f||(f={})),function(e){e.Unnecessary=1,e.Deprecated=2}(T||(T={})),function(e){e.is=function(e){const t=e;return ve.objectLiteral(t)&&ve.string(t.href)}}(S||(S={})),function(e){e.create=function(e,t,n,o,i,s){let r={range:e,message:t};return ve.defined(n)&&(r.severity=n),ve.defined(o)&&(r.code=o),ve.defined(i)&&(r.source=i),ve.defined(s)&&(r.relatedInformation=s),r},e.is=function(e){var t;let n=e;return ve.defined(n)&&c.is(n.range)&&ve.string(n.message)&&(ve.number(n.severity)||ve.undefined(n.severity))&&(ve.integer(n.code)||ve.string(n.code)||ve.undefined(n.code))&&(ve.undefined(n.codeDescription)||ve.string(null===(t=n.codeDescription)||void 0===t?void 0:t.href))&&(ve.string(n.source)||ve.undefined(n.source))&&(ve.undefined(n.relatedInformation)||ve.typedArray(n.relatedInformation,g.is))}}(E||(E={})),function(e){e.create=function(e,t,...n){let o={title:e,command:t};return ve.defined(n)&&n.length>0&&(o.arguments=n),o},e.is=function(e){let t=e;return ve.defined(t)&&ve.string(t.title)&&ve.string(t.command)}}(y||(y={})),function(e){e.replace=function(e,t){return{range:e,newText:t}},e.insert=function(e,t){return{range:{start:e,end:e},newText:t}},e.del=function(e){return{range:e,newText:""}},e.is=function(e){const t=e;return ve.objectLiteral(t)&&ve.string(t.newText)&&c.is(t.range)}}(O||(O={})),function(e){e.create=function(e,t,n){const o={label:e};return void 0!==t&&(o.needsConfirmation=t),void 0!==n&&(o.description=n),o},e.is=function(e){const t=e;return ve.objectLiteral(t)&&ve.string(t.label)&&(ve.boolean(t.needsConfirmation)||void 0===t.needsConfirmation)&&(ve.string(t.description)||void 0===t.description)}}(P||(P={})),function(e){e.is=function(e){const t=e;return ve.string(t)}}(C||(C={})),function(e){e.replace=function(e,t,n){return{range:e,newText:t,annotationId:n}},e.insert=function(e,t,n){return{range:{start:e,end:e},newText:t,annotationId:n}},e.del=function(e,t){return{range:e,newText:"",annotationId:t}},e.is=function(e){const t=e;return O.is(t)&&(P.is(t.annotationId)||C.is(t.annotationId))}}(R||(R={})),function(e){e.create=function(e,t){return{textDocument:e,edits:t}},e.is=function(e){let t=e;return ve.defined(t)&&M.is(t.textDocument)&&Array.isArray(t.edits)}}(k||(k={})),function(e){e.create=function(e,t,n){let o={kind:"create",uri:e};return void 0===t||void 0===t.overwrite&&void 0===t.ignoreIfExists||(o.options=t),void 0!==n&&(o.annotationId=n),o},e.is=function(e){let t=e;return t&&"create"===t.kind&&ve.string(t.uri)&&(void 0===t.options||(void 0===t.options.overwrite||ve.boolean(t.options.overwrite))&&(void 0===t.options.ignoreIfExists||ve.boolean(t.options.ignoreIfExists)))&&(void 0===t.annotationId||C.is(t.annotationId))}}(D||(D={})),function(e){e.create=function(e,t,n,o){let i={kind:"rename",oldUri:e,newUri:t};return void 0===n||void 0===n.overwrite&&void 0===n.ignoreIfExists||(i.options=n),void 0!==o&&(i.annotationId=o),i},e.is=function(e){let t=e;return t&&"rename"===t.kind&&ve.string(t.oldUri)&&ve.string(t.newUri)&&(void 0===t.options||(void 0===t.options.overwrite||ve.boolean(t.options.overwrite))&&(void 0===t.options.ignoreIfExists||ve.boolean(t.options.ignoreIfExists)))&&(void 0===t.annotationId||C.is(t.annotationId))}}(N||(N={})),function(e){e.create=function(e,t,n){let o={kind:"delete",uri:e};return void 0===t||void 0===t.recursive&&void 0===t.ignoreIfNotExists||(o.options=t),void 0!==n&&(o.annotationId=n),o},e.is=function(e){let t=e;return t&&"delete"===t.kind&&ve.string(t.uri)&&(void 0===t.options||(void 0===t.options.recursive||ve.boolean(t.options.recursive))&&(void 0===t.options.ignoreIfNotExists||ve.boolean(t.options.ignoreIfNotExists)))&&(void 0===t.annotationId||C.is(t.annotationId))}}(b||(b={})),function(e){e.is=function(e){let t=e;return t&&(void 0!==t.changes||void 0!==t.documentChanges)&&(void 0===t.documentChanges||t.documentChanges.every(e=>ve.string(e.kind)?D.is(e)||N.is(e)||b.is(e):k.is(e)))}}(A||(A={}));class De{constructor(e,t){this.edits=e,this.changeAnnotations=t}insert(e,t,n){let o,i;if(void 0===n?o=O.insert(e,t):C.is(n)?(i=n,o=R.insert(e,t,n)):(this.assertChangeAnnotations(this.changeAnnotations),i=this.changeAnnotations.manage(n),o=R.insert(e,t,i)),this.edits.push(o),void 0!==i)return i}replace(e,t,n){let o,i;if(void 0===n?o=O.replace(e,t):C.is(n)?(i=n,o=R.replace(e,t,n)):(this.assertChangeAnnotations(this.changeAnnotations),i=this.changeAnnotations.manage(n),o=R.replace(e,t,i)),this.edits.push(o),void 0!==i)return i}delete(e,t){let n,o;if(void 0===t?n=O.del(e):C.is(t)?(o=t,n=R.del(e,t)):(this.assertChangeAnnotations(this.changeAnnotations),o=this.changeAnnotations.manage(t),n=R.del(e,o)),this.edits.push(n),void 0!==o)return o}add(e){this.edits.push(e)}all(){return this.edits}clear(){this.edits.splice(0,this.edits.length)}assertChangeAnnotations(e){if(void 0===e)throw new Error("Text edit change is not configured to manage change annotations.")}}class Ne{constructor(e){this._annotations=void 0===e?Object.create(null):e,this._counter=0,this._size=0}all(){return this._annotations}get size(){return this._size}manage(e,t){let n;if(C.is(e)?n=e:(n=this.nextId(),t=e),void 0!==this._annotations[n])throw new Error(`Id ${n} is already in use.`);if(void 0===t)throw new Error(`No annotation provided for id ${n}`);return this._annotations[n]=t,this._size++,n}nextId(){return this._counter++,this._counter.toString()}}class be{constructor(e){this._textEditChanges=Object.create(null),void 0!==e?(this._workspaceEdit=e,e.documentChanges?(this._changeAnnotations=new Ne(e.changeAnnotations),e.changeAnnotations=this._changeAnnotations.all(),e.documentChanges.forEach(e=>{if(k.is(e)){const t=new De(e.edits,this._changeAnnotations);this._textEditChanges[e.textDocument.uri]=t}})):e.changes&&Object.keys(e.changes).forEach(t=>{const n=new De(e.changes[t]);this._textEditChanges[t]=n})):this._workspaceEdit={}}get edit(){return this.initDocumentChanges(),void 0!==this._changeAnnotations&&(0===this._changeAnnotations.size?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit}getTextEditChange(e){if(M.is(e)){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");const t={uri:e.uri,version:e.version};let n=this._textEditChanges[t.uri];if(!n){const e=[],o={textDocument:t,edits:e};this._workspaceEdit.documentChanges.push(o),n=new De(e,this._changeAnnotations),this._textEditChanges[t.uri]=n}return n}{if(this.initChanges(),void 0===this._workspaceEdit.changes)throw new Error("Workspace edit is not configured for normal text edit changes.");let t=this._textEditChanges[e];if(!t){let n=[];this._workspaceEdit.changes[e]=n,t=new De(n),this._textEditChanges[e]=t}return t}}initDocumentChanges(){void 0===this._workspaceEdit.documentChanges&&void 0===this._workspaceEdit.changes&&(this._changeAnnotations=new Ne,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())}initChanges(){void 0===this._workspaceEdit.documentChanges&&void 0===this._workspaceEdit.changes&&(this._workspaceEdit.changes=Object.create(null))}createFile(e,t,n){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");let o,i,s;if(P.is(t)||C.is(t)?o=t:n=t,void 0===o?i=D.create(e,n):(s=C.is(o)?o:this._changeAnnotations.manage(o),i=D.create(e,n,s)),this._workspaceEdit.documentChanges.push(i),void 0!==s)return s}renameFile(e,t,n,o){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");let i,s,r;if(P.is(n)||C.is(n)?i=n:o=n,void 0===i?s=N.create(e,t,o):(r=C.is(i)?i:this._changeAnnotations.manage(i),s=N.create(e,t,o,r)),this._workspaceEdit.documentChanges.push(s),void 0!==r)return r}deleteFile(e,t,n){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");let o,i,s;if(P.is(t)||C.is(t)?o=t:n=t,void 0===o?i=b.create(e,n):(s=C.is(o)?o:this._changeAnnotations.manage(o),i=b.create(e,n,s)),this._workspaceEdit.documentChanges.push(i),void 0!==s)return s}}!function(e){e.create=function(e){return{uri:e}},e.is=function(e){let t=e;return ve.defined(t)&&ve.string(t.uri)}}(x||(x={})),function(e){e.create=function(e,t){return{uri:e,version:t}},e.is=function(e){let t=e;return ve.defined(t)&&ve.string(t.uri)&&ve.integer(t.version)}}(v||(v={})),function(e){e.create=function(e,t){return{uri:e,version:t}},e.is=function(e){let t=e;return ve.defined(t)&&ve.string(t.uri)&&(null===t.version||ve.integer(t.version))}}(M||(M={})),function(e){e.create=function(e,t,n,o){return{uri:e,languageId:t,version:n,text:o}},e.is=function(e){let t=e;return ve.defined(t)&&ve.string(t.uri)&&ve.string(t.languageId)&&ve.integer(t.version)&&ve.string(t.text)}}(L||(L={})),function(e){e.PlainText="plaintext",e.Markdown="markdown",e.is=function(t){const n=t;return n===e.PlainText||n===e.Markdown}}(w||(w={})),function(e){e.is=function(e){const t=e;return ve.objectLiteral(e)&&w.is(t.kind)&&ve.string(t.value)}}(I||(I={})),function(e){e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25}(q||(q={})),function(e){e.PlainText=1,e.Snippet=2}(F||(F={})),function(e){e.Deprecated=1}(B||(B={})),function(e){e.create=function(e,t,n){return{newText:e,insert:t,replace:n}},e.is=function(e){const t=e;return t&&ve.string(t.newText)&&c.is(t.insert)&&c.is(t.replace)}}(U||(U={})),function(e){e.asIs=1,e.adjustIndentation=2}(Y||(Y={})),function(e){e.is=function(e){const t=e;return t&&(ve.string(t.detail)||void 0===t.detail)&&(ve.string(t.description)||void 0===t.description)}}(j||(j={})),function(e){e.create=function(e){return{label:e}}}(W||(W={})),function(e){e.create=function(e,t){return{items:e||[],isIncomplete:!!t}}}(K||(K={})),function(e){e.fromPlainText=function(e){return e.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")},e.is=function(e){const t=e;return ve.string(t)||ve.objectLiteral(t)&&ve.string(t.language)&&ve.string(t.value)}}(V||(V={})),function(e){e.is=function(e){let t=e;return!!t&&ve.objectLiteral(t)&&(I.is(t.contents)||V.is(t.contents)||ve.typedArray(t.contents,V.is))&&(void 0===e.range||c.is(e.range))}}(H||(H={})),function(e){e.create=function(e,t){return t?{label:e,documentation:t}:{label:e}}}(G||(G={})),function(e){e.create=function(e,t,...n){let o={label:e};return ve.defined(t)&&(o.documentation=t),ve.defined(n)?o.parameters=n:o.parameters=[],o}}(Z||(Z={})),function(e){e.Text=1,e.Read=2,e.Write=3}($||($={})),function(e){e.create=function(e,t){let n={range:e};return ve.number(t)&&(n.kind=t),n}}(z||(z={})),function(e){e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26}(Q||(Q={})),function(e){e.Deprecated=1}(J||(J={})),function(e){e.create=function(e,t,n,o,i){let s={name:e,kind:t,location:{uri:o,range:n}};return i&&(s.containerName=i),s}}(X||(X={})),function(e){e.create=function(e,t,n,o){return void 0!==o?{name:e,kind:t,location:{uri:n,range:o}}:{name:e,kind:t,location:{uri:n}}}}(ee||(ee={})),function(e){e.create=function(e,t,n,o,i,s){let r={name:e,detail:t,kind:n,range:o,selectionRange:i};return void 0!==s&&(r.children=s),r},e.is=function(e){let t=e;return t&&ve.string(t.name)&&ve.number(t.kind)&&c.is(t.range)&&c.is(t.selectionRange)&&(void 0===t.detail||ve.string(t.detail))&&(void 0===t.deprecated||ve.boolean(t.deprecated))&&(void 0===t.children||Array.isArray(t.children))&&(void 0===t.tags||Array.isArray(t.tags))}}(te||(te={})),function(e){e.Empty="",e.QuickFix="quickfix",e.Refactor="refactor",e.RefactorExtract="refactor.extract",e.RefactorInline="refactor.inline",e.RefactorRewrite="refactor.rewrite",e.Source="source",e.SourceOrganizeImports="source.organizeImports",e.SourceFixAll="source.fixAll"}(ne||(ne={})),function(e){e.Invoked=1,e.Automatic=2}(oe||(oe={})),function(e){e.create=function(e,t,n){let o={diagnostics:e};return null!=t&&(o.only=t),null!=n&&(o.triggerKind=n),o},e.is=function(e){let t=e;return ve.defined(t)&&ve.typedArray(t.diagnostics,E.is)&&(void 0===t.only||ve.typedArray(t.only,ve.string))&&(void 0===t.triggerKind||t.triggerKind===oe.Invoked||t.triggerKind===oe.Automatic)}}(ie||(ie={})),function(e){e.create=function(e,t,n){let o={title:e},i=!0;return"string"==typeof t?(i=!1,o.kind=t):y.is(t)?o.command=t:o.edit=t,i&&void 0!==n&&(o.kind=n),o},e.is=function(e){let t=e;return t&&ve.string(t.title)&&(void 0===t.diagnostics||ve.typedArray(t.diagnostics,E.is))&&(void 0===t.kind||ve.string(t.kind))&&(void 0!==t.edit||void 0!==t.command)&&(void 0===t.command||y.is(t.command))&&(void 0===t.isPreferred||ve.boolean(t.isPreferred))&&(void 0===t.edit||A.is(t.edit))}}(se||(se={})),function(e){e.create=function(e,t){let n={range:e};return ve.defined(t)&&(n.data=t),n},e.is=function(e){let t=e;return ve.defined(t)&&c.is(t.range)&&(ve.undefined(t.command)||y.is(t.command))}}(re||(re={})),function(e){e.create=function(e,t){return{tabSize:e,insertSpaces:t}},e.is=function(e){let t=e;return ve.defined(t)&&ve.uinteger(t.tabSize)&&ve.boolean(t.insertSpaces)}}(ae||(ae={})),function(e){e.create=function(e,t,n){return{range:e,target:t,data:n}},e.is=function(e){let t=e;return ve.defined(t)&&c.is(t.range)&&(ve.undefined(t.target)||ve.string(t.target))}}(ce||(ce={})),function(e){e.create=function(e,t){return{range:e,parent:t}},e.is=function(t){let n=t;return ve.objectLiteral(n)&&c.is(n.range)&&(void 0===n.parent||e.is(n.parent))}}(le||(le={})),function(e){e.namespace="namespace",e.type="type",e.class="class",e.enum="enum",e.interface="interface",e.struct="struct",e.typeParameter="typeParameter",e.parameter="parameter",e.variable="variable",e.property="property",e.enumMember="enumMember",e.event="event",e.function="function",e.method="method",e.macro="macro",e.keyword="keyword",e.modifier="modifier",e.comment="comment",e.string="string",e.number="number",e.regexp="regexp",e.operator="operator",e.decorator="decorator"}(ue||(ue={})),function(e){e.declaration="declaration",e.definition="definition",e.readonly="readonly",e.static="static",e.deprecated="deprecated",e.abstract="abstract",e.async="async",e.modification="modification",e.documentation="documentation",e.defaultLibrary="defaultLibrary"}(he||(he={})),function(e){e.is=function(e){const t=e;return ve.objectLiteral(t)&&(void 0===t.resultId||"string"==typeof t.resultId)&&Array.isArray(t.data)&&(0===t.data.length||"number"==typeof t.data[0])}}(de||(de={})),function(e){e.create=function(e,t){return{range:e,text:t}},e.is=function(e){const t=e;return null!=t&&c.is(t.range)&&ve.string(t.text)}}(pe||(pe={})),function(e){e.create=function(e,t,n){return{range:e,variableName:t,caseSensitiveLookup:n}},e.is=function(e){const t=e;return null!=t&&c.is(t.range)&&ve.boolean(t.caseSensitiveLookup)&&(ve.string(t.variableName)||void 0===t.variableName)}}(me||(me={})),function(e){e.create=function(e,t){return{range:e,expression:t}},e.is=function(e){const t=e;return null!=t&&c.is(t.range)&&(ve.string(t.expression)||void 0===t.expression)}}(_e||(_e={})),function(e){e.create=function(e,t){return{frameId:e,stoppedLocation:t}},e.is=function(e){const t=e;return ve.defined(t)&&c.is(e.stoppedLocation)}}(ge||(ge={})),function(e){e.Type=1,e.Parameter=2,e.is=function(e){return 1===e||2===e}}(fe||(fe={})),function(e){e.create=function(e){return{value:e}},e.is=function(e){const t=e;return ve.objectLiteral(t)&&(void 0===t.tooltip||ve.string(t.tooltip)||I.is(t.tooltip))&&(void 0===t.location||l.is(t.location))&&(void 0===t.command||y.is(t.command))}}(Te||(Te={})),function(e){e.create=function(e,t,n){const o={position:e,label:t};return void 0!==n&&(o.kind=n),o},e.is=function(e){const t=e;return ve.objectLiteral(t)&&a.is(t.position)&&(ve.string(t.label)||ve.typedArray(t.label,Te.is))&&(void 0===t.kind||fe.is(t.kind))&&void 0===t.textEdits||ve.typedArray(t.textEdits,O.is)&&(void 0===t.tooltip||ve.string(t.tooltip)||I.is(t.tooltip))&&(void 0===t.paddingLeft||ve.boolean(t.paddingLeft))&&(void 0===t.paddingRight||ve.boolean(t.paddingRight))}}(Se||(Se={})),function(e){e.createSnippet=function(e){return{kind:"snippet",value:e}}}(Ee||(Ee={})),function(e){e.create=function(e,t,n,o){return{insertText:e,filterText:t,range:n,command:o}}}(ye||(ye={})),function(e){e.create=function(e){return{items:e}}}(Oe||(Oe={})),function(e){e.Invoked=0,e.Automatic=1}(Pe||(Pe={})),function(e){e.create=function(e,t){return{range:e,text:t}}}(Ce||(Ce={})),function(e){e.create=function(e,t){return{triggerKind:e,selectedCompletionInfo:t}}}(Re||(Re={})),function(e){e.is=function(e){const t=e;return ve.objectLiteral(t)&&i.is(t.uri)&&ve.string(t.name)}}(ke||(ke={}));const Ae=["\n","\r\n","\r"];var xe,ve;!function(e){function t(e,n){if(e.length<=1)return e;const o=e.length/2|0,i=e.slice(0,o),s=e.slice(o);t(i,n),t(s,n);let r=0,a=0,c=0;for(;r<i.length&&a<s.length;){let t=n(i[r],s[a]);e[c++]=t<=0?i[r++]:s[a++]}for(;r<i.length;)e[c++]=i[r++];for(;a<s.length;)e[c++]=s[a++];return e}e.create=function(e,t,n,o){return new Me(e,t,n,o)},e.is=function(e){let t=e;return!!(ve.defined(t)&&ve.string(t.uri)&&(ve.undefined(t.languageId)||ve.string(t.languageId))&&ve.uinteger(t.lineCount)&&ve.func(t.getText)&&ve.func(t.positionAt)&&ve.func(t.offsetAt))},e.applyEdits=function(e,n){let o=e.getText(),i=t(n,(e,t)=>{let n=e.range.start.line-t.range.start.line;return 0===n?e.range.start.character-t.range.start.character:n}),s=o.length;for(let t=i.length-1;t>=0;t--){let n=i[t],r=e.offsetAt(n.range.start),a=e.offsetAt(n.range.end);if(!(a<=s))throw new Error("Overlapping edit");o=o.substring(0,r)+n.newText+o.substring(a,o.length),s=r}return o}}(xe||(xe={}));class Me{constructor(e,t,n,o){this._uri=e,this._languageId=t,this._version=n,this._content=o,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(e){if(e){let t=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(t,n)}return this._content}update(e,t){this._content=e.text,this._version=t,this._lineOffsets=void 0}getLineOffsets(){if(void 0===this._lineOffsets){let e=[],t=this._content,n=!0;for(let o=0;o<t.length;o++){n&&(e.push(o),n=!1);let i=t.charAt(o);n="\r"===i||"\n"===i,"\r"===i&&o+1<t.length&&"\n"===t.charAt(o+1)&&o++}n&&t.length>0&&e.push(t.length),this._lineOffsets=e}return this._lineOffsets}positionAt(e){e=Math.max(Math.min(e,this._content.length),0);let t=this.getLineOffsets(),n=0,o=t.length;if(0===o)return a.create(0,e);for(;n<o;){let i=Math.floor((n+o)/2);t[i]>e?o=i:n=i+1}let i=n-1;return a.create(i,e-t[i])}offsetAt(e){let t=this.getLineOffsets();if(e.line>=t.length)return this._content.length;if(e.line<0)return 0;let n=t[e.line],o=e.line+1<t.length?t[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,o),n)}get lineCount(){return this.getLineOffsets().length}}!function(e){const t=Object.prototype.toString;e.defined=function(e){return void 0!==e},e.undefined=function(e){return void 0===e},e.boolean=function(e){return!0===e||!1===e},e.string=function(e){return"[object String]"===t.call(e)},e.number=function(e){return"[object Number]"===t.call(e)},e.numberRange=function(e,n,o){return"[object Number]"===t.call(e)&&n<=e&&e<=o},e.integer=function(e){return"[object Number]"===t.call(e)&&-2147483648<=e&&e<=2147483647},e.uinteger=function(e){return"[object Number]"===t.call(e)&&0<=e&&e<=2147483647},e.func=function(e){return"[object Function]"===t.call(e)},e.objectLiteral=function(e){return null!==e&&"object"==typeof e},e.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)}}(ve||(ve={}))},6439:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageConnection=t.BrowserMessageWriter=t.BrowserMessageReader=void 0,n(4615).default.install();const s=n(3281);i(n(3281),t);class r extends s.AbstractMessageReader{constructor(e){super(),this._onData=new s.Emitter,this._messageListener=e=>{this._onData.fire(e.data)},e.addEventListener("error",e=>this.fireError(e)),e.onmessage=this._messageListener}listen(e){return this._onData.event(e)}}t.BrowserMessageReader=r;class a extends s.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.addEventListener("error",e=>this.fireError(e))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}}t.BrowserMessageWriter=a,t.createMessageConnection=function(e,t,n,o){return void 0===n&&(n=s.NullLogger),s.ConnectionStrategy.is(o)&&(o={connectionStrategy:o}),(0,s.createMessageConnection)(e,t,n,o)}},6627:(e,t,n)=>{e.exports=n(8867)},6914:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeclarationRequest=void 0;const o=n(372);var i;!function(e){e.method="textDocument/declaration",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.DeclarationRequest=i={}))},7672:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorPresentationRequest=t.DocumentColorRequest=void 0;const o=n(372);var i,s;!function(e){e.method="textDocument/documentColor",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.DocumentColorRequest=i={})),function(e){e.method="textDocument/colorPresentation",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(s||(t.ColorPresentationRequest=s={}))},7752:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InlayHintRefreshRequest=t.InlayHintResolveRequest=t.InlayHintRequest=void 0;const o=n(372);var i,s,r;!function(e){e.method="textDocument/inlayHint",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.InlayHintRequest=i={})),function(e){e.method="inlayHint/resolve",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(s||(t.InlayHintResolveRequest=s={})),function(e){e.method="workspace/inlayHint/refresh",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType0(e.method)}(r||(t.InlayHintRefreshRequest=r={}))},7874:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createConnection=t.combineFeatures=t.combineNotebooksFeatures=t.combineLanguagesFeatures=t.combineWorkspaceFeatures=t.combineWindowFeatures=t.combineClientFeatures=t.combineTracerFeatures=t.combineTelemetryFeatures=t.combineConsoleFeatures=t._NotebooksImpl=t._LanguagesImpl=t.BulkUnregistration=t.BulkRegistration=t.ErrorMessageTracker=void 0;const o=n(4512),i=n(1248),s=n(6116),r=n(2938),a=n(8491),c=n(2112),l=n(3918),u=n(2655),h=n(8817),d=n(2697),p=n(8517),m=n(5026),_=n(1815),g=n(6007),f=n(4635),T=n(493),S=n(20),E=n(2936);function y(e){if(null!==e)return e}t.ErrorMessageTracker=class{constructor(){this._messages=Object.create(null)}add(e){let t=this._messages[e];t||(t=0),t++,this._messages[e]=t}sendErrors(e){Object.keys(this._messages).forEach(t=>{e.window.showErrorMessage(t)})}};class O{constructor(){}rawAttach(e){this._rawConnection=e}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}fillServerCapabilities(e){}initialize(e){}error(e){this.send(o.MessageType.Error,e)}warn(e){this.send(o.MessageType.Warning,e)}info(e){this.send(o.MessageType.Info,e)}log(e){this.send(o.MessageType.Log,e)}debug(e){this.send(o.MessageType.Debug,e)}send(e,t){this._rawConnection&&this._rawConnection.sendNotification(o.LogMessageNotification.type,{type:e,message:t}).catch(()=>{(0,o.RAL)().console.error("Sending log message failed")})}}const P=(0,h.ShowDocumentFeature)((0,r.ProgressFeature)(class{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}showErrorMessage(e,...t){let n={type:o.MessageType.Error,message:e,actions:t};return this.connection.sendRequest(o.ShowMessageRequest.type,n).then(y)}showWarningMessage(e,...t){let n={type:o.MessageType.Warning,message:e,actions:t};return this.connection.sendRequest(o.ShowMessageRequest.type,n).then(y)}showInformationMessage(e,...t){let n={type:o.MessageType.Info,message:e,actions:t};return this.connection.sendRequest(o.ShowMessageRequest.type,n).then(y)}}));var C,R;!function(e){e.create=function(){return new k}}(C||(t.BulkRegistration=C={}));class k{constructor(){this._registrations=[],this._registered=new Set}add(e,t){const n=i.string(e)?e:e.method;if(this._registered.has(n))throw new Error(`${n} is already added to this registration`);const o=s.generateUuid();this._registrations.push({id:o,method:n,registerOptions:t||{}}),this._registered.add(n)}asRegistrationParams(){return{registrations:this._registrations}}}!function(e){e.create=function(){return new D(void 0,[])}}(R||(t.BulkUnregistration=R={}));class D{constructor(e,t){this._connection=e,this._unregistrations=new Map,t.forEach(e=>{this._unregistrations.set(e.method,e)})}get isAttached(){return!!this._connection}attach(e){this._connection=e}add(e){this._unregistrations.set(e.method,e)}dispose(){let e=[];for(let t of this._unregistrations.values())e.push(t);let t={unregisterations:e};this._connection.sendRequest(o.UnregistrationRequest.type,t).catch(()=>{this._connection.console.info("Bulk unregistration failed.")})}disposeSingle(e){const t=i.string(e)?e:e.method,n=this._unregistrations.get(t);if(!n)return!1;let s={unregisterations:[n]};return this._connection.sendRequest(o.UnregistrationRequest.type,s).then(()=>{this._unregistrations.delete(t)},e=>{this._connection.console.info(`Un-registering request handler for ${n.id} failed.`)}),!0}}class N{attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}register(e,t,n){return e instanceof k?this.registerMany(e):e instanceof D?this.registerSingle1(e,t,n):this.registerSingle2(e,t)}registerSingle1(e,t,n){const r=i.string(t)?t:t.method,a=s.generateUuid();let c={registrations:[{id:a,method:r,registerOptions:n||{}}]};return e.isAttached||e.attach(this.connection),this.connection.sendRequest(o.RegistrationRequest.type,c).then(t=>(e.add({id:a,method:r}),e),e=>(this.connection.console.info(`Registering request handler for ${r} failed.`),Promise.reject(e)))}registerSingle2(e,t){const n=i.string(e)?e:e.method,r=s.generateUuid();let a={registrations:[{id:r,method:n,registerOptions:t||{}}]};return this.connection.sendRequest(o.RegistrationRequest.type,a).then(e=>o.Disposable.create(()=>{this.unregisterSingle(r,n).catch(()=>{this.connection.console.info(`Un-registering capability with id ${r} failed.`)})}),e=>(this.connection.console.info(`Registering request handler for ${n} failed.`),Promise.reject(e)))}unregisterSingle(e,t){let n={unregisterations:[{id:e,method:t}]};return this.connection.sendRequest(o.UnregistrationRequest.type,n).catch(()=>{this.connection.console.info(`Un-registering request handler for ${e} failed.`)})}registerMany(e){let t=e.asRegistrationParams();return this.connection.sendRequest(o.RegistrationRequest.type,t).then(()=>new D(this._connection,t.registrations.map(e=>({id:e.id,method:e.method}))),e=>(this.connection.console.info("Bulk registration failed."),Promise.reject(e)))}}const b=(0,d.FileOperationsFeature)((0,c.WorkspaceFoldersFeature)((0,a.ConfigurationFeature)(class{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}applyEdit(e){let t=(n=e)&&n.edit?e:{edit:e};var n;return this.connection.sendRequest(o.ApplyWorkspaceEditRequest.type,t)}})));class A{constructor(){this._trace=o.Trace.Off}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}set trace(e){this._trace=e}log(e,t){this._trace!==o.Trace.Off&&this.connection.sendNotification(o.LogTraceNotification.type,{message:e,verbose:this._trace===o.Trace.Verbose?t:void 0}).catch(()=>{})}}class x{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}logEvent(e){this.connection.sendNotification(o.TelemetryEventNotification.type,e).catch(()=>{this.connection.console.log("Sending TelemetryEventNotification failed")})}}class v{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}attachWorkDoneProgress(e){return(0,r.attachWorkDone)(this.connection,e)}attachPartialResultProgress(e,t){return(0,r.attachPartialResult)(this.connection,t)}}t._LanguagesImpl=v;const M=(0,g.FoldingRangeFeature)((0,E.MonikerFeature)((0,T.DiagnosticFeature)((0,f.InlayHintFeature)((0,_.InlineValueFeature)((0,m.TypeHierarchyFeature)((0,p.LinkedEditingRangeFeature)((0,u.SemanticTokensFeature)((0,l.CallHierarchyFeature)(v)))))))));class L{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}attachWorkDoneProgress(e){return(0,r.attachWorkDone)(this.connection,e)}attachPartialResultProgress(e,t){return(0,r.attachPartialResult)(this.connection,t)}}t._NotebooksImpl=L;const w=(0,S.NotebookSyncFeature)(L);function I(e,t){return function(n){return t(e(n))}}function q(e,t){return function(n){return t(e(n))}}function F(e,t){return function(n){return t(e(n))}}function B(e,t){return function(n){return t(e(n))}}function U(e,t){return function(n){return t(e(n))}}function Y(e,t){return function(n){return t(e(n))}}function j(e,t){return function(n){return t(e(n))}}function W(e,t){return function(n){return t(e(n))}}t.combineConsoleFeatures=I,t.combineTelemetryFeatures=q,t.combineTracerFeatures=F,t.combineClientFeatures=B,t.combineWindowFeatures=U,t.combineWorkspaceFeatures=Y,t.combineLanguagesFeatures=j,t.combineNotebooksFeatures=W,t.combineFeatures=function(e,t){function n(e,t,n){return e&&t?n(e,t):e||t}return{__brand:"features",console:n(e.console,t.console,I),tracer:n(e.tracer,t.tracer,F),telemetry:n(e.telemetry,t.telemetry,q),client:n(e.client,t.client,B),window:n(e.window,t.window,U),workspace:n(e.workspace,t.workspace,Y),languages:n(e.languages,t.languages,j),notebooks:n(e.notebooks,t.notebooks,W)}},t.createConnection=function(e,t,n){const s=n&&n.console?new(n.console(O)):new O,a=e(s);s.rawAttach(a);const c=n&&n.tracer?new(n.tracer(A)):new A,l=n&&n.telemetry?new(n.telemetry(x)):new x,u=n&&n.client?new(n.client(N)):new N,h=n&&n.window?new(n.window(P)):new P,d=n&&n.workspace?new(n.workspace(b)):new b,p=n&&n.languages?new(n.languages(M)):new M,m=n&&n.notebooks?new(n.notebooks(w)):new w,_=[s,c,l,u,h,d,p,m];let g,f,T,S={listen:()=>a.listen(),sendRequest:(e,...t)=>a.sendRequest(i.string(e)?e:e.method,...t),onRequest:(e,t)=>a.onRequest(e,t),sendNotification:(e,t)=>{const n=i.string(e)?e:e.method;return a.sendNotification(n,t)},onNotification:(e,t)=>a.onNotification(e,t),onProgress:a.onProgress,sendProgress:a.sendProgress,onInitialize:e=>(f=e,{dispose:()=>{f=void 0}}),onInitialized:e=>a.onNotification(o.InitializedNotification.type,e),onShutdown:e=>(g=e,{dispose:()=>{g=void 0}}),onExit:e=>(T=e,{dispose:()=>{T=void 0}}),get console(){return s},get telemetry(){return l},get tracer(){return c},get client(){return u},get window(){return h},get workspace(){return d},get languages(){return p},get notebooks(){return m},onDidChangeConfiguration:e=>a.onNotification(o.DidChangeConfigurationNotification.type,e),onDidChangeWatchedFiles:e=>a.onNotification(o.DidChangeWatchedFilesNotification.type,e),__textDocumentSync:void 0,onDidOpenTextDocument:e=>a.onNotification(o.DidOpenTextDocumentNotification.type,e),onDidChangeTextDocument:e=>a.onNotification(o.DidChangeTextDocumentNotification.type,e),onDidCloseTextDocument:e=>a.onNotification(o.DidCloseTextDocumentNotification.type,e),onWillSaveTextDocument:e=>a.onNotification(o.WillSaveTextDocumentNotification.type,e),onWillSaveTextDocumentWaitUntil:e=>a.onRequest(o.WillSaveTextDocumentWaitUntilRequest.type,e),onDidSaveTextDocument:e=>a.onNotification(o.DidSaveTextDocumentNotification.type,e),sendDiagnostics:e=>a.sendNotification(o.PublishDiagnosticsNotification.type,e),onHover:e=>a.onRequest(o.HoverRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),void 0)),onCompletion:e=>a.onRequest(o.CompletionRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onCompletionResolve:e=>a.onRequest(o.CompletionResolveRequest.type,e),onSignatureHelp:e=>a.onRequest(o.SignatureHelpRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),void 0)),onDeclaration:e=>a.onRequest(o.DeclarationRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onDefinition:e=>a.onRequest(o.DefinitionRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onTypeDefinition:e=>a.onRequest(o.TypeDefinitionRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onImplementation:e=>a.onRequest(o.ImplementationRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onReferences:e=>a.onRequest(o.ReferencesRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onDocumentHighlight:e=>a.onRequest(o.DocumentHighlightRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onDocumentSymbol:e=>a.onRequest(o.DocumentSymbolRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onWorkspaceSymbol:e=>a.onRequest(o.WorkspaceSymbolRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onWorkspaceSymbolResolve:e=>a.onRequest(o.WorkspaceSymbolResolveRequest.type,e),onCodeAction:e=>a.onRequest(o.CodeActionRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onCodeActionResolve:e=>a.onRequest(o.CodeActionResolveRequest.type,(t,n)=>e(t,n)),onCodeLens:e=>a.onRequest(o.CodeLensRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onCodeLensResolve:e=>a.onRequest(o.CodeLensResolveRequest.type,(t,n)=>e(t,n)),onDocumentFormatting:e=>a.onRequest(o.DocumentFormattingRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),void 0)),onDocumentRangeFormatting:e=>a.onRequest(o.DocumentRangeFormattingRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),void 0)),onDocumentOnTypeFormatting:e=>a.onRequest(o.DocumentOnTypeFormattingRequest.type,(t,n)=>e(t,n)),onRenameRequest:e=>a.onRequest(o.RenameRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),void 0)),onPrepareRename:e=>a.onRequest(o.PrepareRenameRequest.type,(t,n)=>e(t,n)),onDocumentLinks:e=>a.onRequest(o.DocumentLinkRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onDocumentLinkResolve:e=>a.onRequest(o.DocumentLinkResolveRequest.type,(t,n)=>e(t,n)),onDocumentColor:e=>a.onRequest(o.DocumentColorRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onColorPresentation:e=>a.onRequest(o.ColorPresentationRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onFoldingRanges:e=>a.onRequest(o.FoldingRangeRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onSelectionRanges:e=>a.onRequest(o.SelectionRangeRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),(0,r.attachPartialResult)(a,t))),onExecuteCommand:e=>a.onRequest(o.ExecuteCommandRequest.type,(t,n)=>e(t,n,(0,r.attachWorkDone)(a,t),void 0)),dispose:()=>a.dispose()};for(let e of _)e.attach(S);return a.onRequest(o.InitializeRequest.type,e=>{t.initialize(e),i.string(e.trace)&&(c.trace=o.Trace.fromString(e.trace));for(let t of _)t.initialize(e.capabilities);if(f){let t=f(e,(new o.CancellationTokenSource).token,(0,r.attachWorkDone)(a,e),void 0);return(n=t,n instanceof Promise?n:i.thenable(n)?new Promise((e,t)=>{n.then(t=>e(t),e=>t(e))}):Promise.resolve(n)).then(e=>{if(e instanceof o.ResponseError)return e;let t=e;t||(t={capabilities:{}});let n=t.capabilities;n||(n={},t.capabilities=n),void 0===n.textDocumentSync||null===n.textDocumentSync?n.textDocumentSync=i.number(S.__textDocumentSync)?S.__textDocumentSync:o.TextDocumentSyncKind.None:i.number(n.textDocumentSync)||i.number(n.textDocumentSync.change)||(n.textDocumentSync.change=i.number(S.__textDocumentSync)?S.__textDocumentSync:o.TextDocumentSyncKind.None);for(let e of _)e.fillServerCapabilities(n);return t})}{let e={capabilities:{textDocumentSync:o.TextDocumentSyncKind.None}};for(let t of _)t.fillServerCapabilities(e.capabilities);return e}var n}),a.onRequest(o.ShutdownRequest.type,()=>(t.shutdownReceived=!0,g?g((new o.CancellationTokenSource).token):void 0)),a.onNotification(o.ExitNotification.type,()=>{try{T&&T()}finally{t.shutdownReceived?t.exit(0):t.exit(1)}}),a.onNotification(o.SetTraceNotification.type,e=>{c.trace=o.Trace.fromString(e.value)}),S}},8461:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TypeDefinitionRequest=void 0;const o=n(372);var i;!function(e){e.method="textDocument/typeDefinition",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.TypeDefinitionRequest=i={}))},8491:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationFeature=void 0;const o=n(4512),i=n(1248);t.ConfigurationFeature=e=>class extends e{getConfiguration(e){return e?i.string(e)?this._getConfiguration({section:e}):this._getConfiguration(e):this._getConfiguration({})}_getConfiguration(e){let t={items:Array.isArray(e)?e:[e]};return this.connection.sendRequest(o.ConfigurationRequest.type,t).then(t=>Array.isArray(t)?Array.isArray(e)?t:t[0]:Array.isArray(e)?[]:null)}}},8517:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedEditingRangeFeature=void 0;const o=n(4512);t.LinkedEditingRangeFeature=e=>class extends e{onLinkedEditingRange(e){return this.connection.onRequest(o.LinkedEditingRangeRequest.type,(t,n)=>e(t,n,this.attachWorkDoneProgress(t),void 0))}}},8585:(e,t)=>{function n(e){return"string"==typeof e||e instanceof String}function o(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.stringArray=t.array=t.func=t.error=t.number=t.string=t.boolean=void 0,t.boolean=function(e){return!0===e||!1===e},t.string=n,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=function(e){return"function"==typeof e},t.array=o,t.stringArray=function(e){return o(e)&&e.every(e=>n(e))}},8598:(e,t)=>{function n(e){return"string"==typeof e||e instanceof String}function o(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.objectLiteral=t.typedArray=t.stringArray=t.array=t.func=t.error=t.number=t.string=t.boolean=void 0,t.boolean=function(e){return!0===e||!1===e},t.string=n,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=function(e){return"function"==typeof e},t.array=o,t.stringArray=function(e){return o(e)&&e.every(e=>n(e))},t.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)},t.objectLiteral=function(e){return null!==e&&"object"==typeof e}},8765:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallHierarchyOutgoingCallsRequest=t.CallHierarchyIncomingCallsRequest=t.CallHierarchyPrepareRequest=void 0;const o=n(372);var i,s,r;!function(e){e.method="textDocument/prepareCallHierarchy",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.CallHierarchyPrepareRequest=i={})),function(e){e.method="callHierarchy/incomingCalls",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(s||(t.CallHierarchyIncomingCallsRequest=s={})),function(e){e.method="callHierarchy/outgoingCalls",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(r||(t.CallHierarchyOutgoingCallsRequest=r={}))},8766:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.LSPErrorCodes=t.createProtocolConnection=void 0,i(n(6439),t),i(n(6203),t),i(n(372),t),i(n(1560),t);var s,r=n(1580);Object.defineProperty(t,"createProtocolConnection",{enumerable:!0,get:function(){return r.createProtocolConnection}}),function(e){e.lspReservedErrorRangeStart=-32899,e.RequestFailed=-32803,e.ServerCancelled=-32802,e.ContentModified=-32801,e.RequestCancelled=-32800,e.lspReservedErrorRangeEnd=-32800}(s||(t.LSPErrorCodes=s={}))},8817:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShowDocumentFeature=void 0;const o=n(4512);t.ShowDocumentFeature=e=>class extends e{showDocument(e){return this.connection.sendRequest(o.ShowDocumentRequest.type,e)}}},8867:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.createConnection=void 0;const s=n(2861);i(n(5678),t),i(n(2861),t);let r=!1;const a={initialize:e=>{},get shutdownReceived(){return r},set shutdownReceived(e){r=e},exit:e=>{}};t.createConnection=function(e,t,n,o){let i,r,c,l;return void 0!==e&&"features"===e.__brand&&(i=e,e=t,t=n,n=o),s.ConnectionStrategy.is(e)||s.ConnectionOptions.is(e)?l=e:(r=e,c=t,l=n),(0,s.createConnection)(e=>(0,s.createProtocolConnection)(r,c,e,l),a,i)}},9047:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MonikerRequest=t.MonikerKind=t.UniquenessLevel=void 0;const o=n(372);var i,s,r;!function(e){e.document="document",e.project="project",e.group="group",e.scheme="scheme",e.global="global"}(i||(t.UniquenessLevel=i={})),function(e){e.$import="import",e.$export="export",e.local="local"}(s||(t.MonikerKind=s={})),function(e){e.method="textDocument/moniker",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(r||(t.MonikerRequest=r={}))},9085:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadableStreamMessageReader=t.AbstractMessageReader=t.MessageReader=void 0;const o=n(9590),i=n(8585),s=n(2676),r=n(4323);var a,c;!function(e){e.is=function(e){let t=e;return t&&i.func(t.listen)&&i.func(t.dispose)&&i.func(t.onError)&&i.func(t.onClose)&&i.func(t.onPartialMessage)}}(a||(t.MessageReader=a={}));class l{constructor(){this.errorEmitter=new s.Emitter,this.closeEmitter=new s.Emitter,this.partialMessageEmitter=new s.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${i.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageReader=l,function(e){e.fromOptions=function(e){let t,n;const i=new Map;let s;const r=new Map;if(void 0===e||"string"==typeof e)t=e??"utf-8";else{if(t=e.charset??"utf-8",void 0!==e.contentDecoder&&(n=e.contentDecoder,i.set(n.name,n)),void 0!==e.contentDecoders)for(const t of e.contentDecoders)i.set(t.name,t);if(void 0!==e.contentTypeDecoder&&(s=e.contentTypeDecoder,r.set(s.name,s)),void 0!==e.contentTypeDecoders)for(const t of e.contentTypeDecoders)r.set(t.name,t)}return void 0===s&&(s=(0,o.default)().applicationJson.decoder,r.set(s.name,s)),{charset:t,contentDecoder:n,contentDecoders:i,contentTypeDecoder:s,contentTypeDecoders:r}}}(c||(c={})),t.ReadableStreamMessageReader=class extends l{constructor(e,t){super(),this.readable=e,this.options=c.fromOptions(t),this.buffer=(0,o.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new r.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;const t=this.readable.onData(e=>{this.onData(e)});return this.readable.onError(e=>this.fireError(e)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(-1===this.nextMessageLength){const e=this.buffer.tryReadHeaders(!0);if(!e)return;const t=e.get("content-length");if(!t)return void this.fireError(new Error(`Header must provide a Content-Length property.\n${JSON.stringify(Object.fromEntries(e))}`));const n=parseInt(t);if(isNaN(n))return void this.fireError(new Error(`Content-Length value must be a number. Got ${t}`));this.nextMessageLength=n}const e=this.buffer.tryReadBody(this.nextMessageLength);if(void 0===e)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{const t=void 0!==this.options.contentDecoder?await this.options.contentDecoder.decode(e):e,n=await this.options.contentTypeDecoder.decode(t,this.options);this.callback(n)}).catch(e=>{this.fireError(e)})}}catch(e){this.fireError(e)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=(0,o.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}},9244:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractMessageBuffer=void 0,t.AbstractMessageBuffer=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){const t="string"==typeof e?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(0===this._chunks.length)return;let t=0,n=0,o=0,i=0;e:for(;n<this._chunks.length;){const e=this._chunks[n];for(o=0;o<e.length;){switch(e[o]){case 13:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case 10:switch(t){case 1:t=2;break;case 3:t=4,o++;break e;default:t=0}break;default:t=0}o++}i+=e.byteLength,n++}if(4!==t)return;const s=this._read(i+o),r=new Map,a=this.toString(s,"ascii").split("\r\n");if(a.length<2)return r;for(let t=0;t<a.length-2;t++){const n=a[t],o=n.indexOf(":");if(-1===o)throw new Error(`Message header must separate key and value using ':'\n${n}`);const i=n.substr(0,o),s=n.substr(o+1).trim();r.set(e?i.toLowerCase():i,s)}return r}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(0===e)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const t=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(t)}if(this._chunks[0].byteLength>e){const t=this._chunks[0],n=this.asNative(t,e);return this._chunks[0]=t.slice(e),this._totalLength-=e,n}const t=this.allocNative(e);let n=0;for(;e>0;){const o=this._chunks[0];if(o.byteLength>e){const i=o.slice(0,e);t.set(i,n),n+=e,this._chunks[0]=o.slice(e),this._totalLength-=e,e-=e}else t.set(o,n),n+=o.byteLength,this._chunks.shift(),this._totalLength-=o.byteLength,e-=o.byteLength}return t}}},9574:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImplementationRequest=void 0;const o=n(372);var i;!function(e){e.method="textDocument/implementation",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(i||(t.ImplementationRequest=i={}))},9590:(e,t)=>{let n;function o(){if(void 0===n)throw new Error("No runtime abstraction layer installed");return n}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.install=function(e){if(void 0===e)throw new Error("No runtime abstraction layer provided");n=e}}(o||(o={})),t.default=o},9840:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WillDeleteFilesRequest=t.DidDeleteFilesNotification=t.DidRenameFilesNotification=t.WillRenameFilesRequest=t.DidCreateFilesNotification=t.WillCreateFilesRequest=t.FileOperationPatternKind=void 0;const o=n(372);var i,s,r,a,c,l,u;!function(e){e.file="file",e.folder="folder"}(i||(t.FileOperationPatternKind=i={})),function(e){e.method="workspace/willCreateFiles",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(s||(t.WillCreateFilesRequest=s={})),function(e){e.method="workspace/didCreateFiles",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(r||(t.DidCreateFilesNotification=r={})),function(e){e.method="workspace/willRenameFiles",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(a||(t.WillRenameFilesRequest=a={})),function(e){e.method="workspace/didRenameFiles",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(c||(t.DidRenameFilesNotification=c={})),function(e){e.method="workspace/didDeleteFiles",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(l||(t.DidDeleteFilesNotification=l={})),function(e){e.method="workspace/willDeleteFiles",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolRequestType(e.method)}(u||(t.WillDeleteFilesRequest=u={}))},9850:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationTokenSource=t.CancellationToken=void 0;const o=n(9590),i=n(8585),s=n(2676);var r;!function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:s.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:s.Event.None}),e.is=function(t){const n=t;return n&&(n===e.None||n===e.Cancelled||i.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}}(r||(t.CancellationToken=r={}));const a=Object.freeze(function(e,t){const n=(0,o.default)().timer.setTimeout(e.bind(t),0);return{dispose(){n.dispose()}}});class c{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?a:(this._emitter||(this._emitter=new s.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}t.CancellationTokenSource=class{get token(){return this._token||(this._token=new c),this._token}cancel(){this._token?this._token.cancel():this._token=r.Cancelled}dispose(){this._token?this._token instanceof c&&this._token.dispose():this._token=r.None}}},9935:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DidChangeWorkspaceFoldersNotification=t.WorkspaceFoldersRequest=void 0;const o=n(372);var i,s;!function(e){e.method="workspace/workspaceFolders",e.messageDirection=o.MessageDirection.serverToClient,e.type=new o.ProtocolRequestType0(e.method)}(i||(t.WorkspaceFoldersRequest=i={})),function(e){e.method="workspace/didChangeWorkspaceFolders",e.messageDirection=o.MessageDirection.clientToServer,e.type=new o.ProtocolNotificationType(e.method)}(s||(t.DidChangeWorkspaceFoldersNotification=s={}))}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o,i=n(6627);class s{constructor(e,t,n,o){this._uri=e,this._languageId=t,this._version=n,this._content=o,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(e){if(e){const t=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(t,n)}return this._content}update(e,t){for(const t of e)if(s.isIncremental(t)){const e=l(t.range),n=this.offsetAt(e.start),o=this.offsetAt(e.end);this._content=this._content.substring(0,n)+t.text+this._content.substring(o,this._content.length);const i=Math.max(e.start.line,0),s=Math.max(e.end.line,0);let r=this._lineOffsets;const c=a(t.text,!1,n);if(s-i===c.length)for(let e=0,t=c.length;e<t;e++)r[e+i+1]=c[e];else c.length<1e4?r.splice(i+1,s-i,...c):this._lineOffsets=r=r.slice(0,i+1).concat(c,r.slice(s+1));const u=t.text.length-(o-n);if(0!==u)for(let e=i+1+c.length,t=r.length;e<t;e++)r[e]=r[e]+u}else{if(!s.isFull(t))throw new Error("Unknown change event received");this._content=t.text,this._lineOffsets=void 0}this._version=t}getLineOffsets(){return void 0===this._lineOffsets&&(this._lineOffsets=a(this._content,!0)),this._lineOffsets}positionAt(e){e=Math.max(Math.min(e,this._content.length),0);const t=this.getLineOffsets();let n=0,o=t.length;if(0===o)return{line:0,character:e};for(;n<o;){const i=Math.floor((n+o)/2);t[i]>e?o=i:n=i+1}const i=n-1;return{line:i,character:(e=this.ensureBeforeEOL(e,t[i]))-t[i]}}offsetAt(e){const t=this.getLineOffsets();if(e.line>=t.length)return this._content.length;if(e.line<0)return 0;const n=t[e.line];if(e.character<=0)return n;const o=e.line+1<t.length?t[e.line+1]:this._content.length,i=Math.min(n+e.character,o);return this.ensureBeforeEOL(i,n)}ensureBeforeEOL(e,t){for(;e>t&&c(this._content.charCodeAt(e-1));)e--;return e}get lineCount(){return this.getLineOffsets().length}static isIncremental(e){const t=e;return null!=t&&"string"==typeof t.text&&void 0!==t.range&&(void 0===t.rangeLength||"number"==typeof t.rangeLength)}static isFull(e){const t=e;return null!=t&&"string"==typeof t.text&&void 0===t.range&&void 0===t.rangeLength}}function r(e,t){if(e.length<=1)return e;const n=e.length/2|0,o=e.slice(0,n),i=e.slice(n);r(o,t),r(i,t);let s=0,a=0,c=0;for(;s<o.length&&a<i.length;){const n=t(o[s],i[a]);e[c++]=n<=0?o[s++]:i[a++]}for(;s<o.length;)e[c++]=o[s++];for(;a<i.length;)e[c++]=i[a++];return e}function a(e,t,n=0){const o=t?[n]:[];for(let t=0;t<e.length;t++){const i=e.charCodeAt(t);c(i)&&(13===i&&t+1<e.length&&10===e.charCodeAt(t+1)&&t++,o.push(n+t+1))}return o}function c(e){return 13===e||10===e}function l(e){const t=e.start,n=e.end;return t.line>n.line||t.line===n.line&&t.character>n.character?{start:n,end:t}:e}function u(e){const t=l(e.range);return t!==e.range?{newText:e.newText,range:t}:e}!function(e){e.create=function(e,t,n,o){return new s(e,t,n,o)},e.update=function(e,t,n){if(e instanceof s)return e.update(t,n),e;throw new Error("TextDocument.update: document must be created by TextDocument.create")},e.applyEdits=function(e,t){const n=e.getText(),o=r(t.map(u),(e,t)=>{const n=e.range.start.line-t.range.start.line;return 0===n?e.range.start.character-t.range.start.character:n});let i=0;const s=[];for(const t of o){const o=e.offsetAt(t.range.start);if(o<i)throw new Error("Overlapping edit");o>i&&s.push(n.substring(i,o)),t.newText.length&&s.push(t.newText),i=e.offsetAt(t.range.end)}return s.push(n.substr(i)),s.join("")}}(o||(o={}));var h=n(8867);const d=function(e,t,n){t({})};function p(e){const t={};for(const n of e)t[n]=1;return t}function m(e,t){let n=e;return t&&(n=n.replace("{0}",t)),n}const _={procOpts:{},procStmts:{},kwPool:{},stmts:{},functions:{},sasColors:[]},g="_$help",f="_$type",T="_$options",S="_$optionsReq",E="_$values",y="_$stms",O="_$hasOptDelimiter",P="_$subOpts",C="_$keywords",R="_$alias",k="_$attr",D="_$syntax",N="_$arguments",b="_$supportSite",A=p(["ABORT","ARRAY","ATTRIB","AXIS","ENDRSUBMIT","FILE","FILENAME","FOOTNOTE","FORMAT","GOPTIONS","INFILE","INFORMAT","KILLTASK","LEGEND","LIBNAME","LISTTASK","LOCK","NOTE","ODS","OPTIONS","PATTERN","RDISPLAY","RGET","RSUBMIT","RUN","SIGNOFF","SIGNON","SYMBOL","SYSTASK","TITLE","CAS","CASLIB","WAITFOR","WHERE","DATA-SET","DATA-STEP"]),x=p(["MACRO","ODS","DATA","STATGRAPH","DEFINE_TAGSET","DEFINE_EVENT"]);let v;function M(e,t){return e&&setTimeout(function(){e(t)},0),t}function L(e,...t){let n=0,o=e;for(;o&&(void 0!==t[n]||void 0!==t[n+1]);n++)o=o[t[n]];return o}function w(e){return e.replace("=","")}function I(e){const t=/^\((.*)\)$/.exec(e);return t?t[1]:e.replace(/(\(.*\))|=/g,"")}function q(e,t){const n=JSON.parse(JSON.stringify(t));n.name=e;const o=n.aliases.indexOf(e);return n.aliases.splice(o,1,t.name),n}function F(e,t){return t.split("|").filter(function(t){return t&&w(t)!==e})}function B(e,t,n){let o=W(e,t)[b];if(o){const i=W(e,t,n)[b];if(i&&i.docsetTargetFile)return i;o=Object.assign({},o),o.supportSiteTargetFile=o.docsetTargetFile,o.supportSiteTargetFragment=i}return o}function U(e,t){let n=j(e)[b];return n&&(n=Object.assign({},n),n.supportSiteTargetFragment=j(e,w(t))[b]),n}function Y(e,t,n){let o=j(e)[b];return o&&(o=Object.assign({},o),o.supportSiteTargetFile=W(e,t)[b],o.supportSiteTargetFragment=W(e,t,n)[b]),o}function j(e,t,n,o){return t&&(t=w(t)),o&&(o=w(o)),L(_.procOpts,e,t,n,o)}function W(e,t,n,o,i){return n&&(n=I(n)),i&&(i=w(i)),L(_.procStmts,e,t,n,o,i)}function K(e,t){return L(_.kwPool,e,t)}function V(e,t,n,o){return t&&(t=w(t)),L(_.stmts,e,t,n,o)}const H={formats:"SASFormats.json",informats:"SASInformats.json","macro-func":"SASMacroFunctions.json","macro-stmt":"SASMacroStatements.json","macro-def-opt":"MacroDefinitionOptions.json","ods-tagsets":"ODS_Tagsets.json","auto-var":"SASAutoVariables.json","autocall-macro":"SASAutocallMacros.json","arm-macro":"SASARMMacros.json","call-routines":"SASCallRoutines.json","hash-pack-method":"HashPackageMethods.json","stat-kw":"StatisticsKeywords.json","style-loc":"StyleLocations.json","style-att":"StyleAttributes.json","style-ele":"StyleElements.json",func:"SASFunctions.json","ds-stmt":"SASDataStepStatements.json","ds-option":"SASDataSetOptions.json","gbl-stmt":"SASGlobalStatements.json","gbl-proc-stmt":"SASGlobalProcedureStatements.json",proc:"SASProcedures.json","datastep-option":"SASDataStepOptions.json","datastep-option2":"SASDataStepOptions2.json",sql:"SQLKeywords.json"};function G(e,t){const n=t.split("|");e[C]||(e[C]=[]);const o=e[C];return n.forEach(function(t){""!==(t="string"==typeof t?t.trim():null!==t?String(t).trim():"")&&(e[w(t)]=!0,o.push(t))}),e}function Z(e){return e?e["#cdata"]:""}function $(e,t,n){let o,i=1,s=0,r="@Value"+i;for(;e[r];){for(o=e[r].split("|"),s=0;s<o.length;s++)n(s,o[s],t?t["@ToolTip"+i]:void 0);i++,r="@Value"+i}}function z(e,t){const n=e.length;for(let o=0;o<n;o++){if(!e[o].Name)continue;const n=e[o].Name.split("|");for(let i=0;i<n.length;i++)t(o,n[i],e[o])}}function Q(e){return e.needToLoad()?e.userCb?void e.load(function(){e.userCb?.(e.getData())}):(e.load(),e.getData()):M(e.userCb,e.getData())}function J(e){return Q({userCb:e,getData:function(){return _.sasColors},needToLoad:function(){return!(_.sasColors.length>0)},load:function(e){!function(e){d(0,function(t){t&&t.Color&&($(t.Color.Values,null,function(e,t,n){_.sasColors.push(t)}),e&&e())})}(e)}})}function X(e,t,n){return ee(t,n,function(){let n=function(e,t){return L(_.functions,t,e)}(e,t);return n&&(n={key:e,data:n[g],syntax:n[D],arguments:n[N],supportSite:n[b]}),n})}function ee(e,t,n){return Q({userCb:t,getData:n,needToLoad:function(){return!function(e){return _.functions[e]}(e)},load:function(t){!function(e,t){d(0,function(n){n&&n.length&&(function(e,t){_.functions[t]||(_.functions[t]={});const n=[];e.forEach(function(e){n.push(e.name),_.functions[t][e.name]={},_.functions[t][e.name][g]=e.description,_.functions[t][e.name][D]=e.syntax&&e.syntax.help,_.functions[t][e.name][N]=e.syntax&&e.syntax.arguments,_.functions[t][e.name][b]=e.supportSiteInformation}),_.functions[t][C]=n}(n,e),t&&t())})}(e,t)}})}function te(e,t){return Q({userCb:e,getData:t,needToLoad:function(){return!ce("proc")},load:function(e){!function(e){d(0,function(t){t&&t.length&&(void 0===_.kwPool.proc&&(_.kwPool.proc={}),t.forEach(function(e){_.kwPool.proc[e]={}}),_.kwPool.proc[C]=t,e&&e())})}(e)}})}function ne(e,t,n){t=w(t),void 0===_.stmts[e][t]&&(_.stmts[e][t]={}),function(e,t,n){_.stmts[e][t][g]=Z(n)}(e,t,n.Help),function(e,t,n){_.stmts[e][t][f]=n}(e,t,n.Type),function(e,t,n){_.stmts[e][t][R]=F(t,n)}(e,t,n.Name),n.Values&&function(e,t,n,o){const i=[];$(n,o,function(n,s,r){i.push(s),o&&function(e,t,n,o){void 0===_.stmts[e][t][n]&&(_.stmts[e][t][n]={}),_.stmts[e][t][n][g]=o}(e,t,s.toUpperCase(),r)}),_.stmts[e][t][E]=i}(e,t,n.Values,n.ToolTips),n.SubOptionsKeywords&&function(e,t,n){const o=_.stmts[e][t][P]||{};G(o,n),_.stmts[e][t][P]=o}(e,t,n.SubOptionsKeywords)}function oe(e,t,n){return Q({userCb:t,getData:n,needToLoad:function(){return A[e]&&!function(e){return _.stmts[e]}(e)},load:function(t){!function(e,t){let n="../../data/";n+="DATA-SET"===e?"SASDataSetOptions":"DATA-STEP"===e?"SASDataStepOptions":"Statements/"+e.toUpperCase(),n+=".json",d(0,function(n){n&&n.Keywords&&(function(e,t){const n=[];void 0===_.stmts[e]&&(_.stmts[e]={}),z(t,function(t,o,i){n.push(o),ne(e,o,i)}),_.stmts[e][T]=n}(e,n.Keywords.Keyword),t&&t())})}(e,t)}})}function ie(e,t,n){return se(e,n,function(){let n=W(e,t);return n&&(n={key:t,data:n[g],alias:n[R],syntax:n[D],supportSite:n[b]}),n})}function se(e,t,n){return Q({userCb:t,getData:n,needToLoad:function(){return!function(e){return _.procStmts[e]}(e)},load:function(t){!function(e,t){d(0,function(n){n&&n.length&&(function(e,t){_.procStmts[t]||(_.procStmts[t]={});const n=[];e.forEach(function(e){const o=e.name;n.push(o),void 0===_.procStmts[t][o]&&(_.procStmts[t][o]={},_.procStmts[t][o][O]=!1),_.procStmts[t][o][g]=e.description,_.procStmts[t][o][D]=e.help,_.procStmts[t][o][b]=e.supportSiteInformation,_.procStmts[t][o][R]=e.aliases;const i=e.arguments;i&&i.length&&Re(t,o,i),e.aliases&&e.aliases.forEach(function(i){n.push(i),_.procStmts[t][i]=JSON.parse(JSON.stringify(_.procStmts[t][o])),_.procStmts[t][i][R]=q(i,e).aliases})}),_.procStmts[t][y]=n}(n,e),t&&t())})}(e,t)}})}function re(e,t,n){_.kwPool[e][t][k]=n}function ae(e,t){!function(e){let t="../../data/";H[e]&&(t+=H[e])}(e);d(0,function(n){n&&n.Keywords&&(function(e,t){const n=[];void 0===_.kwPool[e]&&(_.kwPool[e]={}),z(t,function(t,o,i){n.push(o),function(e,t,n){void 0===_.kwPool[e][t]&&(_.kwPool[e][t]={}),function(e,t,n){_.kwPool[e][t][g]=Z(n)}(e,t,n.Help),function(e,t,n){_.kwPool[e][t][R]=F(t,n)}(e,t,n.Name),re(e,t,n.Attributes)}(e,w(o).toUpperCase(),i)}),_.kwPool[e][C]=n}(e,n.Keywords.Keyword),t&&t())})}function ce(e){return _.kwPool[e]}function le(e,t,n){return Q({userCb:t,getData:n,needToLoad:function(){return!ce(e)},load:function(t){ae(e,t)}})}function ue(e,t){return le(e,t,function(){let t=K(e);return t&&(t=t[C]),t})}function he(e,t,n){return le(t,n,function(){let n=K(t,w(e).toUpperCase());return n&&(n={key:e,data:n[g],alias:n[R]}),n})}function de(e,t){return x[e]?d(0,function(n){n&&n.Procedure&&(function(e,t){if(void 0===_.procOpts[e]&&(_.procOpts[e]={}),void 0===_.procStmts[e]&&(_.procStmts[e]={}),function(e,t){_.procOpts[e][g]=Z(t)}(e,t.ProcedureHelp),t.ProcedureOptions){let n=t.ProcedureOptions;n instanceof Array||(n=[n]),n.forEach(function(t){!function(e,t){if(t){let n=[];t instanceof Array||(t=[t]);for(let o=0;o<t.length;o++){if(!t[o].ProcedureOptionName)continue;const i=t[o].ProcedureOptionName.split("|");""===i[i.length-1]&&i.pop();for(let n=0;n<i.length;n++)Te(e,i[n],t[o]);n=n.concat(i)}_.procOpts[e][T]=n}}(e,t.ProcedureOption)})}if(t.ProcedureStatements){let n=t.ProcedureStatements;n instanceof Array||(n=[n]),n.forEach(function(t){t&&function(e,t){if(t){let n=[];t instanceof Array||(t=[t]);for(let o=0;o<t.length;o++){let i=t[o].StatementName;if(i){i=i.split("|"),""===i[i.length-1]&&i.pop();for(let n=0;n<i.length;n++)ke(e,w(i[n].toUpperCase()),t[o]);n=n.concat(i)}}_.procStmts[e][y]=n}}(e,t.ProcedureStatement)})}}(e,n.Procedure),t&&t())}):function(e,t){d(0,function(n){n&&n.statements&&(function(e,t,n){if(void 0===_.procOpts[e]&&(_.procOpts[e]={}),void 0===_.procStmts[e]&&(_.procStmts[e]={}),t[0]){n&&(_.procOpts[e][b]={...n,supportSiteTargetFile:t[0].supportSiteTargetFile}),function(e,t){_.procOpts[e][g]=t.description,_.procOpts[e][D]=t.help}(e,t[0]);const o=t[0].arguments;o&&o.length&&function(e,t){const n=[];t.forEach(function(t){t.placeholder||(fe(e,t),n.push(t.name),t.aliases&&t.aliases.length&&t.aliases.forEach(function(o){fe(e,q(o,t)),n.push(o)}))}),_.procOpts[e][T]=n}(e,o)}t.splice(0,1),t.length&&function(e,t){const n=[];t.forEach(function(t){const o=w(t.name.toUpperCase());!function(e,t,n){void 0===_.procStmts[e][t]&&(_.procStmts[e][t]={},_.procStmts[e][t][O]=!1),function(e,t,n){_.procStmts[e][t][g]=n.description,_.procStmts[e][t][D]=n.help,_.procStmts[e][t][b]=n.supportSiteTargetFile}(e,t,n),function(e,t,n){_.procStmts[e][t][R]=n}(e,t,n.aliases);const o=n.arguments;o&&o.length&&Re(e,t,o)}(e,o,t),t.aliases&&t.aliases.forEach(i=>{n.push(i),_.procStmts[e][i]=Object.assign({},_.procStmts[e][o]),_.procStmts[e][i][R]=q(i,t).aliases}),n.push(t.name)}),_.procStmts[e][y]=n}(e,t)}(e,n.statements,n.supportSiteInformation),n.interactive&&re("proc",n.name,"InteractivePROC"),t&&t())})}(e,t)}function pe(e,t,n){return Q({userCb:t,getData:n,needToLoad:function(){const t=te(null,function(){return K("proc")});return t&&(t[e]||x[e])&&!function(e){return _.procStmts[e]}(e)},load:function(t){de(e,t)}})}function me(e,t,n){_.procOpts[e][t][f]=n}function _e(e,t,n,o){_.procOpts[e][t][n][g]=o}function ge(e,t,n){const o=n.name.toUpperCase();void 0===_.procOpts[e][t][o]&&(_.procOpts[e][t][o]={}),_.procOpts[e][t][o][R]=n.aliases,n.description&&_e(e,t,o,n.description)}function fe(e,t){const n=w(t.name).toUpperCase();void 0===_.procOpts[e][n]&&(_.procOpts[e][n]={}),function(e,t,n){_.procOpts[e][t][g]=n.description,_.procOpts[e][t][D]=n.help,_.procOpts[e][t][b]=n.supportSiteTargetFragment}(e,n,t),me(e,n,t.type),function(e,t,n){_.procOpts[e][t][R]=n}(e,n,t.aliases);const o=t.arguments;o&&o.length&&(function(e,t,n){const o=[];n.forEach(function(n){if(n.placeholder||"standalone"!==n.type)return;const i=n.name;o.push(i),ge(e,t,n),n.aliases&&n.aliases.length&&n.aliases.forEach(function(i){o.push(i),ge(e,t,q(i,n))})}),_.procOpts[e][t][E]=o}(e,n,o),function(e,t,n){const o=_.procOpts[e][t][P]||{};o[C]||(o[C]=[]),n.forEach(function(n){if(n.placeholder||"standalone"===n.type)return;const i=n.name;o[C].push(i),o[w(i)]=!0,void 0===_.procOpts[e][t][i]&&(_.procOpts[e][t][i]={}),n.description&&(_.procOpts[e][t][i][g]=n.description)}),_.procOpts[e][t][P]=o}(e,n,o))}function Te(e,t,n){t=w(t),void 0===_.procOpts[e][t]&&(_.procOpts[e][t]={}),function(e,t,n){_.procOpts[e][t][g]=Z(n)}(e,t,n.ProcedureOptionHelp),me(e,t,n.ProcedureOptionType),function(e,t,n){_.procOpts[e][t][R]=F(t,n)}(e,t,n.ProcedureOptionName),n.SubOptionsKeywords&&function(e,t,n){const o=_.procOpts[e][t][P]||{};G(o,n),_.procOpts[e][t][P]=o}(e,t,n.SubOptionsKeywords),n.ProcedureOptionValues&&function(e,t,n,o){const i=[];$(n,o,function(n,o,s){i.push(o),void 0===_.procOpts[e][t][o]&&(_.procOpts[e][t][o]={}),s&&_e(e,t,o,s)}),_.procOpts[e][t][E]=i}(e,t,n.ProcedureOptionValues,n.ProcedureOptionToolTips)}function Se(e,t,n){const o=I(n.name).toUpperCase();void 0===_.procStmts[e][t][o]&&(_.procStmts[e][t][o]={}),function(e,t,n,o){_.procStmts[e][t][n][g]=o.description,_.procStmts[e][t][n][D]=o.help,_.procStmts[e][t][n][b]=o.supportSiteTargetFragment||o.supportSiteInformation}(e,t,o,n),ye(e,t,o,n.type),function(e,t,n,o){_.procStmts[e][t][n][R]=o}(e,t,o,n.aliases);const i=n.arguments;i&&i.length&&(function(e,t,n,o){const i=[];o.forEach(function(o){if(o.placeholder||"standalone"!==o.type)return;const s=o.name;i.push(s),Ce(e,t,n,o),o.aliases&&o.aliases.length&&o.aliases.forEach(function(s){i.push(s),Ce(e,t,n,q(s,o))})}),_.procStmts[e][t][n][E]=i}(e,t,o,i),function(e,t,n,o){const i=_.procStmts[e][t][n][P]||{};i[C]||(i[C]=[]),o.forEach(function(o){if(o.placeholder||"standalone"===o.type)return;const s=o.name;i[C].push(s),i[w(s)]=!0,Oe(e,t,n,s,o),o.aliases&&o.aliases.forEach(function(s){i[C].push(s),i[w(s)]=!0,Oe(e,t,n,s,q(s,o))})}),_.procStmts[e][t][n][P]=i}(e,t,o,i))}function Ee(e,t,n,o){n=I(n),void 0===_.procStmts[e][t][n]&&(_.procStmts[e][t][n]={}),function(e,t,n,o){_.procStmts[e][t][n][g]=Z(o)}(e,t,n,o.StatementOptionHelp),ye(e,t,n,o.StatementOptionType),function(e,t,n,o){_.procStmts[e][t][n][R]=F(n,o)}(e,t,n,o.StatementOptionName),o.SubOptionsKeywords&&function(e,t,n,o){const i=_.procStmts[e][t][n][P]||{};G(i,o),_.procStmts[e][t][n][P]=i}(e,t,n,o.SubOptionsKeywords),o.StatementOptionValues&&function(e,t,n,o,i){const s=[];$(o,i,function(o,r,a){s.push(r),void 0===_.procStmts[e][t][n][r]&&(_.procStmts[e][t][n][r]={}),i&&Pe(e,t,n,r,a)}),_.procStmts[e][t][n][E]=s}(e,t,n,o.StatementOptionValues,o.StatementOptionToolTips)}function ye(e,t,n,o){_.procStmts[e][t][n][f]=o}function Oe(e,t,n,o,i){void 0===_.procStmts[e][t][n][o]&&(_.procStmts[e][t][n][o]={}),i.description&&(_.procStmts[e][t][n][o][g]=i.description),i.help&&(_.procStmts[e][t][n][o][D]=i.help),i.aliases&&(_.procStmts[e][t][n][o][R]=i.aliases)}function Pe(e,t,n,o,i){_.procStmts[e][t][n][o][g]=i}function Ce(e,t,n,o){const i=o.name.toUpperCase();void 0===_.procStmts[e][t][n][i]&&(_.procStmts[e][t][n][i]={}),_.procStmts[e][t][n][i][R]=o.aliases,o.description&&Pe(e,t,n,i,o.description)}function Re(e,t,n){let o=[],i=[];n.forEach(function(n){n.placeholder||(Se(e,t,n),n.followsDelimiter?o.push(n.name):i.push(n.name),n.aliases&&n.aliases.length&&n.aliases.forEach(function(s){Se(e,t,q(s,n)),n.followsDelimiter?o.push(s):i.push(s)}))}),o.length>0?_.procStmts[e][t][O]=!0:(o=i,i=[]),_.procStmts[e][t][T]=o,_.procStmts[e][t][S]=i}function ke(e,t,n){void 0===_.procStmts[e][t]&&(_.procStmts[e][t]={}),function(e,t,n){_.procStmts[e][t][g]=Z(n)}(e,t,n.StatementHelp),function(e,t,n){_.procStmts[e][t][R]=F(t,n)}(e,t,n.StatementName),n.StatementOptions&&function(e,t,n){if(n){let o=[];n instanceof Array||(n=[n]);for(let i=0;i<n.length;i++){let s=n[i].StatementOptionName;if(s){s=s.split("|"),""===s[s.length-1]&&s.pop();for(let o=0;o<s.length;o++)Ee(e,t,s[o],n[i]);o=o.concat(s)}}_.procStmts[e][t][T]=o}}(e,t,n.StatementOptions.StatementOption)}function De(e){j(e)||pe(e,null,function(){return j(e)})}function Ne(e){K(e)||le(e,null,function(){return K(e)})}function be(e){V(e)||oe(e,null,function(){return V(e)})}class Ae{_handleOptionValues(e,t){return this.isColorType(e.type)?(e.values=this.getSasColors(),M(t,e)):this.isDataSetType(e.type)?this.getLibraryList(t,e.type):M(t,e),e}setLibService(e){v=e}getProcedures(e){return te(e,function(){let e=K("proc");return e&&(e=e[C]),e})}getProcedureHelp(e,t){return pe(e=e.toUpperCase(),t,function(){let t=j(e);return t&&(t={data:t[g],key:e,syntax:t[D],supportSite:t[b]}),t})}getProcedureOptions(e,t){return pe(e=e.toUpperCase(),t,function(){let t=j(e);return t&&(t=t[T]),t})}getProcedureOptionHelp(e,t,n){return e=e.toUpperCase(),t=t.toUpperCase(),pe(e,n,function(){let n=j(e,w(t));return n&&(n={data:n[g],key:t,alias:n[R],syntax:n[D],supportSite:U(e,t)}),n})}getProcedureOptionType(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),pe(e,null,function(){let n=j(e,w(t));return n&&(n=n[f]),n})}getProcedureOptionValueHelp(e,t,n,o){return pe(e,o,function(){e=e.toUpperCase(),t=t.toUpperCase(),n=n.toUpperCase();let o=j(e,t,n);return o&&(o={key:n,data:o[g],alias:o[R],supportSite:U(e,t)}),o})}getProcedureOptionValues(e,t,n){let o=pe(e,null,()=>{e=e.toUpperCase(),t=t.toUpperCase();let n=j(e,t);return n&&(n={type:this.getProcedureOptionType(e,t),values:n[E]}),n});return o&&(o=this._handleOptionValues(o,n)),o}getProcedureSubOptions(e,t,n){return pe(e,n,function(){e=e.toUpperCase(),t=t.toUpperCase();let n=j(e,t,P);return n=n?n[C]:[],n})}getProcedureSubOptionHelp(e,t,n,o){return pe(e,o,function(){e=e.toUpperCase(),t=t.toUpperCase(),n=n.toUpperCase();let o=j(e,t,n);return o&&(o={key:n,data:o[g],alias:o[R],syntax:o[D],supportSite:U(e,t)}),o})}getProcedureStatements(e,t,n){return pe(e=e.toUpperCase(),n,()=>{let n=W(e);if(n&&(n=n[y]),n||(n=[]),!t){const e=this.getGlobalProcedureStatements();e&&(n=n.concat(e),n=function(e){const t=[],n={},o=e.length;if(o<2)return e;for(let i=0;i<o;i++){const o=e[i];n[o]||(t.push(o),n[o]=!0)}return t}(n))}return n.length>0?n:null})}getProcedureStatementHelp(e,t,n){return e=e.toUpperCase(),t=t.toUpperCase(),pe(e,n,()=>{let n=W(e,t);if(n){let o=j(e)[b];o&&(o=Object.assign({},o),o.supportSiteTargetFile=n[b]),n={key:t,data:n[g],alias:n[R],syntax:n[D],supportSite:o}}else n=this.getKeywordHelp(t,null,"gbl-proc-stmt"),n&&(n.isGlobal=!0);return n})}getProcedureStatementOptions(e,t,n,o){return e=e.toUpperCase(),t=t.toUpperCase(),pe(e,n,()=>{let n=W(e,t);return n=n?o?n[S]:n[T]:this.getStatementOptions("global",t,void 0,o),n})}getProcedureStatementOptionHelp(e,t,n,o){return e=e.toUpperCase(),t=t.toUpperCase(),n=n.toUpperCase(),pe(e,o,()=>{let o=W(e,t,n);return o=o?{key:n,data:o[g],alias:o[R],syntax:o[D],supportSite:Y(e,t,n)}:this.getStatementOptionHelp("global",t,n),o})}getProcedureStatementOptionType(e,t,n){return e=e.toUpperCase(),t=t.toUpperCase(),n=n.toUpperCase(),pe(e,null,()=>{let o=W(e,t,n);return o=o?o[f]:this.getStatementOptionType(t,n),o})}getProcedureStatementSubOptions(e,t,n,o){return e=e.toUpperCase(),t=t.toUpperCase(),n=n.toUpperCase(),pe(e,o,()=>{let o=W(e,t,n,P);return o=o?o[C]:this.getStatementSubOptions("global",t,n),o})}getProcedureStatementSubOptionHelp(e,t,n,o,i){return e=e.toUpperCase(),t=t.toUpperCase(),n=n&&n.toUpperCase(),o=o&&o.toUpperCase(),pe(e,i,()=>{let i=W(e,t,n,o);return i=i?{key:o,data:i[g],alias:i[R],syntax:i[D],supportSite:Y(e,t,n)}:this.getStatementSubOptionHelp("global",t,n,o),i})}getProcedureStatementOptionValueHelp(e,t,n,o,i){return e=e.toUpperCase(),t=t.toUpperCase(),n=n&&n.toUpperCase(),pe(e,i,()=>{let i=W(e,t,n,o);return i=i?{key:o,data:i[g],alias:i[R],supportSite:Y(e,t,n)}:this.getStatementOptionValueHelp("global",t,n,o),i})}getProcedureStatementOptionValues(e,t,n,o){if(!n)return o(void 0),null;t=t.toUpperCase(),e=e.toUpperCase(),n=n.toUpperCase();let i=pe(e,null,()=>{let o=W(e,t,n);return o=o?{type:this.getProcedureStatementOptionType(e,t,n),values:o[E]}:this.getStatementOptionValues("global",t,n),o});return i?i=this._handleOptionValues(i,o):M(o,i),i}addUserDefinedAbbr(e){}getUserDefinedAbbr(){}getFilenameOrLibnameOptions(){}getStatementOptions(e,t,n,o){return t=t.toUpperCase(),se(e,n,function(){let n=W(e,t);return n&&(n=o?n[S]:n[T]),n})}getStatementOptionHelp(e,t,n,o){return se(e,o,function(){t=t.toUpperCase(),n=n&&n.toUpperCase();let o=W(e,t,n);return o&&(o={key:n,data:o[g],alias:o[R],syntax:o[D],supportSite:B(e,t,n)}),o})}getStatementOptionValueHelp(e,t,n,o,i){return se(e,i,function(){t=t.toUpperCase(),n=n&&n.toUpperCase(),o=o&&o.toUpperCase();let i=W(e,t,n,o);return i&&(i={key:o,data:i[g],alias:i[R],supportSite:B(e,t,n)}),i})}_getStatementOptionValueHelp(e,t,n,o){return oe(e,o,function(){e=e.toUpperCase(),t=t&&t.toUpperCase(),n=n.toUpperCase();let o=V(e,t,n);return o&&(o={key:n,data:o[g]}),o})}getStatementOptionType(e,t,n){return oe(e,n,function(){e=e.toUpperCase(),t=t.toUpperCase();let n=V(e,t);return n&&(n=n[f]),n})}getStatementOptionValues(e,t,n,o){let i=se(e,null,function(){t=t.toUpperCase(),n=n&&n.toUpperCase();let o=W(e,t,n);return o&&(o={type:o[f],values:o[E]}),o});return i?i=this._handleOptionValues(i,o):M(o,i),i}_getStatementOptionValues(e,t,n){let o=oe(e,null,()=>{e=e.toUpperCase(),t=t&&t.toUpperCase();let n=V(e,t);return n&&(n={type:this.getStatementOptionType(e,t),values:n[E]}),n});return o&&(o=this._handleOptionValues(o,n)),o}getStatementSubOptions(e,t,n,o){return se(e,o,function(){t=t.toUpperCase(),n=n&&n.toUpperCase();let o=W(e,t,n,P);return o=o?o[C]:[],o})}getStatementSubOptionHelp(e,t,n,o,i){return se(e,i,function(){t=t.toUpperCase(),n=n&&n.toUpperCase();let i=W(e,t,n,o);return i&&(i={key:o,data:i[g],alias:i[R],syntax:i[D],supportSite:B(e,t,n)}),i})}getDataStepOptions(e){return ue("datastep-option",e)}getDataStepOptionHelp(e,t,n){return he(e,n,t)}getDataStepOptionValueHelp(e,t,n){this.getStatementOptionValueHelp("datastep","DATA",e,t,n)}getDataStepOptionValues(e,t){this.getStatementOptionValues("datastep","DATA",e,t)}getDataSetOptionValueHelp(e,t,n){this._getStatementOptionValueHelp("DATA-SET",e,t,n)}getDataSetOptionValues(e,t){this._getStatementOptionValues("DATA-SET",e,t)}getKeywordHelp(e,t,n){if("func"===n)return M(t,X(e,"base"));if("macro-func"===n)return M(t,X(e,"macro"));if("gbl-proc-stmt"===n)return M(t,ie("global",e));if("gbl-stmt"===n){let n=ie("standalone",e);return n||(n=ie("global",e)),M(t,n)}if("ds-stmt"===n)return M(t,ie("datastep",e));if("macro-stmt"===n){let n=ie("macro",e);return n||(n=ie("global",e)),M(t,n)}let o=he(e,n,null);return o||("datastep-option"===n?o=he(e,"datastep-option2",null):"ds-stmt"===n?o=he(e,"gbl-stmt",null):"macro-stmt"===n&&(o=he(e,"arm-macro",null))),M(t,o)}getContextPrompt(e,t){}getSasColors(e){return J(e)}getODSTagsets(e){return ue("ods-tagsets",e)}getStyleAttributes(e){return ue("style-att",e)}getStyleElements(e){return ue("style-ele",e)}getStyleLocations(e){return ue("style-loc",e)}getARMMacros(e){return ue("arm-macro",e)}getAutocallMacros(e){return ue("autocall-macro",e)}getAutoVariables(e){return ue("auto-var",e)}getMacroDefinitionOptions(e){return ue("macro-def-opt",e)}getGlobalStatements(e){const t=this.getGlobalProcedureStatements();return se("standalone",e,function(){return W("standalone")[y].concat(t)})}getGlobalProcedureStatements(e){return se("global",e,function(){return W("global")[y]})}getMacroStatements(e){return se("macro",e,function(){return W("macro")[y]})}getFunctions(e){return ee("base",e,function(){return _.functions.base[C]})}getCallRoutines(e){return ue("call-routines",e)}getMacroFunctions(e){return ee("macro",e,function(){return _.functions.macro[C]})}getHashPackageMethods(e){return ue("hash-pack-method",e)}getFormats(e){return ue("formats",e)}getInformats(e){return ue("informats",e)}getStatisticsKeywords(e){return ue("stat-kw",e)}getDSStatements(e){const t=this.getGlobalProcedureStatements();return se("datastep",e,function(){return W("datastep")[y].concat(t)})}getDSOptions(e){return ue("ds-option",e)}getDSOptionHelp(e,t){return he(e,"ds-option",t)}getDS2Keywords(){}getDS2Functions(){}getLibraryList(e,t){"function"==typeof v?v(null,function(n){M(e,{values:n,type:t})}):M(e,{values:[],type:t})}getDataSetNames(e,t){e&&"function"==typeof v?v(e,function(e){e&&0!==e.length?M(t,e):M(t,null)}):M(t,null)}getDocumentVariables(){}getMacroDefinitions(){}getMacroVariables(){}hasOptionDelimiter(e,t){let n,o=!1;const i=this.getProcedureStatementHelp(e,t);return i&&(n=i.isGlobal?W("global",t):W(e,t),void 0===n[O]&&(n[O]=/Syntax:(.|\n)*\/(.|\n)*;/i.test(i.data)),o=n[O]),o}isProcedureOptionKeyword(e,t,n){return De(e),!!j(e,t,n)}isProcedureSubOptKeyword(e,t,n){return De(e),!!j(e,t,P,n)}isProcedureStatementKeyword(e,t,n,o){De(e);let i=W(e,t,n,o);if(t&&!i&&(i=this.isStatementKeyword("global",t,n,o),!i&&(""===e||"DATA"===e))){const s="DATA"===e?"datastep":"standalone";i=this.isStatementKeyword(s,t,n,o)}return!!i}isProcedureStatementSubOptKeyword(e,t,n,o){return De(e),!!W(e,t,n,P,o)||!!V(t,n,P,o)}isStatementKeyword(e,t,n,o){return!!se(e,null,function(){return!!W(e,t,n,o)})}_isStatementKeyword(e,t,n){be(e);let o=!!V(e,t,n);if(!o&&!t){const t="gbl-stmt";Ne(t),o=!!K(t,e)}return o}isStatementSubOptKeyword(e,t,n){return be(e),!!V(e,t,P,n)}isDatasetKeyword(e){const t="ds-option";return Ne(t),!!K(t,e)}isSasFunction(e){return ee("base",null,function(){return-1!==_.functions.base[C].indexOf(e)})}isDataSetType(e){return/\bDV\b/.test(e)||"dataset"===e.toLowerCase()}isColorType(e){return/\bC\b/.test(e)||"color"===e.toLowerCase()}isInteractiveProc(e){te(null,function(){});const t=K("proc",e);return t&&"InteractivePROC"===t[k]}}let xe;const ve=/[^`~!@#%^&*()\-=+[{\]}\\|;:'",.<>/?\s]/,Me={JAN:31,FEB:29,MAR:31,APR:30,MAY:31,JUN:30,JUL:31,AUG:31,SEP:30,OCT:31,NOV:30,DEC:31},Le=/^\d{2}(JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(\d{2}|\d{4})|\d{2}q[1234]\b/i;function we(e,t,n){if(-1===e&&t)return 0;if(0===e&&"("!==n)return-1;if(e>=0){if("("===n)return e+1;")"===n&&0===--e&&(e=-1)}return e}var Ie;!function(e){e[e.NONE=0]="NONE",e[e.PROC_PYTHON_DEF=1]="PROC_PYTHON_DEF",e[e.PROC_PYTHON_SUBMIT_OR_INTERACTIVE=2]="PROC_PYTHON_SUBMIT_OR_INTERACTIVE",e[e.PROC_PYTHON_CODE=3]="PROC_PYTHON_CODE",e[e.PROC_LUA_DEF=4]="PROC_LUA_DEF",e[e.PROC_LUA_SUBMIT_OR_INTERACTIVE=5]="PROC_LUA_SUBMIT_OR_INTERACTIVE",e[e.PROC_LUA_CODE=6]="PROC_LUA_CODE"}(Ie||(Ie={}));class qe{constructor(e){if(this.model=e,this.start={line:0,column:0},this.curr={line:0,column:0},this.quoting=-1,this.bquoting=-1,this.ignoreFormat=!1,this.syntaxDb=new Ae,this.context={embeddedLangState:Ie.NONE},!xe){const e=this.syntaxDb.getMacroStatements()?.map(e=>e.slice(1)),t=this.syntaxDb.getMacroFunctions()?.map(e=>e.slice(1));xe=p(e?.concat(t??[])??[])}}_readToken(){const e=this.getNext_();if(e)return qe.isLiteral[e.type]?e.text=this.getText(e):e.text=this.getWord(e).toUpperCase(),void 0===qe.isComment[e.type]&&(this.quoting=we(this.quoting,!!qe.isQuoting[e.text],e.text),this.bquoting=we(this.bquoting,!!qe.isBQuoting[e.text],e.text),-1===this.quoting&&-1===this.bquoting&&(this.ignoreFormat||"%PUT"!==e.text?this.ignoreFormat&&";"===e.text&&(this.ignoreFormat=!1):this.ignoreFormat=!0)),e;this.context.embeddedLangState=Ie.NONE}getNext(){let e;e:switch(this.context.embeddedLangState){case Ie.NONE:if(e=this._readToken(),!e)break e;"text"===this.context.lastNoncommentToken?.type&&"PROC"===this.context.lastNoncommentToken.text&&("text"===e.type&&"PYTHON"===e.text?this.context.embeddedLangState=Ie.PROC_PYTHON_DEF:"text"===e.type&&"LUA"===e.text&&(this.context.embeddedLangState=Ie.PROC_LUA_DEF));break e;case Ie.PROC_PYTHON_DEF:if(e=this._readToken(),!e)break e;"text"===e.type&&["SUBMIT","INTERACTIVE","I"].includes(e.text)&&(this.context.embeddedLangState=Ie.PROC_PYTHON_SUBMIT_OR_INTERACTIVE);break e;case Ie.PROC_LUA_DEF:if(e=this._readToken(),!e)break e;"text"===e.type&&["SUBMIT","INTERACTIVE","I"].includes(e.text)&&(this.context.embeddedLangState=Ie.PROC_LUA_SUBMIT_OR_INTERACTIVE);break e;case Ie.PROC_PYTHON_SUBMIT_OR_INTERACTIVE:if(e=this._readToken(),!e)break e;"sep"===e.type&&";"===e.text&&(this.context.embeddedLangState=Ie.PROC_PYTHON_CODE);break e;case Ie.PROC_PYTHON_CODE:{let t=!1;for(let n=this.curr.line;n<this.model.getLineCount();n++){const o=this._readEmbeddedCodeLine(this.curr,n);let i,s=0;do{if(i&&(s+=i.index+i[0].length),t)i=/'''|"""/.exec(o.substring(s)),i&&i[0]===t&&(t=!1);else if(i=new RegExp(`${/'''|"""|("[^"]*?("|$))|('[^']*?('|$))/.source}|${/#.*$/.source}|${/(\b((endsubmit|endinteractive)(\s+|\/\*.*?\*\/)*;|(data|proc|%macro)\b[^'";]*;))/.source}`,"m").exec(o.substring(s)),i){const o=i[0];if("'''"===o||'"""'===o)t=o;else if(!(o.startsWith("'")||o.startsWith('"')||o.startsWith("#"))){e=this._foundEmbeddedCodeToken(this.curr,{line:n,column:s+i.index});break e}}}while(i)}e=this._foundEmbeddedCodeToken(this.curr);break e}case Ie.PROC_LUA_SUBMIT_OR_INTERACTIVE:if(e=this._readToken(),!e)break e;"sep"===e.type&&";"===e.text&&(this.context.embeddedLangState=Ie.PROC_LUA_CODE);break e;case Ie.PROC_LUA_CODE:{let t=!1;for(let n=this.curr.line;n<this.model.getLineCount();n++){const o=this._readEmbeddedCodeLine(this.curr,n);let i,s=0;do{if(i&&(s+=i.index+i[0].length),t)i=/\]\]|--\]\]|\*\//.exec(o.substring(s)),i&&("[["===t&&"]]"===i[0]?t=!1:"--[["!==t||"--]]"!==i[0]&&"]]"!==i[0]?"/*"===t&&"*/"===i[0]&&(t=!1):t=!1);else if(i=new RegExp(`${/("[^"]*("|$))|('[^']*('|$))|\[\[/.source}|${/--[^[].*$|--\[\[|\/\*/.source}|${/(\b((endsubmit|endinteractive)(\s+|\/\*.*?\*\/)*;|(data|proc|%macro)\b[^'";]*;))/.source}`,"m").exec(o.substring(s)),i){const o=i[0];if(o.startsWith("[["))t="[[";else if(o.startsWith("--[["))t="--[[";else if(o.startsWith("/*"))t="/*";else if(!(o.startsWith("'")||o.startsWith('"')||o.startsWith("--"))){e=this._foundEmbeddedCodeToken(this.curr,{line:n,column:s+i.index});break e}}}while(i)}e=this._foundEmbeddedCodeToken(this.curr);break e}}return e&&void 0===qe.isComment[e.type]&&(this.context.lastNoncommentToken={...e,start:{...e.start},end:{...e.end}}),e}_readEmbeddedCodeLine(e,t){let n=this.model.getLine(t);return t===e.line&&(n=" ".repeat(e.column)+n.slice(e.column)),n}_foundEmbeddedCodeToken(e,t){const n={...e};let o;if(t)o={...t};else{const e=this.model.getLineCount()-1;o={line:e,column:this.model.getColumnCount(e)}}const i={type:"embedded-code",start:n,end:o,text:this.model.getText({start:n,end:o}).trim()};return this.curr={...i.end},this.context.embeddedLangState=Ie.NONE,i}getNext_(){let e,t,n,o,i,s,r=0;const a=this.model.getLineCount();for(;this.curr.line<a;)switch(this.start.line=this.curr.line,this.start.column=this.curr.column,t=this.curr.column,n=this.model.getLine(this.curr.line),s=n.length,n[t]){case"/":if(t++,t<s&&"*"===n[t]){for(t++;;){if(r=n.indexOf("*/",t),r>=0){this.curr.column=r+2;break}if(this.curr.line++,this.curr.line>=a){this.curr.line--,this.curr.column=n.length;break}this.curr.column=0,t=0,n=this.model.getLine(this.curr.line)}return{type:"comment",start:this.start,end:this.curr}}return this.curr.column=t,{type:"sep",start:this.start,end:this.curr};case"%":if(t++,t<s&&/[A-Za-z_]/.test(n[t])){for(t++;t<s&&/[\w_]/.test(n[t]);)t++;return this.curr.column=t,e="text",e=this.isMacroKeyword(n.substr(this.start.column+1,t-this.start.column-1))?"macro-keyword":"macro-ref",{type:e,start:this.start,end:this.curr}}if(t<s&&"*"===n[t]){for(;;){if(t++,t>=s){if(this.curr.line++,t=0,!(this.curr.line<a)){this.curr.line--,this.curr.column=n.length;break}n=this.model.getLine(this.curr.line),s=n.length}if(";"===n[t]){this.curr.column=t+1;break}}return{type:"macro-comment",start:this.start,end:this.curr}}return this.quoting>0&&t<s&&("'"===n[t]||'"'===n[t]||"("===n[t]||")"===n[t]||"%"===n[t])&&this.curr.column++,this.curr.column++,{type:"sep",start:this.start,end:this.curr};case'"':case"'":if(this.bquoting>0){this.curr.column++;break}for(o=n[t],e="string",t++;this.curr.line<a;)if(t<s)if(o===n[t])if(t++,this.quoting>0&&"%"===n[t-2]);else{if(o!==n[t]){if(t<s)switch(n[t]){case"d":case"D":e="date",t++,t<s&&("t"===n[t]||"T"===n[t])&&(e="dt",t++);break;case"t":case"T":e="time",t++;break;case"b":case"B":e="bitmask",t++;break;case"n":case"N":e="namelit",t++;break;case"x":case"X":e="hex",t++}return this.curr.column=t,{type:e,start:this.start,end:this.curr}}t++}else t++;else{if(this.curr.line++,this.curr.line>=a)return this.curr.line--,this.curr.column=t,{type:e,start:this.start,end:this.curr};t=0,n=this.model.getLine(this.curr.line),s=n.length}break;case"\t":case" ":case"":this.curr.column++;break;case".":return this.curr.column=this.readNum(t,10),this.curr.column===t?(this.curr.column++,e="sep"):e="numeric",{type:e,start:this.start,end:this.curr};case"$":if(this.curr.column++,e="sep",t++,t<s&&(i=n[t],/[a-zA-Z_0-9]/.test(i))){for(t++;t<s&&/[\w_]/.test(n[t]);)t++;t<s&&"."===n[t]&&(this.curr.column=this.readNum(t,10),this.curr.column===t&&this.curr.column++,e="format")}return{type:e,start:this.start,end:this.curr};case"*":if(null!==this.context.lastNoncommentToken&&";"!==this.getWord(this.context.lastNoncommentToken))return t++,this.curr.column=t,{type:"sep",start:this.start,end:this.curr};for(;";"!==n[t];)if(t++,t>=s){if(this.curr.line++,this.curr.line>=a){t--,this.curr.line--;break}t=0,n=this.model.getLine(this.curr.line),s=n.length}return this.curr.column=t+1,{type:"comment",start:this.start,end:this.curr};case"\n":case"\r":case"\u2028":case"\u2029":case void 0:this.curr.line++,this.curr.column=0,t=0;break;default:if(e="text",i=n[t],ve.test(i)&&!/\d/.test(i)){for(t++;t<s&&ve.test(n[t]);)t++;if(-1===this.quoting&&-1===this.bquoting&&!this.ignoreFormat&&"."===n[t]){if(this.curr.column=this.readNum(t,10),this.curr.column===t&&this.curr.column++,t++,this.curr.column>t||t<s&&!1===ve.test(n[t])||this.curr.column===t&&t===s)return{type:"format",start:this.start,end:this.curr};for(;t<s&&ve.test(n[t]);)t++}return this.curr.column=t,{type:e,start:this.start,end:this.curr}}if(i<="9"&&i>="0"){t++,e="numeric",Le.lastIndex=0,n=this.model.getLine(this.curr.line);let o=Le.exec(n.substring(this.curr.column));if(o){const e=o[0][2];if("q"!==e&&"Q"!==e){const e=parseInt(o[0].substr(0,2));(e<1||e>Me[o[1].toUpperCase()])&&(o=null)}}if("+"===i||"-"===i){if(!(n[t]<="9"&&n[t]>="0"))return this.curr.column=t,{type:"sep",start:this.start,end:this.curr};t=this.readNum(t)}else o?(t=o[0].length+this.curr.column,e="date"):t=this.readNum(this.curr.column);return this.curr.column=t,{type:e,start:this.start,end:this.curr}}if(";"!==i||this.quoting<1&&this.bquoting<1){e="sep";const t=qe.longBiOprs.exec(n.substring(this.curr.column));t?this.curr.column+=t[0].length:this.curr.column++}else this.curr.column++;return{type:e,start:this.start,end:this.curr}}}end(){return!(this.curr.line<this.model.getLineCount())}reset(){this.curr.line=0,this.curr.column=0}startFrom(e,t){this.curr.line=e,this.curr.column=t,this.context.lastNoncommentToken=null,this.context.embeddedLangState=Ie.NONE,this.quoting=-1,this.bquoting=-1,this.ignoreFormat=!1}readNum(e,t){const n=this.model.getLine(this.curr.line);let o=e,i=/^\b0?[0-9a-fA-F]+[xX]\b|^(?!0\d)\d+(\.\d{1,})(E([-+])?(\d+)?)?|^\d+\.|^(?!0\d)\d+(\.\d{1,})?(E([-+])?(\d+)?)?|^\d+\.?\d*|\.\d+/gi;10===t&&(i=/^\d+\.?\d*|^\.\d+/);const s=i.exec(n.substring(e));return s&&(o=s[0].length+e),o}isMacroKeyword(e){return!!xe?.[e.toUpperCase()]}getWord(e){return e?this.model.getLine(e.end.line).substr(e.start.column,e.end.column-e.start.column):""}getText(e){return this.model.getText(e)}}qe.TOKEN_TYPES={SEP:"sep",KEYWORD:"keyword",SKEYWORD:"sec-keyword",PROCNAME:"proc-name",COMMENT:"comment",MKEYWORD:"macro-keyword",MCOMMENT:"macro-comment",MREF:"macro-ref",MSKEYWORD:"macro-sec-keyword",CARDSDATA:"cards-data",STR:"string",DATE:"date",TIME:"time",DT:"dt",BM:"bitmask",NL:"namelit",HEX:"hex",NUM:"numeric",WORD:"text",FORMAT:"format",BLANK:"blank"},qe.notSyntaxToken=p(["comment","macro-comment","blank"]),qe.isComment=p(["comment","macro-comment"]),qe.isLiteral=p(["string","date","time","dt","bitmask","namelit","hex","numeric","cards-data"]),qe.isWord=p(["keyword","sec-keyword","macro-sec-keyword","macro-ref","macro-keyword","text"]),qe.isConst=p(["string","date","time","dt","bitmask","namelit","hex","numeric","format"]),qe.isCards=p(["CARDS","LINES","DATALINES","DATALINES4","CARDS4","LINES4"]),qe.isCards4=p(["DATALINES4","CARDS4","LINES4"]),qe.isParmcards=p(["PARMCARDS","PARMCARDS4"]),qe.isParmcards4=p(["PARMCARDS4"]),qe.isQuoting=p(["%STR","%NRSTR","%QUOTE","%NRQUOTE"]),qe.isBQuoting=p(["%SUPERQ","%BQUOTE","%NRBQUOTE"]),qe.isBinaryOpr=p(["**","+","-","*","/","&","|","!","","AND","OR","||","<>","><","=","EQ","^=","=","~=","NE",">","GT","<","LT",">=","GE","<=","LE","=:",">:","<:","^=:","=:","~=:",">=:","<=:"]),qe.isUnaryOpr=p(["","","~","NOT","+","-"]),qe.longBiOprs=/^(\^=:|\u00AC=:|~=:|>=:|<=:|\*\*|<>|\^=|\u00AC=|~=|>=|<=|\|\||=:|>:|<:)/;class Fe{constructor(...e){1===arguments.length?(this.startLine=arguments[0].startLine,this.startCol=arguments[0].startCol,this.endLine=arguments[0].endLine,this.endCol=arguments[0].endCol,this.type=arguments[0].type,this.name=arguments[0].name,this.endFoldingLine=arguments[0].endFoldingLine,this.endFoldingCol=arguments[0].endFoldingCol,this.outerBlock=arguments[0].outerBlock,this.innerBlocks=[...arguments[0].innerBlocks]):arguments.length>=4?(this.startLine=arguments[0],this.startCol=arguments[1],this.endLine=arguments[2],this.endCol=arguments[3],this.type=arguments[4],this.name=arguments[5]?arguments[5]:"",this.innerBlocks=[],this.endFoldingLine=-1,this.endFoldingCol=-1):(this.startLine=-1,this.startCol=-1,this.endLine=-1,this.endCol=-1,this.type=-1,this.name="",this.endFoldingLine=-1,this.endFoldingCol=-1,this.innerBlocks=[])}}const Be=Fe,Ue={OPTION:"OPTIONS",GOPTION:"GOPTIONS"},Ye=/(\/\*[\s\S]*?\*\/)|(^\s*\*[\s\S]*?;)|(;\s*\*[\s\S]*?;)|(%\*[\s\S]*?;)/i,je=/('|")([\s\S]*?)(\1)/i,We=/%macro\b(?!.+%mend;)/i,Ke=/(^\s*|;\s*)(data)(;|[\s]+[^;]*;)/i,Ve=/(^\s*|;\s*)(proc)(\s*\/\*[\s\S]+\*\/\s*|\s+)(explode)(;|[\s]+[^;]*;)/i,He=/([^;]*;)/im,Ge=/(\n^;;;;)/im,Ze={start:Ke,cards:/(;[\s]*)(cards|lines|datalines)(;|[\s]+[^;]*;)/i,end:He},$e={start:Ke,cards:/(;[\s]*)(cards4|lines4|datalines4)(;|[\s]+[^;]*;)/i,end:Ge},ze={start:Ve,cards:/(;[\s]*)(parmcards)(;|[\s]+[^;]*;)/i,end:He},Qe={start:Ve,cards:/(;[\s]*)(parmcards4)(;|[\s]+[^;]*;)/i,end:Ge};class Je{constructor(e){this.model=e,this.sections=[],this.tailSections=[],this.tokens=[],this.tknBlks=[],this.tailTknBlks=[],this.changedLineCount=0,this.changedColCount=0,this.OptionCheckers_={"proc-def":{getOptionType:function(e){return this.syntaxDb.getProcedureOptionType(this.curr.name,e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureSubOptKeyword(this.curr.name,e,t)},checkOption:function(e){return this.syntaxDb.isProcedureOptionKeyword(this.curr.name,e)}},"proc-stmt":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType(this.curr.procName,this.curr.name,e)},checkSubOption:function(e,t,n){return this.handleLongStmtSubOptionName_(this.curr.procName,this.curr.name,e,t,n).isKeyword||this.handleLongStmtOptionName_(this.curr.procName,this.curr.name,t,n).isKeyword||!!Je.stmtWithDatasetOption_[this.curr.procName+"/"+this.curr.name]&&this.syntaxDb.isDatasetKeyword(t)},checkOption:function(e){return this.handleLongStmtOptionName_(this.curr.procName,this.curr.name,e).isKeyword}},"data-def":{getOptionType:function(e){return""},checkSubOption:function(e,t){return this.syntaxDb.isDatasetKeyword(t)},checkOption:function(e){return this.syntaxDb.isProcedureOptionKeyword("DATA",e)}},"data-stmt":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType("DATA",this.curr.name,e)},checkSubOption:function(e,t){let n=this.syntaxDb.isProcedureStatementSubOptKeyword("DATA",this.curr.name,e,t);return n||Je.stmtWithDatasetOption_["DATA/"+this.curr.name]&&(n=this.syntaxDb.isDatasetKeyword(t)),n},checkOption:function(e){return this.syntaxDb.isProcedureStatementKeyword("DATA",this.curr.name,e)}},"macro-def":{getOptionType:function(e){return this.syntaxDb.getProcedureOptionType("MACRO",e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureSubOptKeyword("MACRO",e,t)},checkOption:function(e){return this.syntaxDb.isProcedureOptionKeyword("MACRO",e)}},"macro-stmt":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType("MACRO",this.curr.name,e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureStatementSubOptKeyword("MACRO",this.curr.name,e,t)},checkOption:function(e){return this.syntaxDb.isProcedureStatementKeyword("MACRO",this.curr.name,e)}},"gbl-stmt":{getOptionType:function(e){return this.syntaxDb.getStatementOptionType(this._cleanKeyword(this.curr.name),e)},checkSubOption:function(e,t){return this.syntaxDb.isStatementSubOptKeyword(this._cleanKeyword(this.curr.name),e,t)},checkOption:function(e){return this.syntaxDb.isStatementKeyword("global",this._cleanKeyword(this.curr.name),e)||this.syntaxDb.isStatementKeyword("standalone",this._cleanKeyword(this.curr.name),e)}},"sg-def":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType("TEMPLATE","BEGINGRAPH",e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureStatementSubOptKeyword("TEMPLATE","BEGINGRAPH",e,t)},checkOption:function(e){return this.syntaxDb.isProcedureStatementKeyword("TEMPLATE","BEGINGRAPH",e)}},"sg-stmt":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType("STATGRAPH",this.curr.name,e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureStatementSubOptKeyword("STATGRAPH",this.curr.name,e,t)},checkOption:function(e){return this.syntaxDb.isProcedureStatementKeyword("STATGRAPH",this.curr.name,e)}},"dt-def":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType("TEMPLATE","DEFINE TAGSET",e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureStatementSubOptKeyword("TEMPLATE",this.curr.name,e,t)},checkOption:function(e){return this.syntaxDb.isProcedureStatementKeyword("TEMPLATE","DEFINE TAGSET",e)}},"dt-stmt":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType("DEFINE_TAGSET",this.curr.name,e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureStatementSubOptKeyword("DEFINE_TAGSET",this.curr.name,e,t)},checkOption:function(e){return this.syntaxDb.isProcedureStatementKeyword("DEFINE_TAGSET",this.curr.name,e)}},"de-def":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType("TEMPLATE","DEFINE EVENT",e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureStatementSubOptKeyword("TEMPLATE","DEFINE EVENT",e,t)},checkOption:function(e){return this.syntaxDb.isProcedureStatementKeyword("TEMPLATE","DEFINE EVENT",e)}},"de-stmt":{getOptionType:function(e){return this.syntaxDb.getProcedureStatementOptionType("DEFINE_EVENT",this.curr.name,e)},checkSubOption:function(e,t){return this.syntaxDb.isProcedureStatementSubOptKeyword("DEFINE_EVENT",this.curr.name,e,t)},checkOption:function(e){return this.syntaxDb.isProcedureStatementKeyword("DEFINE_EVENT",this.curr.name,e)}}},this.sectionEndStmts_={RUN:1,"RUN CANCEL":1,QUIT:1},this.specialStmts_={"DATASETS/IC CREATE":1,"TRANSREG/MODEL":1},this.DS2_={DS2:1,HPDS2:1},this.lexer=new qe(e),this.expr=new Xe(this),this.syntaxDb=new Ae,this.SEC_TYPE=Je.SEC_TYPE,this.PARSING_STATE={IN_GBL:0,IN_MACRO:1,IN_PROC:2,IN_DATA:3},this.isTokenWithScopeMarks={comment:1,"macro-comment":1,string:1,date:1,time:1,dt:1,bitmask:1,namelit:1,hex:1},this.CARDS_STATE={IN_NULL:0,IN_CMD:1,IN_DATA:2,IN_DATA_WAITING:3},this.cardsState=this.CARDS_STATE.IN_NULL,this.startLineForCardsData=0,this.stack=null,this.curr=null,this.lookAheadTokens=[],this.sectionCache=[],this.lastToken=null,this.sections=[],this.currSection=new Fe}getBlockPos2_(e,t,n,o){let i=t,s=e[i];const r={line:n,column:o};if(!s||this._isBetween(r,this._startPos(s),this._endPos(s),!0))return t;if(this._isBefore(r,this._startPos(s))){do{i--,s=e[i]}while(s&&!this._isBetween(r,this._startPos(s),this._endPos(s),!0));return s?i:-1}do{i++,s=e[i]}while(s&&!this._isBetween(r,this._startPos(s),this._endPos(s),!0));return s?i:-1}_startPos(e){return{line:e.startLine,column:e.startCol}}_endPos(e){return{line:e.endLine,column:e.endCol}}_setStart(e,t){e.startLine=t.line,e.startCol=t.column}_setEnd(e,t){e.endLine=t.line,e.endCol=t.column}_sectionEndPos(e){return{line:e.endFoldingLine,column:e.endFoldingCol}}_setSectionEnd(e,t){e.endFoldingLine=t.line,e.endFoldingCol=t.column}_getNextValidTknBlkIdx(e){let t,n=e;const o=this.sections.length-1;for(;n<=o;){if(t=this.sections[n],t&&t.specialBlks)return t.specialBlks[0];n++}return-1}_checkCards4(e,t){let n=null;const o=e.start.exec(t);return o&&(t=t.substring(o.index+o[0].length),n=e.cards.exec(t)),n}_saveRemoveDataLines(e,t){let n;function o(t){let o,i,s,r;const a=[];for(n=!0;;){if(o=e.start.exec(t),!o){a.push(t);break}if(r=o.index+o[0].length,a.push(t.substring(0,r)),t=";"+t.substring(r),i=e.cards.exec(t),!i){a.push(t.substring(1));break}if(a.push(t.substring(0,i.index+1)),t=t.substring(i.index+i[0].length),s=e.end.exec(t),!s){a.push(i[0]);break}if(t=t.substring(s.index+s[0].length),a.length>400){n=!1;break}}return a.join("")}do{t=o(t)}while(!n);return t}_remove(e,t,n){const o=[];for(;;){const i=e.exec(t);if(!i){o.push(t);break}o.push(t.substring(0,i.index)),n&&o.push(n),t=t.substring(i.index+i[0].length)}return o.join("")}_removeComment(e){return this._remove(Ye,e)}_removeConst(e){return this._remove(je,e,"x")}_isBlank(e){return/^\s*$/.test(e)}_isTailDestroyed(e,t){const n=e.oldRange;return!!(!this._isBefore(n.end,this._endPos(t))||t.type!==Je.SEC_TYPE.GBL&&t.explicitEnd&&this._isBefore(t.explicitEndStmt.start,n.end))}_isCollapsedPartially(e){return e&&e.collapsed&&e.endLine!==e.endFoldingLine}_isBetween(e,t,n,o){return this._isBefore(t,e,o)&&this._isBefore(e,n,o)}_isBefore(e,t,n){return e.line<t.line||e.line===t.line&&(n?e.column<=t.column:e.column<t.column)}_getBlkIndex(e,t,n){let o=e,i=this.sections[o],s=null;for(;i&&!i[t];)o++,i=this.sections[o];return i&&(s=i[t]),s?s[0]:n.length}_handleSpecialBlocks(e,t,n,o){if(this.sections.length<=0||t.removedBlocks.count<=0)return;const i=n(t.removedBlocks.start),s=n(t.removedBlocks.end+1),r=o;return o=r.splice(0,i),r.length>0&&s>i&&(r.splice(0,s-i),this._adjustBlocksCoord(r,e,t)),{blocks:o,unchangedBlocks:r}}_getTknBlkIndex(e){return this._getBlkIndex(e,"specialBlks",this.tknBlks)}_adjustPosCoord(e,t){if(t.line===e.oldRange.end.line){let n,o=-1;const i=e.text.length,s=e.oldRange.start.column,r=t.column-e.oldRange.end.column;o=e.text.lastIndexOf("\n"),n=o>=0?"\n"===e.text[e.text.length-1]?r:i-o-1+r:s+i+r,t.column=n}t.line+=e.newRange.end.line-e.newRange.start.line-e.oldRange.end.line+e.oldRange.start.line}_adjustBlocksCoord(e,t,n){const o=e.length;let i,s;for(this.changedLineCount=t.newRange.end.line-t.newRange.start.line-t.oldRange.end.line+t.oldRange.start.line,i=0;i<o&&!(e[i].startLine>n.endLine&&0===this.changedLineCount);i++)s=this._startPos(e[i]),this._adjustPosCoord(t,s),this._setStart(e[i],s),s=this._endPos(e[i]),this._adjustPosCoord(t,s),this._setEnd(e[i],s),p([Je.SEC_TYPE.DATA,Je.SEC_TYPE.PROC,Je.SEC_TYPE.MACRO])[e[i].type]&&(s=this._sectionEndPos(e[i]),this._adjustPosCoord(t,s),this._setSectionEnd(e[i],s))}_isHeadDestroyed(e,t){const n=e.oldRange,o=this._isBlank(e.text+e.removedText);if(this._isBefore(n.start,this._startPos(t))&&!o)return!0;if(n.start.line===t.startLine){const i=n.start.column-t.startCol;if("="===e.text){const e=this.model.getLine(t.startLine).slice(t.startCol,n.start.column);return/(PROC|PROCEDURE|DATA)\s*/i.test(this._removeComment(e))}if(0===i&&o)return!1;if(i<=t.name.length)return!0}return!1}_cleanKeyword(e){if(/^(TITLE|FOOTNOTE|AXIS|LEGEND|PATTERN|SYMBOL)\d{0,}$/.test(e)){const t=e.match(/(^(TITLE|FOOTNOTE|AXIS|LEGEND|PATTERN|SYMBOL)|\d{0,}$)/g),n=parseInt(t[1],10);let o=!1;switch(t[0]){case"TITLE":case"FOOTNOTE":o=n<11&&n>0;break;case"AXIS":case"LEGEND":o=n<100&&n>0;break;case"PATTERN":case"SYMBOL":o=n<256&&n>0}o&&(e=t[0])}else{const t=Ue[e];t&&(e=t)}return e}adjustFoldingEnd_(e,t){e.endLine>e.startLine&&e.endLine===t.startLine?(e.endFoldingLine=e.endLine-1,e.endFoldingCol=this.model.getColumnCount(e.endFoldingLine)):(e.endFoldingLine=e.endLine,e.endFoldingCol=e.endCol)}_pushRootBlock(e){const t=[e];for(;t.length>0;){const e=t.pop();for(let n=e.innerBlocks.length-1;n>=0;n--){const o=e.innerBlocks[n];t.push(o)}}this._adjustBlockTreeFoldingEnd(e),this.sections.length&&this.adjustFoldingEnd_(this.sections[this.sections.length-1],e),this.sections.push(e),this.tokens=[]}_adjustBlockTreeFoldingEnd(e){for(let t=1;t<e.innerBlocks.length;t++)this.adjustFoldingEnd_(e.innerBlocks[t-1],e.innerBlocks[t]);for(let t=0;t<e.innerBlocks.length;t++)this._adjustBlockTreeFoldingEnd(e.innerBlocks[t])}_changeCardsDataToken(e){return this.tokens.pop(),this.tokens.push(e),e}_clonePos(e){return{line:e.line,column:e.column}}startFoldingBlock_(e,t,n){const o=new Fe;o.startLine=t.line,o.startCol=t.column,o.type=e,o.name=n,o.specialBlks=null,this.currSection?(this.currSection.innerBlocks.push(o),o.outerBlock=this.currSection,this.currSection=o):this.currSection=o}endFoldingBlock_(e,t,n,o,i){this.currSection&&(t.line>=this.currSection.startLine&&(this.currSection.endLine=t.line,this.currSection.endCol=t.column,this.trimBlock_(this.currSection),this.sectionCache[this.currSection.startLine]=null,this.currSection.endFoldingLine=this.currSection.endLine,this.currSection.endFoldingCol=this.currSection.endCol,this.currSection.outerBlock||(this.currSection.explicitEnd=n,n&&(this.currSection.explicitEndStmt={},this.currSection.explicitEndStmt.start=o?.start,this.currSection.explicitEndStmt.name=i),this.currSection.specialBlks&&(this.currSection.specialBlks=this.currSection.specialBlks,this.currSection.specialBlks=null),this._pushRootBlock(this.currSection))),this.currSection=this.currSection.outerBlock)}hasFoldingBlock_(){return!!this.currSection}getLastNormalFoldingBlockInLine_(e,t,n){let o=e,i=n[o],s=e;for(;i&&(i.startLine===t||i.endLine===t);)s=i.type!==this.SEC_TYPE.GBL?o:-1,o++,i=n[o];if(s<0)for(o=e-1,i=n[o];i&&(i.startLine===t||i.endLine===t);){if(i.type!==this.SEC_TYPE.GBL){s=o;break}s=-1,o--,i=n[o]}return n[s]??null}getFoldingBlock_(e,t,n,o){const i=this.getBlockPos_(e,t,n);let s=e[i],r=!1;return o?r=!!s:s&&s.startLine<=t&&s.endLine>=t?(s=this.getLastNormalFoldingBlockInLine_(i,t,e),r=!!s):n&&(s=e[e.length-1],!s||this._isBefore({line:t,column:n},this._endPos(s))||s.explicitEnd||(r=!0)),r?s.innerBlocks.length>0?this.getFoldingBlock_(s.innerBlocks,t,n,o)??s:s:null}getFoldingBlock(e,t,n,o,i){let s=null;if(void 0===t){if(!this.sectionCache[e]){const t=this.getFoldingBlock_(this.sections,e);t&&e<=t.endFoldingLine?this.sectionCache[e]=t:this.sectionCache[e]=null}s=this.sectionCache[e]}else s=this.getFoldingBlock_(this.sections,e,t,n);for(;o&&s?.type===this.SEC_TYPE.CUSTOM||i&&s?.type===this.SEC_TYPE.GBL;)s=s.outerBlock??null;return s}getBlockPos_(e,t,n){let o=this.getBlockPos1_(e,t);return(n||0===n)&&(o=this.getBlockPos2_(e,o,t,n)),o}getBlockPos1_(e,t){const n=e.length,o={};let i=Math.floor(n/2),s=0,r=n-1;if(n)for(;;){if(o[i]=!0,t<=e[i].endLine){if(t>=e[i].startLine)return i;r=i,i=Math.floor((s+r)/2)}else s=i,i=Math.ceil((s+r)/2);if(o[i])return t>=e[i].endLine?i+1:i}return 0}resetFoldingBlockCache_(){this.sections=[]}tryEndFoldingBlock_(e,t,n){if(n||(n=e),this.hasFoldingBlock_()){let o=this.SEC_TYPE.PROC;this.curr.state===this.PARSING_STATE.IN_DATA?o=this.SEC_TYPE.DATA:this.curr.state===this.PARSING_STATE.IN_MACRO?o=this.SEC_TYPE.MACRO:this.curr.state===this.PARSING_STATE.IN_GBL&&(o=this.SEC_TYPE.GBL);let i=!1;for(;this.currSection&&!i;)t&&this.currSection.type===t&&(i=!0),this.endFoldingBlock_(o,i?n:e)}}tryStop_(e){let t=this.tailSections.length;if(this.tryToAddTknBlock_(e),e&&t&&!this._isBefore(e.start,this._startPos(this.tailSections[0]))){if(this.hasFoldingBlock_()){if(this.currSection?.type===this.SEC_TYPE.MACRO)return void this.tailSections.splice(0,1);this.tryEndFoldingBlock_(this.lastToken.end)}let n,o=this.tknBlks.length,i=this.sections.length,s=0;throw this.tailSections.forEach(e=>{if(e.specialBlks)for(n=0,t=e.specialBlks.length;n<t;n++)e.specialBlks[n]=o,this.tailTknBlks[s]&&(this.tailTknBlks[s].sectionIdx=i),s++,o++;i++}),this.sections.length&&this.tailSections.length&&this.adjustFoldingEnd_(this.sections[this.sections.length-1],this.tailSections[0]),this.sections=this.sections.concat(this.tailSections),this.tknBlks=this.tknBlks.concat(this.tailTknBlks),this.lastToken=null,{changedLineCount:this.changedLineCount,changedColCount:this.changedColCount,type:"skip-syntax-parsing",token:e}}e&&this.tokens.push(e)}printBlocks(){for(let e=0;e<this.sections.length;e++);}normalizeStart_(e){0!==e.startCol&&e.startCol===this.model.getColumnCount(e.startLine)&&e.startLine+1<this.model.getLineCount()&&(e.startLine++,e.startCol=0)}normalizeEnd_(e){e.endCol<=0&&e.endLine>0&&this.model.getColumnCount(e.endCol)>0&&(e.endLine--,e.endCol=this.model.getColumnCount(e.endLine))}normalizeBlock_(e){this.normalizeStart_(e),this.normalizeEnd_(e)}trimBlock_(e){const t=this.getLastToken_(e);t&&(e.endLine=t.end.line,e.endCol=t.end.column),this.normalizeBlock_(e)}getLastToken_(e){let t=this.tokens.length-1;for(;this.tokens[t]&&(this.tokens[t].start.line>e.endLine||this.tokens[t].start.line===e.endLine&&this.tokens[t].start.column>=e.endCol);)t--;for(;t>=0&&/^\s*$/g.test(this.lexer.getText(this.tokens[t]));)t--;return t>=0?this.tokens[t]:null}getChange_(e,t){const n=this.getBlockPos_(e,t.line,t.column);let o=n,i={startLine:0,startCol:0,endLine:0,endCol:0};return e[n]?i=e[n]:e.length>0&&n>=e.length&&(o=e.length-1,i=e[o],i.explicitEnd&&(i={startLine:i.endLine,startCol:i.endCol,endLine:this.model.getLineCount()-1,endCol:0},i.endCol=this.model.getColumnCount(i.endLine),this._isBefore(this._endPos(i),this._startPos(i))&&(i.endLine=i.startLine,i.endCol=i.startCol),o++)),{startLine:i.startLine,startCol:i.startCol,endLine:i.endLine,endCol:i.endCol,blockIdx:o}}_getParseRange(e,t){const n=t.oldRange,o=this.getChange_(e,n.start),i={};let s,r=o;if(n.start.line===n.end.line&&n.start.column===n.end.column)o.removedBlocks={start:o.blockIdx,end:o.blockIdx};else if(s=this.getChange_(e,n.end),s.startLine>o.startLine&&s.endLine<o.endLine)o.removedBlocks={start:o.blockIdx,end:o.blockIdx};else{let e,t,n,a;s.startLine>o.startLine?(e=o.startLine,t=o.startCol):o.startLine===s.startLine?(e=o.startLine,t=o.startCol>s.startCol?s.startCol:o.startCol):(e=s.startLine,t=s.startCol),o.endLine>s.endLine?(n=o.endLine,a=o.endCol):o.endLine===s.endLine?(n=o.endLine,a=o.endCol>s.endCol?o.endCol:s.endCol):(n=s.endLine,a=s.endCol),i.start=o.blockIdx,i.end=s.blockIdx,r={startLine:e,startCol:t,endLine:n,endCol:a,removedBlocks:i}}return r}getParseRange(e){return this.getParseRangeBySections_(e)}getParseRangeBySections_(e){const t=this.sections,n=this._getParseRange(t,e);let o=t[n.removedBlocks.start-1],i=null;o?(n.startLine=o.endLine,n.startCol=o.endCol):(n.startLine=0,n.startCol=0),o=t[n.removedBlocks.start],o&&(i=t[n.removedBlocks.start-1],i&&(this._isHeadDestroyed(e,o)&&!i.explicitEnd||this._isCollapsedPartially(i))?(n.startLine=i.startLine,n.startCol=i.startCol,n.removedBlocks.start--):!this._isBefore(e.oldRange.start,this._endPos(o))&&o.explicitEnd&&(n.removedBlocks.start++,n.startLine=o.endLine,n.startCol=o.endCol));const s=this._checkSpecialChange(e,n);if(s>=0)s===this.sections.length?(n.endLine=this.model.getLineCount()-1,n.endCol=this.model.getColumnCount(n.endLine),n.removedBlocks.end=t.length-1):s>n.removedBlocks.end&&(n.endLine=this.sections[s].endLine,n.endCol=this.sections[s].endCol,n.removedBlocks.end=s);else{let i=n.removedBlocks.end,s=null;if(o=t[i],o&&this._isTailDestroyed(e,o)){do{i++,s=t[i]}while(s&&s.type===this.SEC_TYPE.GBL);s?(i--,i===n.removedBlocks.end&&i++,s=t[i],n.endLine=s.endLine,n.endCol=s.endCol):(n.endLine=this.model.getLineCount()-1,n.endCol=this.model.getColumnCount(n.endLine)),n.removedBlocks.end=i}}if(n.removedBlocks.end>=t.length&&(n.removedBlocks.end=t.length-1),n.removedBlocks.start>=0&&n.removedBlocks.start<t.length?n.removedBlocks.count=n.removedBlocks.end-n.removedBlocks.start+1:n.removedBlocks.count=0,t.length>0&&n.removedBlocks.count>0){n.removedBlocks.blocks=[];for(let e=n.removedBlocks.start;e>=0&&e<=n.removedBlocks.end;e++)n.removedBlocks.blocks.push(t[e])}return n}trimRange_(e){for(e.endLine>this.model.getLineCount()&&(e.endLine=this.model.getLineCount()-1,e.endLine<0&&(e.endCol=0));e.endCol<=0;){if(e.endLine--,e.endLine<0){e.endLine=0,e.endCol=0;break}e.endCol=this.model.getColumnCount(e.endLine)}}start_(e){const t=this.getParseRangeBySections_(e);return this._handleTokens(e,t),this._handleSections(e,t),this.stack=[{parse:this.readProg_,state:this.PARSING_STATE.IN_GBL}],this.curr=null,this.currSection=void 0,this.sectionCache.splice(t.startLine,this.sectionCache.length-t.startLine),this.lexer.startFrom(t.startLine,t.startCol),t}_handleSections(e,t){if(this.tailSections=this.sections,this.sections=this.tailSections.splice(0,t.removedBlocks.start),void 0!==t.removedBlocks&&this.tailSections.splice(0,t.removedBlocks.count),this.changedColCount=0,this.tailSections.length){const n=this.tailSections[0].startCol;this._adjustBlocksCoord(this.tailSections,e,t),this.changedColCount=this.tailSections[0].startCol-n}}_docEndPos(){const e=this.model.getLineCount()-1;return{line:e,column:this.model.getColumnCount(e)}}_getParseText(e,t){const n=this.sections[t.removedBlocks.start],o=this.sections[t.removedBlocks.end],i=[];let s,r,a,c;if(!n)return e.text;const l=this.sections[t.removedBlocks.start-1];if(s=l?this._endPos(l):{line:0,column:0},"textChanged"===e.type)return c=this.sections[t.removedBlocks.end+1],c?(a=new Fe(c),i.push(a),this._adjustBlocksCoord(i,e,t),r=this._startPos(a)):r=this._docEndPos(),this.model.getText({start:s,end:r});{const t=this.model.getText({start:s,end:e.oldRange.start});r=o?this._endPos(o):this._docEndPos();const n=this.model.getText({start:e.oldRange.end,end:r});return t+e.text+n}}_getNextComment(e){let t=this._getNextValidTknBlkIdx(e);for(;this.tknBlks[t]&&!0!==this.tknBlks[t].blockComment;)t++;return this.tknBlks[t]}_getNextCards4(e){let t=this._getNextValidTknBlkIdx(e);for(;this.tknBlks[t]&&!qe.isCards4[this.tknBlks[t].name]&&!qe.isParmcards4[this.tknBlks[t].name];)t++;return this.tknBlks[t]}_checkSpecialChange(e,t){const n=/\/\*/gim;let o=this._getParseText(e,t),i=null,s=null,r=-1;return o=this._removeComment(o),o=this._removeConst(o),o=this._saveRemoveDataLines(Ze,o),o=this._saveRemoveDataLines($e,o),o=this._saveRemoveDataLines(ze,o),o=this._saveRemoveDataLines(Qe,o),o=o.replace(/\n/g," "),(e=n.test(o))&&(i=this._getNextComment(t.removedBlocks.end+1),i&&(o+=" /**/",r=i.sectionIdx,o=this._removeComment(o),n.lastIndex=0,e=n.test(o)),e)||(e=/['"]/gim.test(o))||(e=We.test(o))||o.lastIndexOf("*")>0&&(r=t.removedBlocks.end+1,r>this.sections.length)?this.sections.length:r>0?r:(e=this._checkCards4($e,o))&&(t.removedBlocks&&(s=this._getNextCards4(t.removedBlocks.end+1),s&&(o+=" \n;;;;\n",r=s.sectionIdx,o=this._saveRemoveDataLines($e,o),e=this._checkCards4($e,o))),e)||(e=this._checkCards4(Qe,o))&&(t.removedBlocks&&(s=this._getNextCards4(t.removedBlocks.end+1),s&&(o+=" \n;;;;\n",r=s.sectionIdx,o=this._saveRemoveDataLines(Qe,o),e=this._checkCards4(Qe,o))),e)?this.sections.length:r>0?r:-1}_handleTokens(e,t){const n=this._handleSpecialBlocks(e,t,this._getTknBlkIndex,this.tknBlks);n&&(this.tknBlks=n.blocks,this.tailTknBlks=n.unchangedBlocks)}setKeyword_(e,t){return"text"===e.type&&t&&(e.type=qe.TOKEN_TYPES.KEYWORD,e.notCheckKeyword=!0),e}addTknBlock_(e){this.currSection&&(this.currSection.specialBlks||(this.currSection.specialBlks=[]),this.currSection.specialBlks.push(this.tknBlks.length),this.tknBlks.push(e))}tryToAddTknBlock_(e){if(e&&this.isTokenWithScopeMarks[e.type]){const t=new Be(e.start.line,e.start.column,e.end.line,e.end.column,e.type,this.lexer.getText(e));t.sectionIdx=this.sections.length,t.blockComment="/"===this.model.getLine(e.start.line)[e.start.column],this.addTknBlock_(t)}}tryToAddCardsBlock_(e){if(e&&e.type===qe.TOKEN_TYPES.CARDSDATA){const t=new Be(e.start.line,e.start.column,e.end.line,e.end.column,e.type,this.curr.name);t.sectionIdx=this.sections.length,this.addTknBlock_(t)}}start(e){return this.lookAheadTokens=[],this.start_(e)}end(){return this.lexer.end()&&0===this.lookAheadTokens.length}reset(){return this.resetFoldingBlockCache_(),this.lexer.reset()}getNext(){this.curr=this.stack[this.stack.length-1];const e=this.curr.parse.apply(this);if(this.curr=this.stack[this.stack.length-1],this.tryToAddCardsBlock_(e),!e||this.end()){const e=this.model.getLineCount()-1,t=e>=0?this.model.getColumnCount(e):0;this.tryEndFoldingBlock_({line:e,column:t})}return this.lastToken=e,e}getNext_(){let e=null;if(this.lookAheadTokens.length>0)e=this.lookAheadTokens.shift();else{const t=this.lexer.getNext();e=t?{type:t.type,text:t.text,start:Object.assign({},t.start),end:Object.assign({},t.end)}:t}return this.tryStop_(e),e}cacheToken_(e){let t;return e&&(t={type:e.type,text:e.text,start:Object.assign({},e.start),end:Object.assign({},e.end)},this.lookAheadTokens.push(t)),t}prefetch0_(e){let t=null;if(this.lookAheadTokens.length>=e)t=this.lookAheadTokens[e-1];else{const n=e-this.lookAheadTokens.length;for(let e=0;e<n;e++)t=this.cacheToken_(this.lexer.getNext())}return t}prefetch_(e){let t=null;do{t=this.prefetch0_(e.pos),e.pos++}while(t&&qe.isComment[t.type]);return t}isNextTokenColon_(){const e=this.prefetch0_(1);return!(!e||":"!==e.text)}getWord_(e){return this.lexer.getWord(e).toUpperCase()}isLabel_(e){const t=this.prefetch_({pos:1});return t&&":"===t.text}isAssignment_(e){if("PROC"===e.text||"PROCEDURE"===e.text||"DATA"===e.text||"RUN"===e.text||"QUIT"===e.text){const e=this.prefetch_({pos:1});return e&&"="===e.text}return!1}isCustomBlockStart_(e){return!(!e||(t=e.text,!/^\s*[%/]?\*\s*region\b/i.test(t??"")));var t}isCustomBlockEnd_(e){return!(!e||(t=e.text,!/^\s*[%/]?\*\s*endregion\b/i.test(t??"")));var t}readProg_(){let e,t,n="",o=!0;const i=this.getNext_();if(!i)return null;if(qe.isWord[i.type]&&(e=this.isLabel_(i),t=this.isAssignment_(i),!e&&!t))switch(n=i.text,n){case"PROC":case"PROCEDURE":{this.startFoldingBlock_(this.SEC_TYPE.PROC,i.start,n),i.type=qe.TOKEN_TYPES.SKEYWORD;const e=this.handleProcName_();this.stack.push({parse:this.readProc_,state:this.PARSING_STATE.IN_PROC,name:e}),this.stack.push({parse:this.readProcDef_,state:this.PARSING_STATE.IN_PROC,name:e}),o=!1;break}case"%MACRO":this.startFoldingBlock_(this.SEC_TYPE.MACRO,i.start,n),i.type=qe.TOKEN_TYPES.MSKEYWORD,this.stack.push({parse:this.readMacro_,state:this.PARSING_STATE.IN_MACRO}),this.stack.push({parse:this.readMacroDef_,state:this.PARSING_STATE.IN_MACRO}),o=!1;break;case"DATA":this.startFoldingBlock_(this.SEC_TYPE.DATA,i.start,n),i.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.push({parse:this.readData_,state:this.PARSING_STATE.IN_DATA}),this.stack.push({parse:this.readDataDef_,state:this.PARSING_STATE.IN_DATA}),o=!1}if(o)if(qe.isComment[i.type]?this.isCustomBlockStart_(i)?this.startFoldingBlock_(this.SEC_TYPE.CUSTOM,i.start,i.text):this.isCustomBlockEnd_(i)&&this.tryEndFoldingBlock_(i.end,this.SEC_TYPE.CUSTOM):this.hasFoldingBlock_()||this.startFoldingBlock_(this.SEC_TYPE.GBL,i.start,n),this.stack.push({parse:this.readGbl_,state:this.PARSING_STATE.IN_GBL}),e)this.stack.push({parse:this.readLabel_,state:this.PARSING_STATE.IN_GBL});else if(i.type===qe.TOKEN_TYPES.MREF)this.handleMref_(this.PARSING_STATE.IN_GBL);else if(!qe.isComment[i.type]&&";"!==i.text){const e=this._cleanKeyword(n),o={parse:this.readGblStmt_,state:this.PARSING_STATE.IN_GBL,name:e};if(this.stack.push(o),!t&&qe.isWord[i.type]&&!this.tryToHandleSectionEnd_(i)){const t=this.handleLongStmtName_("",e);o.name=t.stmtName,this.setKeyword_(i,t.isKeyword),o.hasSlashOptionDelimiter=this.syntaxDb.hasOptionDelimiter("",t.stmtName)}}return i}handleProcName_(){const e=this.prefetch_({pos:1});let t="";return e&&(t=e.text,e.type=qe.TOKEN_TYPES.PROCNAME,e.notCheckKeyword=!0),t}readProcDef_(){return this.handleStatement_(this.OptionCheckers_["proc-def"])}readDataDef_(){return this.handleStatement_(this.OptionCheckers_["data-def"])}readMacroDef_(){return this.handleStatement_(this.OptionCheckers_["macro-def"])}handleODSStmt_(e){let t=!1;const n=e.text,o="ODS",i=o;if(void 0===this.curr.fullName){const e=this.handleLongStmtName_(o,i+" "+n);1!==e.stmtNameLen||e.isKeyword?(this.curr.fullName=e.stmtName,t=e.isKeyword):(this.curr.fullName=i,t=this.syntaxDb._isStatementKeyword(i,n))}else t=this.curr.fullName===this.curr.name?this.syntaxDb._isStatementKeyword(i,n):this.syntaxDb.isProcedureStatementKeyword(o,this.curr.fullName,n);return this.setKeyword_(e,t),t}handleLongStmtName_(e,t){const n=t,o={pos:1},i=this.prefetch_(o);let s,r,a=!1,c=null,l=null,u=null,h=1,d=n;return i&&qe.isWord[i.type]&&(c=n+" "+i.text,s=this.prefetch_(o),s&&qe.isWord[s.type]&&(l=c+" "+s.text,r=this.prefetch_(o),r&&qe.isWord[r.type]&&(u=l+" "+r.text))),u&&(a=this.syntaxDb.isProcedureStatementKeyword(e,u),a&&(h=4,d=u,this.setKeyword_(i,!0),this.setKeyword_(s,!0),this.setKeyword_(r,!0))),!a&&l&&(a=this.syntaxDb.isProcedureStatementKeyword(e,l),a&&(h=3,d=l,this.setKeyword_(i,!0),this.setKeyword_(s,!0))),!a&&c&&(a=this.syntaxDb.isProcedureStatementKeyword(e,c),a&&(h=2,d=c,this.setKeyword_(i,!0))),a||(a=this.syntaxDb.isProcedureStatementKeyword(e,n)),{isKeyword:a,stmtName:d,stmtNameLen:h}}handleLongStmtOptionName_(e,t,n,o){const i={procName:e,stmtName:t,startWord:n,pos:o,checkKeyword:function(e,t){return this.syntaxDb.isProcedureStatementKeyword(e.procName,e.stmtName,t)}};return this.handleLongOptionName_(i)}handleLongStmtSubOptionName_(e,t,n,o,i){const s={procName:e,stmtName:t,optName:n,startWord:o,pos:i,checkKeyword:function(e,t){return this.syntaxDb.isProcedureStatementSubOptKeyword(e.procName,e.stmtName,e.optName,t)}};return this.handleLongOptionName_(s)}handleLongOptionName_(e){let t,n=!1,o=e.startWord,i=null,s=1,r=o,a={pos:1};return e.pos&&(a.pos=e.pos+1),t=this.prefetch_(a),t&&qe.isWord[t.type]&&(i=o+" "+t.text),i&&(n=e.checkKeyword.call(this,e,i),n&&(s=2,this.setKeyword_(t,!0),r=i)),n||(n=e.checkKeyword.call(this,e,o)),{isKeyword:n,name:r,nameLen:s}}tryToHandleSectionEnd_(e){let t=!1;if(this.sectionEndStmts_[e.text]){e.type="sec-keyword";const n=this.prefetch_({pos:1});n&&"CANCEL"===n.text&&(n.type=qe.TOKEN_TYPES.SKEYWORD),t=!0}return t}tryToHandleExpr_(e,t){if(this.curr.exprTokenCount&&(e.notCheckKeyword=!0,this.curr.exprTokenIndex++,this.curr.exprTokenIndex>this.curr.exprTokenCount&&(this.curr.exprTokenCount=0,e.notCheckKeyword=!1)),!this.curr.exprTokenCount){let n=!1,o=0;if(qe.isWord[e.type]){const t=this.prefetch_({pos:1});t&&{"=":1,"(":1}[t.text]&&("="===t.text&&(o=1),n=!0),t&&"("===t.text&&this.syntaxDb.isSasFunction(e.text)&&this.setKeyword_(e,!0)}else"="===e.text&&(n=!0);if(n){const n=this,i=this.expr.parse(this.curr.hasSlashOptionDelimiter,o,function(o,i){const s=t.getOptionType.call(n,e.text)||"";let r;r=n.syntaxDb.isDataSetType(s)?n.syntaxDb.isDatasetKeyword(o.text):t.checkSubOption.call(n,e.text,o.text,i),n.setKeyword_(o,r)});this.curr.exprTokenCount=i.pos,this.curr.exprTokenIndex=0}}}readGblStmt_(){return this.handleStatement_(this.OptionCheckers_["gbl-stmt"])}readProcStmt_(){const e=this.handleStatement_(this.OptionCheckers_["proc-stmt"]);if(e&&qe.isWord[e.type]&&this.specialStmts_[this.curr.procName+"/"+this.curr.name]){let t=!1;if(void 0!==this.curr.optNameLen&&this.curr.optNameLen>1)t=!0,this.curr.optNameLen--;else{const n=this.handleLongStmtOptionName_(this.curr.procName,this.curr.name,e.text);this.curr.optNameLen=n.nameLen,t=n.isKeyword}this.setKeyword_(e,t)}return e}readDataStmt_(){return this.handleStatement_(this.OptionCheckers_["data-stmt"])}readMacroStmt_(){return this.handleStatement_(this.OptionCheckers_["macro-stmt"])}popSMTo_(e){let t=this.stack.length-e;for(;t>0;)this.stack.pop(),t--}handleBlock_(e){let t="";const n=this.getNext_();if(!n)return null;if(qe.isWord[n.type])if(this.isLabel_())this.stack.push({parse:this.readLabel_,state:this.PARSING_STATE.IN_PROC});else if(this.isAssignment_(n))e.call(this,n);else switch(t=n.text,t){case"RUN":case"QUIT":n.type=qe.TOKEN_TYPES.SKEYWORD,this.popSMTo_(2),this.stack.push({parse:this.readEnd_,state:this.PARSING_STATE.IN_PROC,start:n,name:t});break;case"PROC":case"PROCEDURE":{this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.PROC,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.PROC,n.start,t),n.type=qe.TOKEN_TYPES.SKEYWORD,this.popSMTo_(1);const e=this.handleProcName_();this.stack.push({parse:this.readProc_,state:this.PARSING_STATE.IN_PROC,name:e}),this.stack.push({parse:this.readProcDef_,state:this.PARSING_STATE.IN_PROC,name:e});break}case"DATA":this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.PROC,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.DATA,n.start,t),n.type=qe.TOKEN_TYPES.SKEYWORD,this.popSMTo_(1),this.stack.push({parse:this.readData_,state:this.PARSING_STATE.IN_DATA}),this.stack.push({parse:this.readDataDef_,state:this.PARSING_STATE.IN_DATA});break;case"%MACRO":this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.PROC,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.MACRO,n.start,t),n.type=qe.TOKEN_TYPES.MSKEYWORD,this.popSMTo_(1),this.stack.push({parse:this.readMacro_,state:this.PARSING_STATE.IN_MACRO}),this.stack.push({parse:this.readMacroDef_,state:this.PARSING_STATE.IN_MACRO});break;default:e.call(this,n)}return n}handleStatement_(e){const t=this.getNext_();return t&&(this.tryToHandleExpr_(t,e),";"===t.text?this.stack.pop():qe.isWord[t.type]&&!t.notCheckKeyword&&("ODS"===this.curr.name?this.handleODSStmt_(t):e.checkOption&&this.setKeyword_(t,e.checkOption.call(this,t.text)))),t}handleEnd_(){const e=this.getNext_();return e&&";"===e.text&&(this.stack.pop(),this.stack.pop()),e}handleMref_(e){const t=this.prefetch_({pos:1});t&&"("===t.text&&this.stack.push({parse:this.readMRef_,state:e})}readLabel_(){const e=this.getNext_();return e&&":"===e.text&&this.stack.pop(),e}readMRef_(){const e=this.getNext_();if(e&&")"===e.text)this.stack.pop();else{const e=this.prefetch_({pos:1});e&&"("===e.text&&this.stack.push(this.curr)}return e}readComment_(){}readStatGraph_(){return this.handleBlock_(function(e){if("ENDGRAPH"===e.text)this.setKeyword_(e,!0),this.stack.push({parse:this.readStatGraphEnd_,state:this.PARSING_STATE.IN_PROC,start:e,name:e.text});else{const t={parse:this.readStatGraphStmt_,state:this.PARSING_STATE.IN_PROC,name:e.text};this.stack.push(t);let n=null,o=this.syntaxDb.isProcedureStatementKeyword("STATGRAPH",this._cleanKeyword(e.text));if(!o&&(n=this.prefetch_({pos:1}),n)){const i=e.text+" "+n.text;o=this.syntaxDb.isProcedureStatementKeyword("STATGRAPH",i),o&&(t.name=i,this.setKeyword_(n,!0))}this.setKeyword_(e,o)}})}readStatGraphDef_(){return this.handleStatement_(this.OptionCheckers_["sg-def"])}readStatGraphStmt_(){return this.handleStatement_(this.OptionCheckers_["sg-stmt"])}readStatGraphEnd_(){return this.handleEnd_()}readDefineTagset_(){return this.handleBlock_(function(e){let t=e.text;if("END"===e.text)this.setKeyword_(e,!0),this.stack.push({parse:this.readDefineTagsetEnd_,state:this.PARSING_STATE.IN_PROC,start:e,name:t});else{let n=!0;const o=this.prefetch_({pos:1});if(o){const i=t+" "+o.text;"DEFINE EVENT"===i&&(this.stack.push({parse:this.readDefineEvent_,state:this.PARSING_STATE.IN_PROC,name:i}),this.stack.push({parse:this.readDefineEventDef_,state:this.PARSING_STATE.IN_PROC,name:i}),n=!1,this.setKeyword_(o,!0),this.setKeyword_(e,!0))}if(n){const n={parse:this.readDefineTagsetStmt_,state:this.PARSING_STATE.IN_PROC,name:t};this.stack.push(n);let i=this.syntaxDb.isProcedureStatementKeyword("DEFINE_TAGSET",this._cleanKeyword(t));i||o&&(t+=" "+o.text,i=this.syntaxDb.isProcedureStatementKeyword("DEFINE_TAGSET",t),i&&(n.name=t,this.setKeyword_(o,!0))),this.setKeyword_(e,i)}}})}readDefineTagsetDef_(){return this.handleStatement_(this.OptionCheckers_["dt-def"])}readDefineTagsetStmt_(){return this.handleStatement_(this.OptionCheckers_["dt-stmt"])}readDefineTagsetEnd_(){return this.handleEnd_()}readDefineEvent_(){return this.handleBlock_(function(e){let t=e.text;if("END"===t)this.setKeyword_(e,!0),this.stack.push({parse:this.readDefineEventEnd_,state:this.PARSING_STATE.IN_PROC,start:e,name:t});else{const n={parse:this.readDefineEventStmt_,state:this.PARSING_STATE.IN_PROC,name:t};this.stack.push(n);let o=null,i=this.syntaxDb.isProcedureStatementKeyword("DEFINE_EVENT",this._cleanKeyword(t));i||(o=this.prefetch_({pos:1}),o&&(t+=" "+o.text,i=this.syntaxDb.isProcedureStatementKeyword("DEFINE_EVENT",t),i&&(this.setKeyword_(o,!0),n.name=t))),this.setKeyword_(e,i)}})}readDefineEventDef_(){return this.handleStatement_(this.OptionCheckers_["de-def"])}readDefineEventStmt_(){return this.handleStatement_(this.OptionCheckers_["de-stmt"])}readDefineEventEnd_(){return this.handleEnd_()}readSubmitOrInteractiveBlock_(){const e=this.getNext_(),t=this.prefetch_({pos:1}),n=this.prefetch_({pos:2}),o=this.prefetch_({pos:3});if(e)return t&&n&&o&&e.end.line<=t.start.line&&"embedded-code"===t.type&&["ENDSUBMIT","ENDINTERACTIVE"].includes(n.text)&&"sep"===o.type&&";"===o.text?(this.stack.push({parse:this.handleEnd_,state:this.PARSING_STATE.IN_PROC}),this.setKeyword_(n,!0)):t&&["DATA","PROC","%MACRO"].includes(t.text)&&this.stack.pop(),e}readProc_(){let e="";const t=this.getNext_(),n=this.curr.name||"";if(t){if(qe.isWord[t.type])if(this.isLabel_())this.stack.push({parse:this.readLabel_,state:this.PARSING_STATE.IN_PROC});else if(this.isAssignment_(t)){const t=this._cleanKeyword(e);this.stack.push({parse:this.readProcStmt_,state:this.PARSING_STATE.IN_PROC,name:t,procName:n})}else switch(e=t.text,e){case this.syntaxDb.isInteractiveProc(n)?"QUIT":"RUN":case"QUIT":t.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.push({parse:this.readEnd_,state:this.PARSING_STATE.IN_PROC,start:t,name:e});break;case"%MEND":t.type=qe.TOKEN_TYPES.MSKEYWORD,this.stack.length>2&&this.stack[this.stack.length-2].state===this.PARSING_STATE.IN_MACRO&&(this.stack.pop(),this.stack.push({parse:this.readMend_,state:this.PARSING_STATE.IN_MACRO,start:t,name:e}));break;case"PROC":case"PROCEDURE":{this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.PROC,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.PROC,t.start,e),t.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.pop();const n=this.handleProcName_();this.stack.push({parse:this.readProc_,state:this.PARSING_STATE.IN_PROC,name:n}),this.stack.push({parse:this.readProcDef_,state:this.PARSING_STATE.IN_PROC,name:n});break}case"%MACRO":this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.PROC,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.MACRO,t.start,e),t.type=qe.TOKEN_TYPES.MSKEYWORD,this.stack.pop(),this.stack.push({parse:this.readMacro_,state:this.PARSING_STATE.IN_MACRO}),this.stack.push({parse:this.readMacroDef_,state:this.PARSING_STATE.IN_MACRO});break;case"DATA":if(!this.DS2_[n]){this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.PROC,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.DATA,t.start,e),t.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.pop(),this.stack.push({parse:this.readData_,state:this.PARSING_STATE.IN_DATA}),this.stack.push({parse:this.readDataDef_,state:this.PARSING_STATE.IN_DATA});break}default:{this.tryToHandleSectionEnd_(t);let o=!0;if("TEMPLATE"===n)if("BEGINGRAPH"===e)this.stack.push({parse:this.readStatGraph_,state:this.PARSING_STATE.IN_PROC}),this.stack.push({parse:this.readStatGraphDef_,state:this.PARSING_STATE.IN_PROC}),this.setKeyword_(t,!0),o=!1;else{const n=this.prefetch_({pos:1});n&&"TAGSET"===n.text&&"DEFINE"===e&&(this.stack.push({parse:this.readDefineTagset_,state:this.PARSING_STATE.IN_PROC}),this.stack.push({parse:this.readDefineTagsetDef_,state:this.PARSING_STATE.IN_PROC}),this.setKeyword_(n,!0),this.setKeyword_(t,!0),o=!1)}else if("EXPLODE"===n)qe.isParmcards[e]&&(this.cardsState=this.CARDS_STATE.IN_CMD,this.stack.push({parse:this.readCards_,state:this.PARSING_STATE.IN_DATA,name:e,token:t}),this.setKeyword_(t,!0),o=!1);else if("LUA"===n||"PYTHON"===n){if(["SUBMIT","INTERACTIVE","I"].includes(e)){const e=this.prefetch_({pos:1});e&&";"===e.text&&"sep"===e.type&&(this.stack.push({parse:this.readSubmitOrInteractiveBlock_,state:this.PARSING_STATE.IN_PROC}),this.setKeyword_(t,!0),o=!1)}}else t.type===qe.TOKEN_TYPES.MREF&&(this.handleMref_(this.PARSING_STATE.IN_PROC),o=!1);if(o){const o=this._cleanKeyword(e),i={parse:this.readProcStmt_,state:this.PARSING_STATE.IN_PROC,name:o,procName:n};this.stack.push(i);const s=this.handleLongStmtName_(n,o);i.name=s.stmtName,this.setKeyword_(t,s.isKeyword),i.hasSlashOptionDelimiter=this.syntaxDb.hasOptionDelimiter(n,s.stmtName)}}}else qe.isComment[t.type]&&(this.isCustomBlockStart_(t)?this.startFoldingBlock_(this.SEC_TYPE.CUSTOM,t.start,t.text):this.isCustomBlockEnd_(t)&&this.searchBlockUpwardOfType_(this.currSection,this.SEC_TYPE.CUSTOM)&&this.tryEndFoldingBlock_(t.start,this.SEC_TYPE.CUSTOM,t.end));return t}}hasRunCancelFollowed_(){let e,t,n=!1;const o={pos:1};do{e=this.prefetch_(o)}while(e&&";"!==e.text);return e&&(e=this.prefetch_(o),t=this.prefetch_(o),e&&t&&(qe.isWord[e.type]&&":"===t.text&&(e=this.prefetch_(o),t=this.prefetch_(o)),e&&t&&"RUN"===e.text&&"CANCEL"===t.text&&(n=!0))),n}readData_(){let e="";const t=this.getNext_();if(t){if(qe.isWord[t.type])if(this.isLabel_())this.stack.push({parse:this.readLabel_,state:this.PARSING_STATE.IN_DATA});else if(this.isAssignment_(t)){const t=this._cleanKeyword(e);this.stack.push({parse:this.readDataStmt_,state:this.PARSING_STATE.IN_DATA,name:t})}else switch(e=t.text,e){case"%MEND":t.type=qe.TOKEN_TYPES.MSKEYWORD,this.stack.length>2&&this.stack[this.stack.length-2].state===this.PARSING_STATE.IN_MACRO&&(this.stack.pop(),this.stack.push({parse:this.readMend_,state:this.PARSING_STATE.IN_MACRO,start:t,name:e}));break;case"DATA":this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.DATA,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.DATA,t.start,e),t.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.push({parse:this.readDataDef_,state:this.PARSING_STATE.IN_DATA});break;case"PROC":case"PROCEDURE":{this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.DATA,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.PROC,t.start,e),t.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.pop();const n=this.handleProcName_();this.stack.push({parse:this.readProc_,state:this.PARSING_STATE.IN_PROC,name:n}),this.stack.push({parse:this.readProcDef_,state:this.PARSING_STATE.IN_PROC,name:n});break}case"%MACRO":this.currSection?.type===this.SEC_TYPE.CUSTOM?this.tryPromoteCustomBlock_():this.endFoldingBlock_(this.SEC_TYPE.DATA,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.MACRO,t.start,e),t.type=qe.TOKEN_TYPES.MSKEYWORD,this.stack.pop(),this.stack.push({parse:this.readMacro_,state:this.PARSING_STATE.IN_MACRO}),this.stack.push({parse:this.readMacroDef_,state:this.PARSING_STATE.IN_MACRO});break;case"RUN":case"QUIT":if(t.type=qe.TOKEN_TYPES.SKEYWORD,!this.hasRunCancelFollowed_()){this.tryToHandleSectionEnd_(t),this.stack.push({parse:this.readEnd_,state:this.PARSING_STATE.IN_DATA,start:t,name:e});break}default:if(qe.isCards[e])this.cardsState=this.CARDS_STATE.IN_CMD,this.stack.push({parse:this.readCards_,state:this.PARSING_STATE.IN_DATA,name:e,token:t}),this.setKeyword_(t,this.syntaxDb.isProcedureStatementKeyword("DATA",e));else if(t.type===qe.TOKEN_TYPES.MREF)this.handleMref_(this.PARSING_STATE.IN_DATA);else{const n=this._cleanKeyword(e),o={parse:this.readDataStmt_,state:this.PARSING_STATE.IN_DATA,name:n};if(this.stack.push(o),!this.tryToHandleSectionEnd_(t)){const e=this.handleLongStmtName_("DATA",n);o.name=e.stmtName,this.setKeyword_(t,e.isKeyword),o.hasSlashOptionDelimiter=this.syntaxDb.hasOptionDelimiter("DATA",e.stmtName)}}}else qe.isComment[t.type]&&(this.isCustomBlockStart_(t)?this.startFoldingBlock_(this.SEC_TYPE.CUSTOM,t.start,t.text):this.isCustomBlockEnd_(t)&&this.searchBlockUpwardOfType_(this.currSection,this.SEC_TYPE.CUSTOM)&&this.tryEndFoldingBlock_(t.start,this.SEC_TYPE.CUSTOM,t.end));return t}}searchBlockUpwardOfType_(e,t){let n=e;for(;n;){if(n.type===t)return n;n=n.outerBlock}return null}searchLastConsecutiveBlockUpwardOfType_(e){if(!e)return null;let t=e;for(;t.outerBlock&&t.outerBlock.type===t.type;)t=t.outerBlock;return t}tryPromoteCustomBlock_(){const e=this.currSection,t=this.searchLastConsecutiveBlockUpwardOfType_(this.currSection);if([this.SEC_TYPE.DATA,this.SEC_TYPE.PROC].includes(t?.outerBlock?.type)){const n=t.outerBlock;if(n){const o=n?.innerBlocks.indexOf(t);n?.innerBlocks.splice(o,1),this.currSection=n,this.endFoldingBlock_(n.type,{line:t.startLine,column:t.startCol}),n.outerBlock?.innerBlocks.push(t),t.outerBlock=n.outerBlock,this.currSection=e}}}readMacro_(){let e="";const t=this.getNext_();if(t){if(qe.isWord[t.type])if(this.isLabel_())this.stack.push({parse:this.readLabel_,state:this.PARSING_STATE.IN_MACRO});else if(this.isAssignment_(t)){const t=this._cleanKeyword(e);this.stack.push({parse:this.readMacroStmt_,state:this.PARSING_STATE.IN_MACRO,name:t})}else switch(e=t.text,e){case"%MEND":t.type=qe.TOKEN_TYPES.MSKEYWORD,this.stack.push({parse:this.readMend_,state:this.PARSING_STATE.IN_MACRO,start:t,name:e});break;case"%MACRO":this.startFoldingBlock_(this.SEC_TYPE.MACRO,t.start,e),t.type=qe.TOKEN_TYPES.MSKEYWORD,this.stack.push({parse:this.readMacro_,state:this.PARSING_STATE.IN_MACRO}),this.stack.push({parse:this.readMacroDef_,state:this.PARSING_STATE.IN_MACRO});break;case"PROC":case"PROCEDURE":{this.startFoldingBlock_(this.SEC_TYPE.PROC,t.start,e),t.type=qe.TOKEN_TYPES.SKEYWORD;const n=this.handleProcName_();this.stack.push({parse:this.readProc_,state:this.PARSING_STATE.IN_PROC,name:n}),this.stack.push({parse:this.readProcDef_,state:this.PARSING_STATE.IN_PROC,name:n});break}case"DATA":this.startFoldingBlock_(this.SEC_TYPE.DATA,t.start,e),t.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.push({parse:this.readData_,state:this.PARSING_STATE.IN_DATA}),this.stack.push({parse:this.readDataDef_,state:this.PARSING_STATE.IN_DATA});break;default:if(t.type===qe.TOKEN_TYPES.MREF)this.handleMref_(this.PARSING_STATE.IN_MACRO);else{const n=this._cleanKeyword(e),o={parse:this.readMacroStmt_,state:this.PARSING_STATE.IN_MACRO,name:n};this.stack.push(o);const i=this.handleLongStmtName_("MACRO",n);o.name=i.stmtName,this.setKeyword_(t,i.isKeyword),o.hasSlashOptionDelimiter=this.syntaxDb.hasOptionDelimiter("DATA",i.stmtName)}}else qe.isComment[t.type]&&(this.isCustomBlockStart_(t)?this.startFoldingBlock_(this.SEC_TYPE.CUSTOM,t.start,t.text):this.isCustomBlockEnd_(t)&&this.searchBlockUpwardOfType_(this.currSection,this.SEC_TYPE.CUSTOM)&&this.tryEndFoldingBlock_(t.start,this.SEC_TYPE.CUSTOM,t.end));return t}}readGbl_(){let e="";const t=this.getNext_();if(t){if(qe.isWord[t.type])if(this.isLabel_())this.stack.push({parse:this.readLabel_,state:this.PARSING_STATE.IN_GBL});else if(this.isAssignment_(t)){const t=this._cleanKeyword(e);this.stack.push({parse:this.readGblStmt_,state:this.PARSING_STATE.IN_GBL,name:t})}else if(e=t.text,"PROC"===e||"PROCEDURE"===e){this.currSection?.type!==this.SEC_TYPE.CUSTOM&&this.endFoldingBlock_(this.SEC_TYPE.GBL,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.PROC,t.start,e),t.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.pop();const n=this.handleProcName_();this.stack.push({parse:this.readProc_,state:this.PARSING_STATE.IN_PROC,name:n}),this.stack.push({parse:this.readProcDef_,state:this.PARSING_STATE.IN_PROC,name:n})}else if("%MACRO"===e)this.currSection?.type!==this.SEC_TYPE.CUSTOM&&this.endFoldingBlock_(this.SEC_TYPE.GBL,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.MACRO,t.start,e),t.type=qe.TOKEN_TYPES.MSKEYWORD,this.stack.pop(),this.stack.push({parse:this.readMacro_,state:this.PARSING_STATE.IN_MACRO}),this.stack.push({parse:this.readMacroDef_,state:this.PARSING_STATE.IN_MACRO});else if("DATA"===e)this.currSection?.type!==this.SEC_TYPE.CUSTOM&&this.endFoldingBlock_(this.SEC_TYPE.GBL,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.DATA,t.start,e),t.type=qe.TOKEN_TYPES.SKEYWORD,this.stack.pop(),this.stack.push({parse:this.readData_,state:this.PARSING_STATE.IN_DATA}),this.stack.push({parse:this.readDataDef_,state:this.PARSING_STATE.IN_DATA});else if(t.type===qe.TOKEN_TYPES.MREF)this.handleMref_(this.PARSING_STATE.IN_GBL);else{this.hasFoldingBlock_()||this.startFoldingBlock_(this.SEC_TYPE.GBL,t.start,e);const n=this._cleanKeyword(e),o={parse:this.readGblStmt_,state:this.PARSING_STATE.IN_GBL,name:n};if(this.stack.push(o),!this.tryToHandleSectionEnd_(t)){const e=this.handleLongStmtName_("",n);o.name=e.stmtName,this.setKeyword_(t,e.isKeyword),o.hasSlashOptionDelimiter=this.syntaxDb.hasOptionDelimiter("",e.stmtName)}}else qe.isComment[t.type]&&(this.isCustomBlockStart_(t)?(this.currSection?.type!==this.SEC_TYPE.CUSTOM&&this.endFoldingBlock_(this.SEC_TYPE.GBL,this.lastToken.end),this.startFoldingBlock_(this.SEC_TYPE.CUSTOM,t.start,t.text)):this.isCustomBlockEnd_(t)&&this.tryEndFoldingBlock_(t.end,this.SEC_TYPE.CUSTOM));return t}}readCards_(){let e,t,n,o="",i=null;const s=qe.isCards4[this.curr.name]||qe.isParmcards4[this.curr.name]?/^;;;;/:/;/;if(this.cardsState===this.CARDS_STATE.IN_CMD)i=this.getNext_(),i&&i.type===qe.TOKEN_TYPES.SEP&&(o=i.text,";"===o&&(this.startLineForCardsData=i.end.line+1,this.cardsState=this.CARDS_STATE.IN_DATA_WAITING));else if(this.cardsState===this.CARDS_STATE.IN_DATA_WAITING){if(i=this.getNext_(),i&&i.start.line>=this.startLineForCardsData){this.cardsState=this.CARDS_STATE.IN_DATA,this.startLineForCardsData=i.start.line,e=this.model.getLineCount(),t=i.start.line,n="";do{if(n=this.model.getLine(t),s.test(n))break;t++}while(t<e);return t--,this.lexer.start.line=this.startLineForCardsData,this.lexer.start.column=0,this.lexer.curr.line=t,this.lexer.curr.column=this.model.getLine(t).length,this._changeCardsDataToken({type:qe.TOKEN_TYPES.CARDSDATA,start:this._clonePos(this.lexer.start),end:this._clonePos(this.lexer.curr)})}}else this.cardsState===this.CARDS_STATE.IN_DATA&&(i=this.getNext_(),i&&";"===i.text&&(this.cardsState=this.CARDS_STATE.IN_NULL,this.stack.pop()));return i}readEnd_(){const e=this.getNext_();return e&&";"===e.text&&(this.curr.state!==this.PARSING_STATE.IN_PROC&&this.curr.state!==this.PARSING_STATE.IN_DATA||(this.stack.pop(),this.stack.pop(),this.endFoldingBlock_(this.curr.state===this.PARSING_STATE.IN_PROC?this.SEC_TYPE.PROC:this.SEC_TYPE.DATA,e.end,!0,this.curr.start,this.curr.name))),e}readMend_(){const e=this.getNext_();return e&&";"===e.text&&this.curr.state===this.PARSING_STATE.IN_MACRO&&(this.stack.pop(),this.stack.pop(),this.tryEndFoldingBlock_(this.curr.start.start,this.SEC_TYPE.MACRO,e.end)),e}}Je.SEC_TYPE={DATA:0,PROC:1,MACRO:2,GBL:3,CUSTOM:4},Je.stmtWithDatasetOption_=p(["DATA/SET","DATA/MERGE","DATA/MODIFY","DATA/UPDATE","DOCUMENT/IMPORT","JSON/EXPORT","SERVER/ALLOCATE SASFILE"]);class Xe{constructor(e){const t=p(["[","{","("]);function n(e,t){t.pos=e.pos}function o(e){return{pos:e.pos}}function i(t){t.pos++;let n=e.prefetch0_(t.pos);if(!n){const t=e._docEndPos();n={type:"text",text:"",start:t,end:t}}return n}function s(e){let t;do{t=i(e)}while(qe.isComment[t.type]);return t}function r(e){const t=o(e);return{token:s(t),context:t}}function a(i,l,u){let h,d;const p=o(i),m=s(p);if(!l||!l[m.text])for(t[m.text]?c(i,l):qe.isUnaryOpr[m.text]?(n(p,i),a(i,l)):(n(p,i),u&&qe.isWord[m.type]&&i.onMeetTarget(m,i.pos));;)if(d=r(i),h=d.token.text,qe.isBinaryOpr[h])n(d.context,i),qe.isWord[d.token.type]&&i.onMeetTarget(d.token,i.pos),a(i,l);else{if(!t[h])return;qe.isWord[m.type]&&"("===h&&e.syntaxDb.isSasFunction(m.text)&&e.setKeyword_(m,!0),c(i,l)}}function c(e,t){let i=s(e),r=null,c=!1;const l={"(":")","[":"]","{":"}"}[i.text];(t={";":1})[l]=1;do{switch(a(e,t,!0),r=o(e),i=s(r),i.text){case"":case";":c=!0;break;case l:n(r,e),c=!0;break;case"=":n(r,e),a(e,t);break;case",":n(r,e)}}while(!c)}this.parse=function(e,t,n){const o={pos:t,onMeetTarget:n},i={pos:0};try{void 0===e&&(e=!0),e?delete qe.isBinaryOpr["/"]:qe.isBinaryOpr["/"]=1,a(o,{";":1}),i.pos=o.pos,qe.isBinaryOpr["/"]=1}catch(e){}return i}}}const et=Je.SEC_TYPE,tt={RUN:1,QUIT:1,"%MEND":1},nt={PROC:1,DATA:1},ot={"%MACRO":1,RUN:1,QUIT:1},it={PROC:et.PROC,DATA:et.DATA,"%MACRO":et.MACRO,BEGINGRAPH:"statgraph"},st={"[":1,"{":1,"(":1},rt=p(["CHTML","CORE","CSV","CSVALL","CVSBYLINE","DEFAULT","DOCBOOK","ExcelXP","HTML4","HTMLCSS","HTMLPANEL","HTMLSCROLL","IMODE","MSOFFICE2K","MVSHTML","PHTML","PYX","RTF","SASREPORT","SQL","SUPERMAP","TABLEEDITOR","WML","WMLOLIST","XBRL","XHTML","EVENT_HTML","NAMEDHTML","SHORT_MAP","STYLE_DISPLAY","STYLE_POPUP","TEXT_MAP","TPL_STYLE_LIST","TPL_STYLE_MAP"]);class at{constructor(e,t,n){this._model=e,this._syntaxDb=t,this._syntaxProvider=n,this._procName="",this._stmtName="",this._optName="",this._subOptName="",this._embeddedCodeStarted=!1,this._topZone=0,this._sectionMode=null,this._specialStmt={STYLE:this._style,ODS:this._ods,IF:this._if,WHERE:this._where},this._stmtCache={},this._stmtWithOptionDelimiter={},this._dummyToken={line:0,col:0,type:"text",pos:-1},this._lexer=new qe(e)}_reset(){this._procName="",this._stmtName="",this._optName="",this._subOptName="",this._embeddedCodeStarted=!1}_needOptionDelimiter(){return this._stmtWithOptionDelimiter[this._procName]||(this._stmtWithOptionDelimiter[this._procName]={}),void 0===this._stmtWithOptionDelimiter[this._procName][this._stmtName]&&(this._stmtWithOptionDelimiter[this._procName][this._stmtName]=this._syntaxDb.hasOptionDelimiter(this._procName,this._stmtName)),this._stmtWithOptionDelimiter[this._procName][this._stmtName]}_isDatasetOpt(e){let t=null;return this._topZone===at.ZONE_TYPE.PROC_DEF?t=this._syntaxDb.getProcedureOptionType(this._procName,e):this._topZone===at.ZONE_TYPE.PROC_STMT&&(t=this._syntaxDb.getProcedureStatementOptionType(this._procName,this._stmtName,e)),!(!t||!this._syntaxDb.isDataSetType(t))}_getStmts(e){let t,n;return this._stmtCache[e]||(t=this._syntaxDb.getProcedureStatements(e,!1),n=t=>{t&&t.length>0&&(this._stmtCache[e]=p(t))},n(t)),this._stmtCache[e]}_getFullStmtName(e,t,n){const o=this._getStmts(t),i=this._cloneContext(e),s=this._getNextEx(i),r=this._cloneContext(i),a=this._getNextEx(r),c=this._cloneContext(r),l=this._getNextEx(c),u=n.text.toUpperCase()+" "+s.text,h=u+" "+a.text,d=h+" "+l.text;o&&(o[d]?(this._copyContext(c,e),n.text=d,n.pos=l.pos>0?1:l.pos):o[h]?(this._copyContext(r,e),n.text=h,n.pos=a.pos>0?1:a.pos):o[u]&&(this._copyContext(i,e),n.text=u,n.pos=s.pos>0?1:s.pos)),"ODS"===t&&rt[s.text.replace("TAGSETS.","")]&&(this._copyContext(i,e),n.text=u,n.pos=s.pos>0?1:s.pos)}_ended(e){let t,n,o,i=!0,s=null;return e.endLine?(n=this._model.getLine(e.line).substr(e.col,2),o=this._model.getLine(e.endLine).substring(0,e.endCol)):(n=e.text,o=e.text),t=n.substr(0,2),o.length<=2?t+=o:t+=o.substr(o.length-2,2),(qe.isComment[e.type]||qe.isLiteral[e.type])&&(s={comment:/(^\*.*;$|^\/\*.*\*\/$)/i,"macro-comment":/(^%\*.*;$)/i,string:/(^'.*'$|^".*"$)/i,date:/(^'.*'d$|^".*"d$)/i,time:/(^'.*'t$|^".*"t$)/i,dt:/(^'.*'dt$|^".*"dt$)/i,bitmask:/(^'.*'b$|^".*"b$)/i,namelit:/(^'.*'n$|^".*"n$)/i,hex:/(^'.*'x$|^".*"x$)/i}[e.type],s&&!s.test(t)&&(i=!1)),i}_token(e,t){let n=this._syntaxProvider.getSyntax(e),o=-1,i="text",s=e;for(let e=0;e<n.length;e++)if(n[e].start<=t&&(e===n.length-1||n[e+1].start>t)){o=e,i=n[e].style;break}if(qe.isComment[i]||qe.isLiteral[i])for(;s>=0;){if(n[o].state instanceof Object)return{type:i,text:"",line:s,col:n[o].start,endLine:n[o].state.line,endCol:n[o].state.col};if(1===n[o].state)break;if(o--,o<0){do{s--,n=this._syntaxProvider.getSyntax(s)}while(s>=0&&0===n.length);o=n.length-1}}if(o>=0){const t=this._model.getLine(e);let s=0,r=0;return n=this._syntaxProvider.getSyntax(e),0!==n.length&&(s=n[o+1]?n[o+1].start:t.length,r=n[o].start),{type:i,text:t.substring(r,s),line:e,col:r}}return null}_getPrev(e){let t="",n=0,o=[],i=0,s="",r=0,a="text",c=0;const l=this._model.getLineCount();e.line>=l&&(e.line=l-1,e.col=this._model.getLine(e.line).length),t=this._model.getLine(e.line),n=t.length,o=this._syntaxProvider.getSyntax(e.line),i=o.length,e.syntaxIdx<0&&(e.syntaxIdx=this._syntaxProvider.getSyntax(e.line).length-2);do{for(;e.col<0||0===o.length;){if(e.line--,e.line<0)return null;t=this._model.getLine(e.line),n=t.length,e.col=n-1,o=this._syntaxProvider.getSyntax(e.line),i=o.length,e.syntaxIdx=i-2}if(o[i-1].start<=e.col&&n>=e.col&&o[i-1].start<n)c=i-1;else for(c=e.syntaxIdx;c>=0&&!(o[c].start<=e.col&&o[c+1].start>=e.col&&o[c].start!==o[c+1].start);c--);c>=0&&(r=o[c].start,a=o[c].style,s=t.substring(r,o[c+1]?o[c+1].start:n)),c>=1?(e.col=o[c-1].start,e.syntaxIdx=c-1):(e.col=-1,e.syntaxIdx=-1)}while(/^\s*$/.test(s));if(qe.isComment[a]||qe.isLiteral[a]){const t=this._token(e.line,r);return t?(!t.endLine||t.line===e.line&&t.col===e.col||(e.col=t.col-1,e.line=t.line,e.syntaxIdx=-1),qe.isComment[a]?this._getPrev(e):t):null}return{type:a,text:s,line:e.line,col:r}}_getNext(e){let t,n,o=null;for(e.tokens?e.tokenIdx<e.tokens.length&&(o=e.tokens[e.tokenIdx],o.endLine?(e.line=o.endLine,e.col=o.endCol):(e.line=o.line,e.col=o.col+o.text.length),e.tokenIdx++):(n=this._normalize(e.line,e.col),this._lexer.startFrom(n.line,n.col),t=this._lexer.getNext(),t&&(e.line=t.end.line,e.col=t.end.column,o=this._transToken(t)));o&&qe.isComment[o.type];)o=this._getNext(e);if(o&&o.type===qe.TOKEN_TYPES.MREF){const t=o;if(o=this._getNext(e),o&&"("===o.text){for(;o&&")"!==o.text&&-1===this._pos(e.cursor,o);)o=this._getNext(e);o=-1===this._pos(e.cursor,o)?this._getNext(e):t}}return o}_getNextEx(e){let t,n,o,i=this._getNext(e);return i&&"&"===i.text&&(n=this._cloneContext(e),o=this._getNext(n),o&&""!==o.text&&qe.isWord[o.type]&&(i.text="&"+o.text,i.type="text",this._copyContext(n,e))),i||(t=this._model.getLineCount()-1,i={type:"text",text:"",line:t,col:this._model.getColumnCount(t)}),{...i,pos:this._pos(e.cursor,i),text:i.text.toUpperCase()}}_transToken(e){if(e){const t={type:e.type,line:e.start.line,col:e.start.column,text:e.text};return e.start.line!==e.end.line&&(t.endLine=e.end.line,t.endCol=e.end.column),t}return e}_tokenizeStmt(e,t){let n;const o=[];this._lexer.startFrom(e,t);do{if(n=this._lexer.getNext(),n&&(n=this._transToken(n),o.push(n),"sep"===n.type&&";"===n.text))break}while(n);return o}_emit(e,t,n){(n||!e.zone||t>e.zone)&&(e.zone=t)}_emit1(e,t,n){0===e.pos?e.zone=n:e.pos>=2&&(e.zone=t)}_blockName(e){let t=null;const n={line:e.startLine,col:e.startCol,syntaxIdx:0};return this._getNext(n),t=this._getNext(n),t?t.text.toUpperCase():""}_pos(e,t){const n=t.line,o=t.col;let i,s;return void 0===t.endLine?(i=n,s=o+t.text.length):(i=t.endLine,s=t.endCol),e.line>i?-1:e.line<n?3:i===n?e.col<o?3:e.col===o?2:e.col===s?0:e.col>s?-1:1:e.line===n?e.col<o?3:e.col===o?2:1:e.line===i?e.col>s?-1:e.col===s?0:1:1}_inBlock(e,t){if(!t.endLine||t.endLine===t.line)return t.line===e.endLine&&t.col>=e.endCol||t.line===e.startLine&&t.col+t.text.length<=e.startCol||t.line>e.endLine||t.line<e.startLine?-1:0}_isBlockStart(e,t){return e.startLine===t.line&&e.startCol===t.col}_endedReally(e){let t=null,n=null;const o={line:e.endLine,col:e.endCol,syntaxIdx:-1};do{t=this._getPrev(o)}while(t&&";"!==t.text);if(t&&(t=this._getPrev(o),t&&t.text)){if(n=t.text.toUpperCase(),t=this._getPrev(o),tt[n]&&";"===t?.text)return!0;if("CANCEL"===n&&t&&t.text&&tt[t.text.toUpperCase()])return!0;if("%MEND"===t?.text.toUpperCase())return t=this._getPrev(o),";"===t?.text}return!1}_skipToStmtStart(e,t){let n=null,o=0;const i=[];for(e.syntaxIdx=-1,e.tokens=null;n=this._getPrev(e),i.push(n),n&&";"!==n.text&&"embedded-code"!==n.type;);n?(e.line=n.line,e.col=n.col+n.text.length,e.syntaxIdx=-1,e.lastStmtEnd={line:n.line,col:n.col}):(e.line=0,e.col=0,e.syntaxIdx=-1,e.lastStmtEnd=null),o=i.length,o>3&&qe.isWord[i[o-2].type]&&":"===i[o-3].text&&(this._getNext(e),this._getNext(e)),t&&(e.tokens=this._tokenizeStmt(e.line,e.col)),e.tokenIdx=0}_isStatgraph(e,t,n){const o=this._findEmbeddedBlock(e,t,{BEGINGRAPH:1},{ENDGRAPH:1});return!(!o||"statgraph"!==o.type||"BEGINGRAPH"===n)}_embeddedBlock(e,t){return this._findEmbeddedBlock(e,t,nt,ot)}_findEmbeddedBlock(e,t,n,o){let i=null,s=null,r=0;const a={line:t.line,col:t.col,syntaxIdx:-1,cursor:t};do{if(this._skipToStmtStart(a,!1),r++,i=this._getNext(a),i){if(s=i.text.toUpperCase(),n[s])return{startLine:i.line,startCol:i.col,endLine:t.line,endCol:i.col+4>t.col&&i.line===t.line?i.col+4:t.col,type:it[s]};if(o[s]&&r>1)return null}else i={line:a.line,col:a.col};a.lastStmtEnd&&(a.col=a.lastStmtEnd.col-1,a.line=a.lastStmtEnd.line,a.lastStmtEnd=null)}while(i.line>e.startLine||i.line===e.startLine&&i.col>e.startCol);return null}_globalStmt(e){let t=null,n=null;this._skipToStmtStart(e,!0),t={line:e.line,col:e.col,cursor:e.cursor,syntaxIdx:-1};const o=this._getNextEx(e);if(o.pos>=0){if(n=this._syntaxProvider.getFoldingBlock(t.line,t.col,!1,!0,!0),n&&this._inBlock(n,o)<0&&!this._endedReally(n)){if("%MACRO"===o.text)return at.ZONE_TYPE.MACRO_STMT;switch(n.type){case et.PROC:return this._isStatgraph(n,e.cursor,o.text)?this._procName="STATGRAPH":(this._procName=this._blockName(n),this._stmtName=o.text),at.ZONE_TYPE.PROC_STMT;case et.DATA:return at.ZONE_TYPE.DATA_STEP_STMT}}return"%"===o.text[0]?at.ZONE_TYPE.MACRO_STMT:at.ZONE_TYPE.GBL_STMT}switch(o.text.toUpperCase()){case"PROC":case"PROCEDURE":return this._procDef(e);case"DATA":return this._dataDef(e,o);case"%MACRO":return this._macroDef(e)}this._stmtName=o.text.toUpperCase(),this._topZone=at.ZONE_TYPE.GBL_STMT;const i=this._stmtEx(e,o);if(this._isCall(i))return at.ZONE_TYPE.RESTRICTED;if(i.type===at.ZONE_TYPE.OPT_NAME)return at.ZONE_TYPE.GBL_STMT_OPT;if(i.type===at.ZONE_TYPE.OPT_VALUE)return at.ZONE_TYPE.GBL_STMT_OPT_VALUE;if(i.type===at.ZONE_TYPE.SUB_OPT_NAME){if(this._syntaxDb.isStatementSubOptKeyword(this._stmtName,this._optName,this._subOptName)||this._subOptName)return at.ZONE_TYPE.GBL_STMT_SUB_OPT_NAME}else if("%SYSCALL"===this._stmtName&&/^%SYSCALL\b/.test(o.text))return this._callStmt(e);return i.type}_procSec(e){let t=null,n=null,o=!1;if(this._skipToStmtStart(e,!0),t=this._getNextEx(e),!qe.isWord[t.type])return this._procName=this._blockName(e.block),this._procStmt(e,t);if(n=t.text.toUpperCase(),t.pos>=0){if(o=this._inBlock(e.block,t)>=0,o&&"PROC"!==n||!o&&!this._endedReally(e.block)){if(this._procName=this._blockName(e.block),"%"===n[0])return at.ZONE_TYPE.MACRO_STMT;{this._isStatgraph(e.block,e.cursor,n)&&(this._procName="STATGRAPH");const o=this._procStmt(e,t);return o===at.ZONE_TYPE.ODS_STMT||o===at.ZONE_TYPE.EMBEDDED_LANG?o:at.ZONE_TYPE.PROC_STMT}}return at.ZONE_TYPE.GBL_STMT}switch(n){case"PROC":case"PROCEDURE":return this._procDef(e);case"DATA":return this._dataDef(e,t);default:return this._isStatgraph(e.block,e.cursor,n)?this._procName="STATGRAPH":this._procName=this._blockName(e.block),this._procStmt(e,t)}}_procDef(e){let t=null;if(t=this._getNextEx(e),t.pos>=0&&"="!==t.text)return at.ZONE_TYPE.PROC_DEF;this._procName=t.text.toUpperCase(),this._topZone=at.ZONE_TYPE.PROC_DEF;const n=this._stmtEx(e,t);return this._isCall(n)?at.ZONE_TYPE.RESTRICTED:n.type===at.ZONE_TYPE.OPT_NAME?at.ZONE_TYPE.PROC_OPT:n.type===at.ZONE_TYPE.OPT_VALUE?at.ZONE_TYPE.PROC_OPT_VALUE:n.type===at.ZONE_TYPE.SUB_OPT_NAME&&this._syntaxDb.isProcedureSubOptKeyword(this._procName,this._optName,this._subOptName)?at.ZONE_TYPE.PROC_SUB_OPT_NAME:n.type}_context(e,t,n){let o,i,s=!1;if(n||(n={type:"root"}),n.value=e,t.push(n),e instanceof Array)for(o=0,i=e.length;o<i&&(s=this._context(e[o],t,{type:"argitem",argIndex:o}),!s);o++)t.pop();else e instanceof Object&&(void 0!==e.op2?(s=this._context(e.op1,t,{type:"lvalue"}),s||(s=this._context(e.op,t,{type:"operator"}),s||(s=this._context(e.op2,t,{type:"rvalue"}),s||(t.pop(),t.pop(),t.pop())))):void 0!==e.op1?(s=this._context(e.op,t,{type:"obj"}),s||(s=this._context(e.op1,t,{type:"arglist"}),s||(t.pop(),t.pop()))):e.pos>=0&&(s=!0));return s}_setOptName(e){void 0===e.op?this._optName=e.text:e.op&&void 0===e.op2?this._optName=e.op.text:this._setOptName(e.op1)}_zone(e,t){let n,o;const i=e[e.length-1].value;return n=i.zone,o=i.text,this._optName=i.text,this._subOptName=i.text,e.length>3&&this._setOptName(e[3].value),1!==i.pos&&(this._subOptName=void 0),n===at.ZONE_TYPE.OBJECT&&(n=at.ZONE_TYPE.OPT_NAME),n===at.ZONE_TYPE.SIMPLE_ITEM&&(n=at.ZONE_TYPE.OPT_VALUE),n||"operator"!==e[e.length-1].type||(n=at.ZONE_TYPE.SUB_OPT_NAME),(this._stmtName.match(/ODS TAGSETS.\w*/gi)||"ODS"===this._stmtName&&this._optName.match(/TAGSETS.\w*/gi))&&(o=this._model.getLine(t.cursor.line),o=o.substring(0,t.cursor.col),o.match(/TAGSETS.\w*$/gi)?n=at.ZONE_TYPE.TAGSETS_NAME:(o.match(/ods\s+\w+$/gi)||o.match(/((^\s*$)|(^\s*\w+$))/)&&n===at.ZONE_TYPE.STMT_NAME||o.match(/ods\s+$/gi))&&(n=at.ZONE_TYPE.ODS_STMT)),"%"===this._stmtName[0]&&(n!==at.ZONE_TYPE.OPT_NAME&&n!==at.ZONE_TYPE.OPT_VALUE||(n=at.ZONE_TYPE.MACRO_STMT_BODY)),{type:n}}_isCall(e){return!1}_procStmt(e,t){let n;this._topZone=at.ZONE_TYPE.PROC_STMT,this._getFullStmtName(e,this._procName,t);const o=this._stmtEx(e,t);if(n=o.type,["PYTHON","LUA"].includes(this._procName))return this._embeddedCodeStarted?["ENDSUBMIT","ENDINTERACTIVE","RUN"].includes(t.text)?(this._embeddedCodeStarted=!1,at.ZONE_TYPE.PROC_STMT):at.ZONE_TYPE.EMBEDDED_LANG:(["SUBMIT","INTERACTIVE","I"].includes(t.text)&&(this._embeddedCodeStarted=!0),at.ZONE_TYPE.PROC_STMT);if(this._isCall(o))n=at.ZONE_TYPE.RESTRICTED;else if(o.type===at.ZONE_TYPE.STMT_NAME)n=at.ZONE_TYPE.PROC_STMT;else if(o.type===at.ZONE_TYPE.OPT_NAME){if("CALL"===this._stmtName&&/^CALL\b/.test(t.text))return this._callStmt(e);n=at.ZONE_TYPE.PROC_STMT_OPT}else o.type===at.ZONE_TYPE.OPT_NAME_REQ?n=at.ZONE_TYPE.PROC_STMT_OPT_REQ:o.type===at.ZONE_TYPE.OPT_VALUE?n=at.ZONE_TYPE.PROC_STMT_OPT_VALUE:o.type===at.ZONE_TYPE.SUB_OPT_NAME?Je.stmtWithDatasetOption_[this._procName+"/"+t.text]?n=at.ZONE_TYPE.DATA_SET_OPT_NAME:this._syntaxDb.isProcedureStatementSubOptKeyword(this._procName,this._stmtName,this._optName,this._subOptName)?n=at.ZONE_TYPE.PROC_STMT_SUB_OPT:this._syntaxDb.isProcedureStatementKeyword(this._procName,this._stmtName,this._subOptName)&&(n=at.ZONE_TYPE.PROC_STMT_OPT):o.type===at.ZONE_TYPE.SUB_OPT_VALUE&&(n=at.ZONE_TYPE.PROC_STMT_SUB_OPT_VALUE);return n}_stmtEx(e,t){const n=this._stmt(e,t),o=[];return this._context(n,o),this._zone(o,e)}_emit3(e,t,n){this._traverse(t,e=>{(qe.isWord[e.type]||"text"===e.type)&&this._emit(e,n)})}_if(e,t,n){const o=[];let i,s,r=this._expr(e);return i=this._getNextEx(e),"IN"===i.text&&(r={op:i,op1:r,op2:this._expr(e)},i=this._getNextEx(e)),this._emit3(e,r,n),o.push(r),this._emit(i,n),"THEN"===i.text&&n===at.ZONE_TYPE.DATA_STEP_STMT_OPT||"%THEN"===i.text&&n===at.ZONE_TYPE.MACRO_STMT_OPT?(s=this._getNextEx(e),o.push({op:i,op1:this._stmt(e,s)}),i.pos>=0&&(this._stmtName=t.text)):o.push(i),{op:t,op1:o}}_where(e,t){return{op:t,op1:this._expr(e)}}_style(e,t){const n={op:t},o=[];let i,s,r,a=null;do{r=this._getNextEx(e),this._emit(r,at.ZONE_TYPE.STYLE_ELEMENT),o.push(r),r=this._getNextEx(e)}while(","===r.text);return"FROM"===r.text&&(a=r,i=this._getNextEx(e),r=this._getNextEx(e),'"text"'!==r.text&&"'text'"!==r.text||(r=this._getNextEx(e))),"/"===r.text?(s=a?{op:a,op1:o,op2:i}:o,this._emit1(r,at.ZONE_TYPE.RESTRICTED,at.ZONE_TYPE.STYLE_ATTR),n.op1={op:r,op1:s,op2:this._stmtOptions(e,null,at.ZONE_TYPE.STYLE_ATTR,at.ZONE_TYPE.RESTRICTED)}):n.op1=o,n}_ods(e,t){let n,o;this._getFullStmtName(e,"ODS",t),this._stmtName=t.text.toUpperCase(),this._emit(t,at.ZONE_TYPE.ODS_STMT),"ODS"===this._stmtName?(n=at.ZONE_TYPE.RESTRICTED,o=at.ZONE_TYPE.RESTRICTED):(n=at.ZONE_TYPE.ODS_STMT_OPT,o=at.ZONE_TYPE.ODS_STMT_OPT_VALUE);const i=this._stmtOptions(e,t,n,o),s=this._firstToken(i);return"ODS"===this._stmtName&&s.pos>=0&&this._emit(s,at.ZONE_TYPE.ODS_STMT),{op:t,op1:i}}_traverse(e,t){e instanceof Array?e.forEach(e=>{this._traverse(e,t)}):void 0===e.op?t(e):void 0===e.op2?(this._traverse(e.op,t),this._traverse(e.op1,t)):(this._traverse(e.op1,t),this._traverse(e.op,t),this._traverse(e.op2,t))}_firstToken(e){return e instanceof Array?this._firstToken(e[0]):void 0===e.op?e:void 0===e.op2?this._firstToken(e.op):this._firstToken(e.op1)}_isNormalStmt(e){return{SELECT:1}[e.text]}_checkFuncType(e){return"%"===e.text[0]?at.ZONE_TYPE.MACRO_FUNC:this._syntaxDb.isSasFunction(e.text)?at.ZONE_TYPE.SAS_FUNC:at.ZONE_TYPE.OBJECT}_stmt(e,t){const n=this._tryGetOpr(e);let o;if("/"===n.token.text)this._copyContext(n.context,e);else if(qe.isBinaryOpr[n.token.text]&&(this._copyContext(n.context,e),!this._isNormalStmt(t)))return this._emit(t,at.ZONE_TYPE.SIMPLE_ITEM),this._stmtName=t.text,{op:n.token,op1:t,op2:this._expr(e)};return this._emit(t,at.ZONE_TYPE.STMT_NAME),this._stmtName=t.text,this._specialStmt[this._stmtName]?this._specialStmt[this._stmtName].call(this,e,t,at.ZONE_TYPE.DATA_STEP_STMT_OPT):this._needOptionDelimiter()&&(o=n.token,"/"===o.text)?(this._emit1(o,at.ZONE_TYPE.OPT_NAME_REQ,at.ZONE_TYPE.OPT_NAME),{op:t,op1:[o].concat(this._stmtOptions(e,t,at.ZONE_TYPE.OPT_NAME))}):{op:t,op1:this._stmtOptions(e,t)}}_startScope(e,t,n){e.scopes||(e.scopes=[]),e.scopes.push({t,o:n})}_endScope(e){e.scopes.pop()}_styleOptionAllowed(){return"PRINT"===this._procName||"REPORT"===this._procName}_emitArgList(e,t,n){let o=1;const i=e.length-1;for(0===e[0].pos&&this._emit(e[0],t),e[i].pos>=2&&this._emit(e[i],t);o<i;o++)void 0===e[o].op?this._emit(e[o],t):void 0===e[o].op2?this._emit(e[o].op,t):(e[o].op1.op1 instanceof Array?this._emit(e[o].op1.op,t):this._emit(e[o].op1,t),this._emit1(e[o].op,t,n),e[o].op2.op1 instanceof Array?this._emit(e[o].op2.op,n):(e[o].op1.text&&e[o].op1.text.match(/color/gi)&&(n=at.ZONE_TYPE.COLOR),this._emit(e[o].op2,n)))}_emitTree(e,t,n){let o;if(!e.scopes||e.scopes.length<=0)return;const i=e.scopes.length,s=e.scopes[0],r=e.scopes[i-1];if(s.o&&"STYLE"===s.o.text||s.o&&s.o.op&&"STYLE"===s.o.op.text){if(!this._styleOptionAllowed())return;r.t===at.ZONE_TYPE.OPT_ITEM?t.op1?(this._emit(t.op,n),t.op1 instanceof Array&&this._emitArgList(t.op1,at.ZONE_TYPE.STYLE_LOC,at.ZONE_TYPE.RESTRICTED)):this._emit(t,n):r.t===at.ZONE_TYPE.OPT_VALUE&&(t.op1||t instanceof Array?(t.op1?(o=t.op1,this._emit(t.op,at.ZONE_TYPE.STYLE_ELEMENT)):o=t,o instanceof Array&&this._emitArgList(o,at.ZONE_TYPE.STYLE_ATTR,at.ZONE_TYPE.RESTRICTED)):this._emit(t,at.ZONE_TYPE.STYLE_ELEMENT))}else"DATA"===this._stmtName&&s.o?r.t===at.ZONE_TYPE.OPT_ITEM?void 0===t.op&&this._emit(t,at.ZONE_TYPE.DATA_STEP_OPT_NAME):r.t===at.ZONE_TYPE.OPT_VALUE&&("VIEW"===s.o.text||"PGM"===s.o.text?t.op?(this._emit(t.op,at.ZONE_TYPE.VIEW_OR_PGM_NAME),t.op1 instanceof Array&&this._emitArgList(t.op1,at.ZONE_TYPE.VIEW_OR_PGM_OPT_NAME,at.ZONE_TYPE.VIEW_OR_PGM_OPT_VALUE)):this._emit(t,at.ZONE_TYPE.VIEW_OR_PGM_NAME):void 0===t.op&&this._emit(t,at.ZONE_TYPE.DATA_STEP_OPT_VALUE)):s.o&&s.o.text&&s.o.text.match(/color/gi)?r.t===at.ZONE_TYPE.OPT_VALUE&&t instanceof Array&&this._emitArgList(t,at.ZONE_TYPE.COLOR,at.ZONE_TYPE.RESTRICTED):t.op1 instanceof Array&&this._emitArgList(t.op1,at.ZONE_TYPE.SUB_OPT_NAME,at.ZONE_TYPE.SUB_OPT_VALUE)}_stmtOptions(e,t,n,o){let i,s,r,a,c=!1;const l=[];for(n||(n=this._needOptionDelimiter()?at.ZONE_TYPE.OPT_NAME_REQ:at.ZONE_TYPE.OPT_NAME),o||(o=at.ZONE_TYPE.OPT_VALUE);;){if(r=this._cloneContext(e),i=this._getNextEx(r),""===i.text?(this._emit(i,n),l.push(i),c=!0):";"===i.text?(i.pos>=2&&this._emit(i,n),l.push(i),c=!0):(n===at.ZONE_TYPE.OPT_NAME_REQ&&"/"===i.text&&(n=at.ZONE_TYPE.OPT_NAME),this._emit(i,n),this._copyContext(r,e),r=this._cloneContext(e),s=this._getNextEx(r),"("===s.text&&(this._emit(i,this._checkFuncType(i)),i={op:i,op1:this._argList(e,i)},r=this._cloneContext(e),s=this._getNextEx(r))),this._startScope(e,at.ZONE_TYPE.OPT_ITEM,i),this._emitTree(e,i,n),c){this._endScope(e);break}switch(s.text){case"{":break;case"=":this._emit1(s,n,o),this._copyContext(r,e),this._startScope(e,at.ZONE_TYPE.OPT_VALUE),a="DATA"===i.text||this._isDatasetOpt(void 0===i.op?i.text:i.op.text)?this._dsExpr(e):this._expr(e,{},!0),a.type?this._emit(a,o):a.op&&a.op.zone===at.ZONE_TYPE.OBJECT&&(a.op.zone=o),this._emitTree(e,a),l.push({op:s,op1:i,op2:a}),this._endScope(e);break;default:l.push(i)}this._endScope(e)}return l}_dsExpr(e){const t=this._getNextEx(e),n=this._cloneContext(e);return"("===this._getNextEx(n).text?(this._emit(t,at.ZONE_TYPE.OBJECT),{op:t,op1:this._datasetOptions(e)}):(this._emit(t,at.ZONE_TYPE.OPT_VALUE),t)}_argList(e,t,n,o){let i,s,r=this._getNextEx(e),a=null,c=!1;const l=[],u={"(":")","[":"]","{":"}"}[r.text],h={};n||(n=at.ZONE_TYPE.SUB_OPT_NAME),o||(o=at.ZONE_TYPE.SUB_OPT_VALUE),h[u]=1,this._emit1(r,t?t.zone:at.ZONE_TYPE.RESTRICTED,n),this._startScope(e,at.ZONE_TYPE.ARG_LIST,t),l.push(r);do{switch(i=this._expr(e,h),void 0===i.op?this._emit(i,n):"="===i.op.text&&(void 0===i.op1.op&&this._emit(i.op1,n),this._emit1(i.op,n,o),void 0===i.op2.op&&this._emit(i.op2,o)),c=!0,i.text){case u:i.pos<2&&this._emit(i,at.ZONE_TYPE.RESTRICTED),this._copyContext(a,e);break;case";":i.pos<2&&this._emit(i,at.ZONE_TYPE.RESTRICTED);break;case"":break;default:c=!1}if(c){l.push(i);break}switch(a=this._cloneContext(e),r=this._getNextEx(a),r.text){case"":this._emit(r,n),l.push(i,r),c=!0;break;case";":r.pos>=2&&this._emit(r,n),l.push(i,r),c=!0;break;case u:this._emit1(r,n,at.ZONE_TYPE.RESTRICTED),l.push(i,r),this._copyContext(a,e),c=!0;break;case"=":this._copyContext(a,e),this._emit1(r,n,o),s=this._expr(e),void 0===s.op&&this._emit(s,o),l.push({op:r,op1:i,op2:s});break;case",":l.push(i),this._copyContext(a,e);break;default:l.push(i)}}while(!c);return this._endScope(e),l}_tryGetOpr(e){const t=this._cloneContext(e);return{token:this._getNextEx(t),context:t}}_expr(e,t,n){let o,i,s=null;const r=this._cloneContext(e),a=this._getNextEx(r);if(t&&t[a.text])return this._dummyToken;for(st[a.text]?s=this._argList(e,null):qe.isUnaryOpr[a.text]?(this._copyContext(r,e),s={op:a,op1:this._expr(e,t,!0)}):(s=a,this._emit(a,"%"===a.text[0]?at.ZONE_TYPE.MACRO_FUNC:at.ZONE_TYPE.SIMPLE_ITEM),this._copyContext(r,e));;)if(i=this._tryGetOpr(e),o=i.token.text,qe.isBinaryOpr[o]&&!n)this._copyContext(i.context,e),s={op:i.token,op1:s,op2:this._expr(e,t)};else{if(!st[o])return s;this._emit(a,this._checkFuncType(a)),s={op:a,op1:this._argList(e,a)}}}_dataSec(e){let t=null,n=null,o=!1;if(this._skipToStmtStart(e,!0),t=this._getNextEx(e),!qe.isWord[t.type])return this._dataStmt(e,t);if(n=t.text.toUpperCase(),t.pos>=0)return o=this._inBlock(e.block,t)>=0,o&&"DATA"!==n||!o&&!this._endedReally(e.block)?(this._procName=this._blockName(e.block),"%"===n[0]?at.ZONE_TYPE.MACRO_STMT:at.ZONE_TYPE.DATA_STEP_STMT):at.ZONE_TYPE.GBL_STMT;switch(this._stmtName=n,n){case"PROC":case"PROCEDURE":return this._procDef(e);case"DATA":return this._dataDef(e,t);case"SET":case"MERGE":case"MODIFY":case"UPDATE":return this._setStmt(e,t);default:return this._dataStmt(e,t)}}_dataDef(e,t){let n,o,i,s,r;const a=[],c=[];if(this._topZone=at.ZONE_TYPE.DATA_STEP_DEF,n=this._getNextEx(e),i=this._cloneContext(e),o=this._getNextEx(i),qe.isWord[n.type]||"string"===n.type)switch(o.text){case"/":this._emit(n,"_NULL_"===n.text?at.ZONE_TYPE.DATA_STEP_DEF_OPT:at.ZONE_TYPE.DATA_SET_NAME),this._emit1(o,at.ZONE_TYPE.DATA_SET_NAME,at.ZONE_TYPE.DATA_STEP_OPT_NAME),this._copyContext(i,e),a.push(n,o,this._datastepOptions(e));break;case"=":this._emit(n,at.ZONE_TYPE.DATA_STEP_DEF_OPT),this._emit1(o,at.ZONE_TYPE.DATA_STEP_DEF_OPT,at.ZONE_TYPE.VIEW_OR_PGM_NAME),r=n.text,s={op:o,op1:n},a.push(s),this._copyContext(i,e),n=this._getNextEx(e),s.op2=n,qe.isWord[n.type]&&(this._emit(n,at.ZONE_TYPE.VIEW_OR_PGM_NAME),i=this._cloneContext(e),o=this._getNextEx(i),"("===o.text&&(this._emit(n,at.ZONE_TYPE.OBJECT),s.op2={op:n,op1:this._argList(e,n,at.ZONE_TYPE.VIEW_OR_PGM_OPT_NAME,at.ZONE_TYPE.VIEW_OR_PGM_OPT_VALUE)},o=this._getNextEx(e)),";"!==o.text&&!qe.isWord[o.type]||"VIEW"!==r&&"PGM"!==r||(this._emit(o,at.ZONE_TYPE.VIEW_OR_PGM_SUB_OPT_NAME),a.push(o)));break;case"":this._emit(n,at.ZONE_TYPE.DATA_STEP_DEF_OPT),a.push(n);break;default:for(;;){if(this._emit(n,"_NULL_"===n.text?at.ZONE_TYPE.DATA_STEP_DEF_OPT:at.ZONE_TYPE.VIEW_OR_DATA_SET_NAME),"("===o.text?(this._emit(n,at.ZONE_TYPE.DATA_SET_NAME),a.push({op:n,op1:this._datasetOptions(e)})):a.push(n),n=this._getNextEx(e),i=this._cloneContext(e),o=this._getNextEx(i),""===n.text){this._emit(n,at.ZONE_TYPE.VIEW_OR_DATA_SET_NAME),a.push(n);break}if("/"===n.text){this._emit1(n,at.ZONE_TYPE.VIEW_OR_DATA_SET_NAME,at.ZONE_TYPE.DATA_STEP_OPT_NAME),a.push(n,this._datastepOptions(e));break}if(";"===n.text)break}}else"/"===n.text&&(this._emit1(n,at.ZONE_TYPE.STMT_NAME,at.ZONE_TYPE.DATA_STEP_OPT_NAME),a.push(n,this._datastepOptions(e)));return this._context({op:"DATA",op1:a},c),this._zone(c,e).type}_datasetOptions(e){let t,n,o,i,s=this._getNextEx(e),r=[];const a=[];for(this._emit1(s,at.ZONE_TYPE.VIEW_OR_DATA_SET_NAME,at.ZONE_TYPE.DATA_SET_OPT_NAME),a.push(s);;){switch(n=this._cloneContext(e),s=this._getNextEx(n),this._emit(s,at.ZONE_TYPE.DATA_SET_OPT_NAME),s.text){case"":case";":return a.push(s),a;case")":return this._emit1(s,at.ZONE_TYPE.DATA_SET_OPT_NAME,at.ZONE_TYPE.RESTRICTED),a.push(s),this._copyContext(n,e),a;default:if(void 0===qe.isWord[s.type])return a}if(this._copyContext(n,e),t=this._getNextEx(n),"="===t.text){switch(this._copyContext(n,e),this._emit1(t,at.ZONE_TYPE.DATA_SET_OPT_NAME,at.ZONE_TYPE.DATA_SET_OPT_VALUE),s.text){case"INDEX":case"RENAME":case"WHERE":o=this._expr(e);break;case"SORTEDBY":o=this._expr(e),void 0===o.op&&this._emit(o,at.ZONE_TYPE.DATA_SET_OPT_VALUE);break;default:o=this._expr(e),i=this._firstToken(o),i.pos>=0&&this._emit(i,at.ZONE_TYPE.DATA_SET_OPT_VALUE),"DROP"!==s.text&&"KEEP"!==s.text||(r=this._tryGetMoreVals(e,at.ZONE_TYPE.DATA_SET_OPT_VALUE),r.length&&(o=[o].concat(r)))}if(a.push({op:t,op1:s,op2:o}),")"===o.text)break}else a.push(s)}return a}_tryGetMoreVals(e,t){let n,o,i;const s=this._cloneContext(e),r=[],a=/[/);]/;for(;;){if(n=this._getNextEx(s),o=this._cloneContext(s),i=this._getNextEx(o),"="===i.text||a.test(n.text)||""===n.text)return r;this._emit(n,t),r.push(n),this._copyContext(s,e)}}_datastepOptions(e){return this._stmtOptions(e,null,at.ZONE_TYPE.DATA_STEP_OPT_NAME,at.ZONE_TYPE.DATA_STEP_OPT_VALUE)}_dataStmt(e,t){let n=null,o=null;const i={block:e.block,line:e.cursor.line,col:e.cursor.col,syntaxIdx:-1,cursor:e.cursor};if(this._topZone=at.ZONE_TYPE.DATA_STEP_STMT,this._stmtName=t.text.toUpperCase(),n=this._getPrev(i),o=n.text.toUpperCase(),"IF"===this._stmtName||"CALL"===this._stmtName){const e=this._getPrev(i),t=e?.text.toUpperCase();if(/^CALL\b/.test(o)||/^\w+$/.test(o)&&t&&/^CALL$/.test(t))return this._callStmt(i)}const s=this._stmtEx(e,t);return this._isCall(s)?at.ZONE_TYPE.RESTRICTED:s.type===at.ZONE_TYPE.STMT_NAME?at.ZONE_TYPE.DATA_STEP_STMT:s.type===at.ZONE_TYPE.OPT_NAME?at.ZONE_TYPE.DATA_STEP_STMT_OPT:s.type===at.ZONE_TYPE.OPT_VALUE?at.ZONE_TYPE.DATA_STEP_STMT_OPT_VALUE:s.type}_callStmt(e){return at.ZONE_TYPE.CALL_ROUTINE}_setStmt(e,t){let n,o,i,s=!1,r=!1;const a=[],c=[];this._stmtName=t.text;do{n=this._getNextEx(e),""===n.text?(this._emit(n,at.ZONE_TYPE.DATA_STEP_STMT_OPT),r=!0):";"===n.text?(n.pos>=2&&s&&this._emit(n,at.ZONE_TYPE.DATA_STEP_STMT_OPT),r=!0):qe.isWord[n.type]&&(i=this._cloneContext(e),o=this._getNextEx(i),"("===o.text?n={op:n,op1:this._datasetOptions(e)}:"="===o.text?(this._emit(n,at.ZONE_TYPE.DATA_STEP_STMT_OPT),this._emit1(o,at.ZONE_TYPE.DATA_STEP_STMT_OPT,at.ZONE_TYPE.DATA_STEP_STMT_OPT_VALUE),this._copyContext(i,e),n={op:o,op1:n,op2:this._expr(e)}):this._emit(n,at.ZONE_TYPE.DATA_STEP_STMT_OPT),s=!0),a.push(n)}while(!r);this._context({op:t,op1:a},c);const l=this._zone(c,e);return l.type===at.ZONE_TYPE.OPT_VALUE?l.type=at.ZONE_TYPE.DATA_STEP_STMT_OPT_VALUE:void 0===l.type&&(l.type=at.ZONE_TYPE.DATA_STEP_STMT_OPT),l.type}_macroSec(e){let t=null,n=null,o=null;if(this._skipToStmtStart(e,!0),t=this._getNextEx(e),this._stmtName=t.text,!qe.isWord[t.type])return this._macroStmt(e,t);if(n=t.text,t.pos>=0){const i=this._inBlock(e.block,t)>=0;return(i&&"%MACRO"!==n||!i&&!this._endedReally(e.block))&&(o=this._embeddedBlock(e.block,{line:t.line,col:t.col-1}),o)?(e.block=o,e.line=e.cursor.line,e.col=e.cursor.col-1,o.type===et.PROC?this._procSec(e):this._dataSec(e)):"%"===n[0]?at.ZONE_TYPE.MACRO_STMT:at.ZONE_TYPE.GBL_STMT}switch(n){case"%MACRO":return this._macroDef(e);case"PROC":return this._procDef(e);case"DATA":return this._dataDef(e,t);default:return o=this._embeddedBlock(e.block,{line:t.line,col:t.col-1}),o?(e.block=o,e.line=e.cursor.line,e.col=e.cursor.col-1,o.type===et.PROC?this._procSec(e):this._dataSec(e)):this._macroStmt(e,t)}}_macroDef(e){let t;const n=this._getNextEx(e),o=[],i=[];this._emit(n,at.ZONE_TYPE.RESTRICTED);const s=this._cloneContext(e);return t=this._getNextEx(s),"("===t.text?(o.push({op:n,op1:this._argList(e)}),t=this._getNextEx(e)):(this._copyContext(s,e),o.push(n)),"/"===t.text&&(this._emit1(t,at.ZONE_TYPE.RESTRICTED,at.ZONE_TYPE.MACRO_DEF_OPT),o.push(t,this._stmtOptions(e,null,at.ZONE_TYPE.MACRO_DEF_OPT,at.ZONE_TYPE.RESTRICTED))),this._context({op:"%MACRO",op1:o},i),this._zone(i,e).type}_macroStmt(e,t){let n,o,i;const s=[];if(this._embeddedBlock(e.block,e.cursor))return this._isStatgraph(e.block,e.cursor,t.text)?this._procName="STATGRAPH":this._procName=this._blockName(e.block),this._procStmt(e,t);if("%"===t.text[0]){if(i=t.text.substring(1),this._specialStmt[i])n=this._specialStmt[i].call(this,e,t,at.ZONE_TYPE.MACRO_STMT_OPT);else{if("%SYSCALL"===this._stmtName&&/^%SYSCALL\b/.test(t.text))return this._callStmt(e);{const o=this._cloneContext(e),i=this._getNextEx(o);"%WHILE"===i.text||"%UNTIL"===i.text?(this._stmtName=i.text,this._copyContext(o,e),n={op:i,op1:this._expr(e)},this._emit(i,at.ZONE_TYPE.MACRO_STMT)):n={op:t,op1:this._stmtOptions(e,null,at.ZONE_TYPE.MACRO_STMT_OPT,at.ZONE_TYPE.MACRO_STMT_OPT_VALUE)}}}return this._context(n,s),o=this._zone(s,e),o.type===at.ZONE_TYPE.STMT_NAME?"%"===this._stmtName[0]?at.ZONE_TYPE.MACRO_STMT:at.ZONE_TYPE.GBL_STMT:o.type}return this._globalStmt(e)}_normalize(e,t){return t<0&&(e<1?(e=0,t=0):(e--,t=this._model.getLine(e).length)),{line:e,col:t}}_cloneContext(e){return Object.assign({},e)}_copyContext(e,t){for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}_currentZone(e,t){const n=this._token(e,t),o=n.type;if("embedded-code"===o)return at.ZONE_TYPE.EMBEDDED_LANG;let i=null,s=this._normalize(e,t-1);const r=s.line,a=s.col;let c=this._token(r,a);const l=this._syntaxProvider.getFoldingBlock(r,a,!0,!0,!0);s=this._pos({line:e,col:t},c);const u=this._pos({line:e,col:t},n);if(1===s||1===u||!this._ended(c)){if(qe.isComment[o])return at.ZONE_TYPE.COMMENT;if("string"===o)return at.ZONE_TYPE.QUOTED_STR;if("cards-data"===o)return at.ZONE_TYPE.DATALINES;if(qe.isLiteral[o])return at.ZONE_TYPE.LITERAL}return i={block:l,line:e,col:t-1,syntaxIdx:-1,cursor:{line:e,col:t}},this._reset(),this._sectionMode&&this._sectionMode.secType===et.PROC?(this._skipToStmtStart(i,!0),c=this._getNextEx(i),this._procName=this._sectionMode.procName.toUpperCase(),this._procStmt(i,c)):!l||this._isBlockStart(l,c)?this._globalStmt(i):l.type===et.PROC?this._procSec(i):l.type===et.DATA?this._dataSec(i):l.type===et.MACRO?this._macroSec(i):at.ZONE_TYPE.RESTRICTED}getProcName(){return this._procName}getStmtName(){return this._stmtName}getOptionName(){return this._optName}getSubOptionName(){return this._subOptName}getCurrentZone(e,t){try{return this._currentZone(e,t)}catch(e){return at.ZONE_TYPE.RESTRICTED}}setSectionMode(e,t){this._sectionMode={secType:e,procName:t}}}at.ZONE_TYPE={RESTRICTED:10,SIMPLE_ITEM:11,STMT_NAME:12,OPT_ITEM:13,OPT_NAME:14,OPT_NAME_REQ:114,OPT_VALUE:15,CALL_OR_CONFIG:16,OBJECT:17,SUB_OPT_NAME:18,SUB_OPT_VALUE:19,GBL_STMT:500,GBL_STMT_OPT:501,GBL_STMT_OPT_VALUE:502,GBL_STMT_SUB_OPT_NAME:503,PROC_DEF:510,PROC_OPT:511,PROC_OPT_VALUE:512,PROC_SUB_OPT_NAME:509,PROC_STMT:515,PROC_STMT_OPT:516,PROC_STMT_OPT_REQ:514,PROC_STMT_OPT_VALUE:517,PROC_STMT_SUB_OPT:518,PROC_STMT_SUB_OPT_VALUE:519,DATA_STEP_DEF:520,DATA_STEP_DEF_OPT:521,DATA_STEP_OPT_NAME:522,DATA_STEP_OPT_VALUE:523,DATA_SET_NAME:524,VIEW_OR_DATA_SET_NAME:525,DATA_SET_OPT_NAME:526,DATA_SET_OPT_VALUE:530,VIEW_OR_PGM_NAME:531,VIEW_OR_PGM_OPT_NAME:532,VIEW_OR_PGM_OPT_VALUE:533,VIEW_OR_PGM_SUB_OPT_NAME:534,DATA_STEP_STMT:540,DATA_STEP_STMT_OPT:541,DATA_STEP_STMT_OPT_VALUE:542,MACRO_DEF:545,MACRO_DEF_OPT:546,MACRO_STMT:547,MACRO_STMT_OPT:548,MACRO_STMT_OPT_VALUE:549,MACRO_STMT_BODY:550,STYLE_LOC:555,STYLE_ELEMENT:556,STYLE_ATTR:557,QUOTED_STR:600,COMMENT:601,LITERAL:602,COLOR:605,FORMAT:606,INFORMAT:607,MACRO_FUNC:608,SAS_FUNC:609,STAT_KW:610,AUTO_MACRO_VAR:611,MACRO_VAR:612,DATALINES:613,LIB:614,EMBEDDED_LANG:615,CALL_ROUTINE:700,ARG_LIST:701,ARG_LIST_START:702,ARG_LIST_END:703,TAGSETS_NAME:704,ODS_STMT:705,ODS_STMT_OPT:706,ODS_STMT_OPT_VALUE:707};const ct=at.ZONE_TYPE,lt=p(["CHTML","CORE","CSV","CSVALL","CVSBYLINE","DEFAULT","DOCBOOK","EXCELXP","HTML4","HTMLCSS","HTMLPANEL","HTMLSCROLL","IMODE","MSOFFICE2K","MVSHTML","PHTML","PYX","RTF","SASREPORT","SQL","SUPERMAP","TABLEEDITOR","WML","WMLOLIST","XBRL","XHTML","EVENT_HTML","NAMEDHTML","SHORT_MAP","STYLE_DISPLAY","STYLE_POPUP","TEXT_MAP","TPL_STYLE_LIST","TPL_STYLE_MAP"]),ut=function(){const e=[[ct.FORMAT,"formats"],[ct.INFORMAT,"informats"],[ct.MACRO_FUNC,"macro-func"],[ct.MACRO_STMT,"macro-stmt"],[ct.AUTO_MACRO_VAR,"auto-var"],[ct.MACRO_VAR,"auto-var"],[ct.CALL_ROUTINE,"call-routines"],[ct.SAS_FUNC,"func"],[ct.STAT_KW,"stat-kw"],[ct.STYLE_LOC,"style-loc"],[ct.STYLE_ELEMENT,"style-ele"],[ct.STYLE_ATTR,"style-att"],[ct.GBL_STMT,"gbl-stmt"],[ct.DATA_STEP_STMT,"ds-stmt"],[ct.DATA_SET_OPT_NAME,"ds-option"],[ct.DATA_SET_OPT_VALUE,"ds-option"],[ct.TAGSETS_NAME,"ods-tagsets"]],t={};return e.forEach(function(e){t[e[0]]=e[1]}),t}(),ht=[ct.DATA_STEP_STMT_OPT,ct.DATA_STEP_STMT_OPT_VALUE,ct.GBL_STMT_OPT,ct.GBL_STMT_OPT_VALUE,ct.GBL_STMT_SUB_OPT_NAME,ct.MACRO_STMT,ct.MACRO_STMT_OPT,ct.MACRO_STMT_OPT_VALUE,ct.MACRO_STMT_BODY,ct.ODS_STMT_OPT_VALUE,ct.PROC_STMT_OPT,ct.PROC_STMT_OPT_REQ,ct.PROC_STMT_OPT_VALUE,ct.PROC_STMT_SUB_OPT,ct.PROC_STMT_SUB_OPT_VALUE,ct.SAS_FUNC,ct.MACRO_FUNC,ct.OPT_VALUE,ct.SUB_OPT_NAME,ct.SUB_OPT_VALUE];function dt(e){const t=[],n={};for(let o=0;o<e.length;o++){const i=e[o].toUpperCase();n[i]||(t.push(e[o]),n[i]=!0)}return t}function pt(e,t){e&&setTimeout(function(){e(t)},0)}function mt(e){const t=[];return e&&e.forEach(function(e){-1!==e.indexOf("ODS ")&&t.push(e.replace("ODS ",""))}),t}function _t(e){return-1!==(e=e.replace(/(ODS\s*)/gi,"")).indexOf("TAGSETS.")&&-1===e.indexOf("TAGSETS.RTF")&&(e=e.replace("TAGSETS.",""),lt[e]&&(e="MARKUP")),""===e?"ODS":"ODS "+e}function gt(e){if(void 0===e)return e;if(e=e.replace(/(^\s+|\s+$)/g,""),/^(TITLE|FOOTNOTE|AXIS|LEGEND|PATTERN|SYMBOL)\d{0,}$/i.test(e)){const t=e.match(/^(TITLE|FOOTNOTE|AXIS|LEGEND|PATTERN|SYMBOL)|\d{0,}$/gi);let n=0,o=0;switch(n=parseInt(t[1],10),t[0].toUpperCase()){case"TITLE":case"FOOTNOTE":o=10;break;case"AXIS":case"LEGEND":o=99;break;case"PATTERN":case"SYMBOL":o=255}n>0&&n<=o&&(e=t[0])}return e.toUpperCase()}function ft(e="",t=!1){return t?e?.replace(/[-_\s]?\d$/,"").replace(/[-_]n$/,"").replace(/(?<=.)\s?n$/,"").trim():e?.replace(/\([snk\d]\)/g,"").replace(/['",<>()|.]/g,"").trim().toLowerCase()}function Tt(e,t){const n=0===t.indexOf("&")?t.substring(1):t;return 0===n.length?e.toLowerCase():0===e.indexOf(n)?e:n===n.toUpperCase()?e.toUpperCase():e.toLowerCase()}class St{constructor(e,t){this.model=e,this.syntaxProvider=t,this.popupContext={},this.loader=t.lexer.syntaxDb,this.czMgr=new at(e,this.loader,t)}getCodeZoneManager(){return this.czMgr}getHelp(e){const t=this.model.getLine(e.line),n=this.syntaxProvider.getSyntax(e.line);for(let o=0;o<n.length;o++){const i=n[o].start,s=o===n.length-1?t.length:n[o+1].start;if(s>e.character){const t=this.model.getText({start:{line:e.line,column:i},end:{line:e.line,column:s}}),n=this.czMgr.getCurrentZone(e.line,e.character);return new Promise(o=>{""!==t.trim()?this._loadHelp({keyword:t,type:"hint",zone:n,procName:this.czMgr.getProcName(),stmtName:this.czMgr.getStmtName(),optName:this.czMgr.getOptionName(),cb:t=>{t&&t.data?o({contents:{kind:h.MarkupKind.Markdown,value:this._addLinkContext(n,t)},range:{start:{line:e.line,character:i},end:{line:e.line,character:s}}}):o(void 0)}}):o(void 0)})}}}getSignatureHelp(e,t){const n=this.model.getLine(e.line),o=this.syntaxProvider.getSyntax(e.line);let i,s,r=0,a=0;for(let t=o.length-1;t>=0;t--){const c=o[t].start,l=t===o.length-1?n.length:o[t+1].start;if(l<=e.character){if("sep"!==o[t].style&&"keyword"!==o[t].style&&"macro-keyword"!==o[t].style)continue;const n=this.model.getText({start:{line:e.line,column:c},end:{line:e.line,column:l}});if(-1===a){if(")"===n){a=1,r=0;continue}if("("===n)continue;if(","===n){a=0,r=1;continue}if(s=this.czMgr.getCurrentZone(e.line,c+1),ht.includes(s)){i=n;break}}else")"===n?a++:"("===n?a--:","===n&&0===a&&r++}}return new Promise(e=>{i&&s?(s=i.startsWith("%")?ct.MACRO_FUNC:ct.SAS_FUNC,this._loadHelp({keyword:i,type:"hint",zone:s,procName:this.czMgr.getProcName(),stmtName:this.czMgr.getStmtName(),optName:this.czMgr.getOptionName(),cb:n=>{if(n&&n.key&&n.syntax&&n.data){const o=this._genKeywordLink(n,s),a=new RegExp(`.*?${n.key}.*?\\(((?!${n.key}).)*\\)`,"g"),c=(n.syntax.replace(/\s+/g," ").match(a)??[n.syntax.replace(/\s+/g," ")]).map(e=>e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/;|\*|<\/?sub>/g,"").replace(/\s*Form \d:\s*/gi,"")),l=[],u=c.map(e=>e.match(/\((.*)\)/)?.[1]?.split(",").map(e=>{let t=[ft(e)];(e.includes("|")||e.includes(">")&&e.includes("<")&&(e.indexOf(">")>0||e.indexOf("<")>0))&&(t=e.split(/[<>\\|]/g).map(e=>ft(e)).filter(e=>e)),t=[...new Set(t)];const o=n.arguments?.map(e=>ft(e.name));let i=t.map(e=>{let t=n.arguments?.find((t,n)=>{if(e===o?.[n])return l.push(t.name),!0});return t||(t=n.arguments?.find((t,n)=>{if(ft(e,!0)===ft(o?.[n],!0)||e.split(" ")?.[0]===o?.[n].split(" ")?.[0]||e.split("_")?.[0]===o?.[n].split("_")?.[0]||e.split("-")?.[0]===o?.[n].split("-")?.[0]||e.split("")?.[0]===o?.[n].split("")?.[0])return l.push(t.name),!0})),t?`**${t.name}:** ${t.description}`:""}).filter(e=>e);return i=[...new Set(i)],1===t.length?[e.match(/\(.*?\)/)?e.trim().replace(/^[<>]/g,"").replace(/[<>]$/g,"").trim():e.replace(/[<>()]/g,"").trim(),i[0],!0]:[e.trim(),i.join("\n\n"),i.length===t.length]}));if(r>0&&u.length>1){const e=u[t||0]?.length||0;r>e-1&&u.some((e,n)=>{if(e&&e.length-1>=r)return t=n,!0})}const d=[];c.forEach((e,t)=>{const s=u[t],r=e.match(new RegExp(`${i}\\s+([^(]*?)\\s+\\(`,"i"))?.[1]?.replace(/[<>]/g,"").split(",").map(e=>e.trim()),a=n.arguments?.filter(e=>r?.includes(e.name)).map(e=>`**${e.name}:** ${e.description}`).join("\n\n");let c="";if(s&&!s.every(e=>e[1]&&e[2])){const e=n.arguments?.filter(e=>![...l,...r||[]].some(t=>t===e.name||ft(t)===ft(e.name)||ft(t,!0)===ft(e.name,!0))&&e.description).map(e=>`**${e.name}:** ${e.description}`);e&&(c=[...new Set(e)].join("\n\n"))}d.push({label:e,documentation:n.data,parameters:s?.map(([e,t,n])=>{const i=(t?n?a?`${t}\n\n${a}`:t:c?a?`${t}\n\n${c}\n\n${a}`:`${t}\n\n${c}`:t:c?a?`${c}\n\n${a}`:c:a||"").replace(/<script .*?>/gi,""),s=`${m("ce_ac_sas_function_doc_txt")} ${o}`;return{label:e,documentation:{kind:h.MarkupKind.Markdown,value:["...",""].includes(e.replace(/['"<>()|]/g,""))?s:i?`${i}\n\n${s}`:s}}})})}),e({signatures:d,activeSignature:t,activeParameter:r})}else e(void 0)}})):e(void 0)})}getCompleteItems(e){return new Promise(t=>{this._getZone(e.position);const n=this.popupContext.prefix;this._loadAutoCompleteItems(this.popupContext.zone,o=>{if("."===e.context?.triggerCharacter&&o&&o[0]&&("string"==typeof o[0]||"DATA"!==o[0].type&&"VIEW"!==o[0].type))return void t(void 0);const i=o?.map(e=>{return{label:Tt("string"==typeof e?e:e.name,n),kind:(t="string"==typeof e?this.popupContext.zone:e.type,t===ct.COLOR?h.CompletionItemKind.Color:t===ct.MACRO_VAR?h.CompletionItemKind.Variable:"LIBRARY"===t?h.CompletionItemKind.Folder:t===ct.SAS_FUNC||t===ct.MACRO_FUNC?h.CompletionItemKind.Function:h.CompletionItemKind.Keyword),insertText:"string"==typeof e||!/\W/.test(e.name)||this.popupContext.datasetList&&this.popupContext.datasetList.some(t=>e.name.toLowerCase()===t.name.toLowerCase())?void 0:`'${e.name.replace(/'/g,"''")}'n`};var t});n.length>1&&(void 0===i||0===i.length||!i.find(e=>e.label.startsWith(n)))&&ht.includes(this.popupContext.zone)?(n.startsWith("%")?this.loader.getMacroFunctions:this.loader.getFunctions)(e=>{const o=e.filter(e=>e.startsWith(n.toUpperCase()));if(o.length>0){const e=o.map(e=>({label:Tt(e,n),kind:h.CompletionItemKind.Function}));return this.popupContext.zone=n.startsWith("%")?ct.MACRO_FUNC:ct.SAS_FUNC,void t({isIncomplete:!0,items:e})}t(void 0)}):t(void 0===i?void 0:{isIncomplete:!0,items:i})})})}getCompleteItemHelp(e){return new Promise(t=>{["endsubmit","endinteractive"].includes(e.label?.toLowerCase())?this.loader.getProcedureStatementHelp("PYTHON",e.label.toUpperCase(),n=>{n&&n.data&&(e.documentation={kind:h.MarkupKind.Markdown,value:this._addLinkContext(515,n)}),t(e)}):this._loadHelp({keyword:e.label,type:"tooltip",...this.popupContext,cb:n=>{n&&n.data&&(e.documentation={kind:h.MarkupKind.Markdown,value:this._addLinkContext(this.popupContext.zone,n)}),t(e)}})})}_loadAutoCompleteItems(e,t){let n=gt(this.czMgr.getStmtName());const o=gt(this.czMgr.getOptionName()),i=gt(this.czMgr.getProcName());switch(this.popupContext.procName=i,this.popupContext.stmtName=n,this.popupContext.optName=o,this.popupContext.zone=e,e){case ct.PROC_DEF:this.loader.getProcedures(t);break;case ct.PROC_OPT:this.loader.getProcedureOptions(i,t);break;case ct.PROC_OPT_VALUE:this.loader.getProcedureOptionValues(i,o+"=",e=>{this._notifyOptValue(t,e,o)});break;case ct.PROC_SUB_OPT_NAME:this.loader.getProcedureSubOptions(i,o,t);break;case ct.PROC_STMT:this.loader.getProcedureStatements(i,!1,e=>{t("ODS"===i?mt(e):e)});break;case ct.EMBEDDED_LANG:this.loader.getProcedureStatements(i,!0,t);break;case ct.PROC_STMT_OPT:case ct.PROC_STMT_OPT_REQ:"ODS"===i&&(n="ODS "+n),this.loader.getProcedureStatementOptions(i,n,t,e===ct.PROC_STMT_OPT_REQ);break;case ct.PROC_STMT_OPT_VALUE:"ODS"===i&&(n="ODS "+n),this.loader.getProcedureStatementOptionValues(i,n,o,e=>{this._notifyOptValue(t,e,o)});break;case ct.PROC_STMT_SUB_OPT:"ODS"===i&&(n="ODS "+n),this.loader.getProcedureStatementSubOptions(i,n,o,function(e){t(dt(e))});break;case ct.STYLE_ELEMENT:this.loader.getStyleElements(t);break;case ct.STYLE_ATTR:this.loader.getStyleAttributes(t);break;case ct.STYLE_LOC:this.loader.getStyleLocations(t);break;case ct.DATA_STEP_STMT:this.loader.getDSStatements(t);break;case ct.DATA_STEP_DEF_OPT:pt(t,["_NULL_","VIEW=","PGM="]);break;case ct.DATA_SET_OPT_NAME:this.loader.getDSOptions(t);break;case ct.DATA_SET_OPT_VALUE:this.loader.getDataSetOptionValues(o,function(e){t(e?e.values:void 0)});break;case ct.DATA_STEP_OPT_NAME:pt(t,["DEBUG","NESTING","STACK=","VIEW=","SOURCE=","NOLIST","PGM="]);break;case ct.VIEW_OR_PGM_OPT_NAME:pt(t,["ALTER=","READ=","PW=","SOURCE="]);break;case ct.VIEW_OR_PGM_OPT_VALUE:case ct.DATA_STEP_OPT_VALUE:"SOURCE"===o&&pt(t,["SAVE","ENCRYPT","NOSAVE"]);break;case ct.VIEW_OR_PGM_SUB_OPT_NAME:pt(t,["NOLIST"]);break;case ct.OPT_NAME:case ct.OPT_VALUE:break;case ct.DATA_STEP_STMT_OPT:if("SET"===n){const e=this.popupContext.position,n=this.model.getLine(e.line),i=/^\s+\S*$/.test(n.slice(n.toUpperCase().indexOf("SET")+3,e.character)),s=this._findLibRef();if(i||s){this.loader.getLibraryList(e=>{this._notifyOptValue(t,e,o)},"DV");break}}this.loader.getStatementOptions("datastep",n,e=>{e?t(e):this.loader.getProcedureStatementOptions("DATA",n,t)});break;case ct.DATA_STEP_STMT_OPT_VALUE:this.loader.getStatementOptionValues("datastep",n,o,e=>{e?this._notifyOptValue(t,e,o):this.loader.getProcedureStatementOptionValues("DATA",n,o,e=>{this._notifyOptValue(t,e,o)})});break;case ct.MACRO_STMT:this.loader.getMacroStatements(e=>{this.loader.getARMMacros(function(n){t(dt(n.concat(e)))})});break;case ct.MACRO_DEF:this.loader.getMacroDefinitions();break;case ct.MACRO_DEF_OPT:this.loader.getProcedureOptions("MACRO",t);break;case ct.MACRO_STMT_OPT:this.loader.getStatementOptions("macro",n,t);break;case ct.MACRO_STMT_OPT_VALUE:this.loader.getStatementOptionValues("macro",n,o,e=>{this._notifyOptValue(t,e,o)});break;case ct.CALL_ROUTINE:this.loader.getCallRoutines(t);break;case ct.GBL_STMT:this.loader.getGlobalStatements(e=>{this.popupContext.prefix.startsWith("%")?(this.popupContext.zone=ct.MACRO_STMT,this.loader.getMacroStatements(n=>{t(dt(n.concat(e)))})):t(e)});break;case ct.GBL_STMT_OPT:this.loader.getStatementOptions("global",n,e=>{e?t(e):this.loader.getStatementOptions("standalone",n,t)});break;case ct.GBL_STMT_OPT_VALUE:this.loader.getStatementOptionValues("global",n,o,e=>{e?this._notifyOptValue(t,e,o):this.loader.getStatementOptionValues("standalone",n,o,e=>{this._notifyOptValue(t,e,o)})});break;case ct.GBL_STMT_SUB_OPT_NAME:this.loader.getStatementSubOptions("global",n,o,e=>{e?t(e):this.loader.getStatementSubOptions("standalone",n,o,t)});break;case ct.COLOR:this.loader.getSasColors(t);break;case ct.DATA_SET_NAME:break;case ct.FORMAT:this.loader.getFormats(t);break;case ct.INFORMAT:this.loader.getInformats(t);break;case ct.TAGSETS_NAME:this.loader.getODSTagsets(t);break;case ct.ODS_STMT:this.loader.getGlobalStatements(function(e){t(mt(e))});break;case ct.ODS_STMT_OPT:this.loader.getStatementOptions("global",_t(n),t);break;case ct.ODS_STMT_OPT_VALUE:this.loader.getStatementOptionValues("global",_t(n),o,e=>{this._notifyOptValue(t,e,o)});break;case ct.LIB:break;case ct.MACRO_FUNC:this.loader.getMacroFunctions(t);break;case ct.SAS_FUNC:this.loader.getFunctions(t);break;case ct.STAT_KW:this.loader.getStatisticsKeywords(t);break;case ct.AUTO_MACRO_VAR:this.loader.getAutoVariables(t);break;case ct.MACRO_VAR:this.loader.getAutoVariables(e=>{const n=this._getMacroVar();n.length&&(e=dt(e.concat(n))),t(e)});break;default:return t(),!1}return!0}_loadHelp(e){let t=gt(e.keyword),n=null;const o=e.zone,i=e.cb,s=e.type;switch(o){case ct.PROC_DEF:n=this.loader.getProcedureHelp(t,i);break;case ct.PROC_OPT:n=this.loader.getProcedureOptionHelp(e.procName,t,i);break;case ct.PROC_SUB_OPT_NAME:n=this.loader.getProcedureSubOptionHelp(e.procName,e.optName,t,i);break;case ct.PROC_OPT_VALUE:n=this.loader.getProcedureOptionValueHelp(e.procName,e.optName,t,i);break;case ct.PROC_STMT:"hint"===s&&(t=gt(e.stmtName)),"ODS"===e.procName&&(t="ODS "+t),n=this.loader.getProcedureStatementHelp(e.procName,t,i);break;case ct.PROC_STMT_OPT:case ct.PROC_STMT_OPT_REQ:e.stmtName=gt(e.stmtName),"ODS"===e.procName&&(e.stmtName="ODS "+e.stmtName),n=this.loader.getProcedureStatementOptionHelp(e.procName,e.stmtName,t,i);break;case ct.PROC_STMT_SUB_OPT:n=this.loader.getProcedureStatementSubOptionHelp(e.procName,e.stmtName,e.optName,t,i);break;case ct.PROC_STMT_OPT_VALUE:"ODS"===e.procName&&(e.stmtName="ODS "+e.stmtName),n=this.loader.getProcedureStatementOptionValueHelp(e.procName,e.stmtName,e.optName,t,i);break;case ct.EMBEDDED_LANG:i&&pt(i,void 0);break;case ct.GBL_STMT_SUB_OPT_NAME:n=this.loader.getStatementSubOptionHelp("global",gt(e.stmtName),e.optName,t),n?pt(i,n):n=this.loader.getStatementSubOptionHelp("standalone",gt(e.stmtName),e.optName,t,i);break;case ct.GBL_STMT_OPT:n=this.loader.getStatementOptionHelp("global",gt(e.stmtName),t),n?pt(i,n):n=this.loader.getStatementOptionHelp("standalone",gt(e.stmtName),t,i);break;case ct.GBL_STMT_OPT_VALUE:n=this.loader.getStatementOptionValueHelp("global",e.stmtName,e.optName,t),n?pt(i,n):n=this.loader.getStatementOptionValueHelp("standalone",e.stmtName,e.optName,t,i);break;case ct.DATA_STEP_STMT:n=this.loader.getKeywordHelp(t,void 0,ut[o]),n?pt(i,n):n=this.loader.getProcedureStatementHelp("DATA",t,i);break;case ct.DATA_STEP_STMT_OPT:n=this.loader.getStatementOptionHelp("datastep",e.stmtName,t),n?pt(i,n):n="SET"===e.stmtName?this.loader.getDataStepOptionHelp(t,i,"datastep-option"):this.loader.getProcedureStatementOptionHelp("DATA",e.stmtName,t,i);break;case ct.DATA_STEP_STMT_OPT_VALUE:n=this.loader.getStatementOptionValueHelp("datastep",e.stmtName,e.optName,t,i),n?pt(i,n):"SET"===e.stmtName?n=this.loader.getDataStepOptionValueHelp(e.optName,t,i):(n=this.loader.getProcedureStatementOptionValueHelp("DATA",e.stmtName,e.optName,t),n?pt(i,n):n=this.loader.getStatementOptionValueHelp("global",e.stmtName,e.optName,t,i));break;case ct.DATA_SET_OPT_VALUE:n=this.loader.getDataSetOptionValueHelp(e.optName,t,i);break;case ct.DATA_STEP_DEF_OPT:case ct.VIEW_OR_PGM_OPT_NAME:n=this.loader.getDataStepOptionHelp(t,i,"datastep-option2");break;case ct.DATA_SET_OPT_NAME:n=this.loader.getDSOptionHelp(t,i);break;case ct.DATA_STEP_OPT_NAME:n=this.loader.getDataStepOptionHelp(t,i,"datastep-option");break;case ct.DATA_STEP_OPT_VALUE:case ct.VIEW_OR_PGM_OPT_VALUE:n=this.loader.getDataStepOptionValueHelp(e.optName,t,i);break;case ct.MACRO_DEF_OPT:n=this.loader.getProcedureOptionHelp("MACRO",t,i);break;case ct.MACRO_STMT_OPT:n=this.loader.getStatementOptionHelp("macro",e.stmtName,t,i);break;case ct.MACRO_STMT_OPT_VALUE:n=this.loader.getStatementOptionValueHelp("macro",e.stmtName,e.optName,t,i);break;case ct.ODS_STMT:t=_t(t),n=this.loader.getKeywordHelp(t,i,"gbl-proc-stmt");break;case ct.ODS_STMT_OPT:n=this.loader.getStatementOptionHelp("global",_t(e.stmtName),t,i);break;case ct.ODS_STMT_OPT_VALUE:n=this.loader.getStatementOptionValueHelp("global",_t(e.stmtName),e.optName,t,i);break;default:void 0===ut[o]?i&&pt(i,void 0):n=this.loader.getKeywordHelp(t,i,ut[o])}return n}_addLinkContext(e,t){const n={};let o,i,s,r,a="";switch(s=gt(t.key),n.procName=this.czMgr.getProcName(),n.stmtName=this.czMgr.getStmtName(),n.optName=this.czMgr.getOptionName(),"STATGRAPH"===n.procName&&(n.procName="TEMPLATE"),e){case ct.GBL_STMT:o=m("ce_ac_global_statement_txt"),i="%22"+s+"+STATEMENT%22";break;case ct.GBL_STMT_OPT:case ct.GBL_STMT_SUB_OPT_NAME:e===ct.GBL_STMT_SUB_OPT_NAME&&(s=n.optName),o=m("ce_ac_statement.fmt",n.stmtName),i="%22SYSTEM+"+n.stmtName.toUpperCase()+"%22+"+s;break;case ct.GBL_STMT_OPT_VALUE:o=m("ce_ac_option.fmt",n.optName+"="),i="%22SYSTEM+"+n.stmtName+"%22+"+n.optName+"= "+s;break;case ct.PROC_DEF:o=m("ce_ac_procedure_definition_txt"),i="%22PROC "+s+"%22";break;case ct.PROC_OPT:case ct.PROC_STMT:t.isGlobal?(o=m("ce_ac_global_statement_txt"),i="%22"+s+"+STATEMENT%22"):(o=m("ce_ac_proc.fmt",n.procName),i="PROC+"+n.procName+"+"+s);break;case ct.PROC_SUB_OPT_NAME:o=m("ce_ac_proc.fmt",n.procName)+", "+m("ce_ac_option.fmt",n.optName+"="),i="%22PROC+"+n.procName+"%22+"+n.optName;break;case ct.PROC_OPT_VALUE:o=m("ce_ac_proc.fmt",n.procName)+", "+m("ce_ac_option.fmt",n.optName+"="),i="%22PROC+"+n.procName+"%22+%22"+n.optName+"= "+s+"%22";break;case ct.PROC_STMT_OPT:case ct.PROC_STMT_SUB_OPT:e===ct.PROC_STMT_SUB_OPT&&(s=n.optName),t.isGlobal?(o=m("ce_ac_statement.fmt",n.stmtName),i="%22"+n.stmtName+"+STATEMENT%22"):(o=m("ce_ac_proc.fmt",n.procName)+", "+m("ce_ac_statement.fmt",n.stmtName),i="%22PROC+"+n.procName+"%22+%22"+n.stmtName+"+STATEMENT%22+"+s);break;case ct.PROC_STMT_OPT_VALUE:t.isGlobal?(o=m("ce_ac_global_statement_txt")+", "+m("ce_ac_option.fmt",n.optName+"="),i="%22SYSTEM+"+n.stmtName+"%22+"+n.optName+"= "+s):(o=m("ce_ac_proc.fmt",n.procName)+", "+m("ce_ac_statement.fmt",n.stmtName)+", "+m("ce_ac_option.fmt",n.optName+"="),i="PROC+"+n.procName+"+"+n.stmtName+"+STATEMENT+"+n.optName+"= "+s);break;case ct.DATA_STEP_STMT:o=m("ce_ac_data_step_txt"),i="%22DATA+STEP%22+%22"+s+"+STATEMENT%22";break;case ct.DATA_STEP_STMT_OPT:o=m("ce_ac_statement.fmt",n.stmtName),i="%22"+n.stmtName+"+STATEMENT%22+"+s;break;case ct.DATA_STEP_OPT_NAME:case ct.DATA_STEP_DEF_OPT:o=m("ce_ac_data_step_txt"),i="%22DATA STATEMENT%22 ";break;case ct.DATA_STEP_OPT_VALUE:o=m("ce_ac_data_step_option_value_txt"),i="%22DATA STATEMENT%22 "+n.optName+"= "+s;break;case ct.VIEW_OR_PGM_OPT_NAME:o=m("ce_ac_data_step_txt"),i="%22DATA STEP PASSWORD= OPTION%22 ";break;case ct.VIEW_OR_PGM_OPT_VALUE:o=m("ce_ac_data_step_txt"),i="%22DATA STEP PASSWORD= OPTION%22 "+n.optName+"= "+s;break;case ct.DATA_SET_OPT_NAME:o=m("ce_ac_data_set_option_txt"),i="%22DATA SET OPTIONS%22 ";break;case ct.DATA_SET_OPT_VALUE:o=m("ce_ac_data_set_option_value_txt"),i="%22DATA SET OPTIONS%22 "+n.optName+"= "+s;break;case ct.MACRO_DEF:o=m("ce_ac_macro_definition_txt");break;case ct.MACRO_STMT:o=m("ce_ac_macro_statement_txt"),i="%22"+s.replace("%","")+"+STATEMENT%22";break;case ct.MACRO_DEF_OPT:o=m("ce_ac_macro_definition_option_txt"),i="%22"+n.stmtName.toUpperCase().replace("%","")+" "+s.replace("%","")+"%22";break;case ct.MACRO_STMT_OPT:o=m("ce_ac_macro_statement_option_txt"),i="%22"+n.stmtName.toUpperCase().replace("%","")+" "+s.replace("%","")+"%22";break;case ct.ODS_STMT:o=m("ce_ac_ods_txt"),i=s;break;case ct.ODS_STMT_OPT:o=_t(n.stmtName),i=o+"+"+s,o=m("ce_ac_statement.fmt",o);break;case ct.ODS_STMT_OPT_VALUE:o=_t(n.stmtName),i=o+"+"+n.optName+"= "+s,o=m("ce_ac_statement.fmt",o)+", "+m("ce_ac_option.fmt",n.optName+"=");break;case ct.TAGSETS_NAME:o=m("ce_ac_ods_markup_txt"),i="ODS "+s;break;case ct.CALL_ROUTINE:o=m("ce_ac_call_routine_txt"),i="CALL "+s;break;case ct.STYLE_LOC:o=m("ce_ac_style_option_txt"),i="STYLE%28"+s+"%29%22";break;case ct.STYLE_ELEMENT:case ct.STYLE_ATTR:o=m("ce_ac_style_option_txt"),i="STYLE "+s;break;default:o="",i=s.replace("%","")}return s=this._genKeywordLink(t,e,i),o=o.toUpperCase(),o=""===o?"\n\n":"\\\n**"+m("ce_ac_context_txt")+" ["+o+"] "+function(e,t){let n;const o=t.toUpperCase();switch(e){case ct.GBL_STMT:case ct.DATA_STEP_STMT:case ct.PROC_STMT:case ct.MACRO_STMT:case ct.ODS_STMT:n=m("ce_ac_statement.fmt",o);break;case ct.PROC_DEF:n=m("ce_ac_proc.fmt",o);break;case ct.GBL_STMT_OPT_VALUE:case ct.PROC_OPT_VALUE:case ct.PROC_STMT_OPT_VALUE:case ct.VIEW_OR_PGM_OPT_VALUE:case ct.DATA_STEP_OPT_VALUE:case ct.DATA_STEP_STMT_OPT_VALUE:case ct.DATA_SET_OPT_VALUE:case ct.MACRO_STMT_OPT_VALUE:case ct.ODS_STMT_OPT_VALUE:case ct.OPT_VALUE:n=o;break;default:n=m("ce_ac_option.fmt",o)}return n}(e,gt(t.key.toUpperCase()))+"**\n\n",t.alias&&t.alias.length&&(a="\\\n"+m("ce_ac_alias_txt")+" "+t.alias.join(", ")),r="&lt;no help>",t.data&&(t.supportSite?(r="",t.syntax&&(r=-1!==t.syntax.indexOf("\n")?"```\n"+m("ce_ac_syntax_txt")+" "+t.syntax+"\n```\n\n":m("ce_ac_syntax_txt")+" "+t.syntax+"\n\n"),r+='<span style="white-space:pre-wrap;">'+t.data+"</span>"):r=t.data.replace(/</g,"&lt;")),m("ce_ac_keyword_txt")+"  "+s+a+o+r}_notifyOptValue(e,t,n){if(t){if(this.loader.isColorType(t.type))this.popupContext.zone=ct.COLOR,t.values=t.values.map(e=>e.slice(0,-9));else if(this.loader.isDataSetType(t.type)){if(n!==this.popupContext.optName)return void e(void 0);this.popupContext.zone=ct.LIB;let o=this._findLibRef();if(o){o=o.toUpperCase();for(let n=0;n<t.values.length;n++){const i=t.values[n];if(o===i.name.toUpperCase())return void this.loader.getDataSetNames(i.id,e)}t.values=[]}else{const e=this._getDatasetNames();this.popupContext.datasetList=e,t.values=t.values.concat(e)}}e(t.values),this.popupContext.datasetList=void 0}else e(void 0)}_getZone(e){this.popupContext.position=e,this.popupContext.prefix=this._getPrefix(e);const t=this.czMgr.getCurrentZone(e.line,e.character);this.popupContext.zone=this.popupContext.prefix.startsWith("&")&&t!==ct.COMMENT&&t!==ct.DATALINES?ct.MACRO_VAR:t}_getPrefix(e){const t=this.model.getLine(e.line).substring(0,e.character),n=t.search(/[%&](\w|[^\x00-\xff])*$|(\w|[^\x00-\xff])+$/);return-1===n?"":t.substring(n)}_findLibRef(){const e=this.popupContext.position,t=this.syntaxProvider.getSyntax(e.line);let n,o;for(let i=t.length-1;i>0;i--)if(t[i].start<e.character){const s=this.model.getLine(e.line);if(n=t[i+1]?t[i+1].start-1:s.length-1,"format"===t[i].style)o=s.slice(t[i].start,n);else{const r=s.slice(t[i].start,n).indexOf(".");r>0&&t[i].start+r<e.character&&" "!==s.slice(e.character-1,e.character)&&(o=s.slice(t[i].start,t[i].start+r))}break}return o}_getDatasetNames(){const e=[];let t=0;for(let n=0;n<this.model.getLineCount();n++){const o=this.syntaxProvider.getSyntax(n),i=this.model.getLine(n),s=o.length;for(let n=0;n<s;n++){const r=n+1<s?i.slice(o[n].start,o[n+1].start):i.slice(o[n].start);"comment"===o[n].style||"macro-comment"===o[n].style||"text"===o[n].style&&(""===r||-1!==r.search(/\s/))||(0===t&&"sec-keyword"===o[n].style&&"DATA"===r.toUpperCase()?t=1:1===t&&"text"===o[n].style&&"_NULL_"!==r.toUpperCase()?e.push({name:r,type:"DATA"}):1===t&&"sep"===o[n].style&&"("===r?t=2:2===t?"sep"===o[n].style&&")"===r&&(t=1):t=0)}}return e}_getMacroVar(){const e=[];let t=0,n="";for(let o=0;o<this.model.getLineCount();o++){const i=this.syntaxProvider.getSyntax(o),s=this.model.getLine(o),r=i.length;for(let o=0;o<r;o++){const a=o+1<r?s.slice(i[o].start,i[o+1].start):s.slice(i[o].start);"comment"===i[o].style||"macro-comment"===i[o].style||"text"===i[o].style&&(""===a||-1!==a.search(/\s/))||(0===t&&"macro-keyword"===i[o].style&&"%LET"===a.toUpperCase()?t=1:1===t&&"text"===i[o].style?(n=a,t=2):2===t&&"sep"===i[o].style&&"="===a?t=3:3===t?"sep"===i[o].style&&";"===a&&(e.push(n),t=0):0===t&&"keyword"===i[o].style&&"CALL"===a.toUpperCase()?t=4:4===t&&"text"===i[o].style&&"SYMPUT"===a.toUpperCase()?t=5:5===t&&"sep"===i[o].style&&"("===a?t=6:6===t&&"string"===i[o].style?(n=a.replace(/['"]/g,""),t=7):t=7===t&&"sep"===i[o].style&&","===a&&n?3:0)}}return e}_genKeywordLink(e,t,n=""){let o="https://support.sas.com/en/search.html?fq=releasesystem%3AViya&q="+n;return e.supportSite?(o="https://documentation.sas.com/?docsetId="+e.supportSite.docsetId+"&docsetVersion="+e.supportSite.docsetVersion+"&docsetTarget=",t!==ct.PROC_DEF&&t!==ct.SAS_FUNC&&e.supportSite.supportSiteTargetFile?(o+=e.supportSite.supportSiteTargetFile,e.supportSite.supportSiteTargetFragment&&(o+="#"+e.supportSite.supportSiteTargetFragment)):o+=e.supportSite.docsetTargetFile):o=o.replace(/\s/g,"%20"),"["+gt(e.key.toUpperCase())+"]("+o+")"}}const Et=at.ZONE_TYPE;class yt{constructor(e,t){this.model=e,this.syntaxProvider=t,this.loader=t.lexer.syntaxDb,this.czMgr=new at(e,this.loader,t)}getIndentEdit(e,t,n,o,i){return"\n"===n?this._getEnterTriggeredIndentEdit(e-1,o,i):";"===n?this._getSemicolonTriggeredIndentEdit(e,t-1,o,i):[]}_getSemicolonTriggeredIndentEdit(e,t,n,o){const i=Et,s=this.czMgr.getCurrentZone(e,t),r=this.czMgr.getCurrentZone(e,t+1);let a,c=!1;if(r===Et.GBL_STMT||r===Et.COMMENT||void 0===r)switch(s){case i.PROC_STMT:case i.PROC_STMT_OPT:case i.PROC_STMT_OPT_REQ:case i.PROC_STMT_OPT_VALUE:case i.PROC_STMT_SUB_OPT:case i.PROC_STMT_SUB_OPT_VALUE:!a&&(a="proc");case i.DATA_STEP_STMT:case i.DATA_STEP_STMT_OPT:case i.DATA_STEP_STMT_OPT_VALUE:!a&&(a="data"),c=!0}const l=this.syntaxProvider.getFoldingBlock(e,t,!0,!0,!0);switch(a){case"data":if(l?.type!==Je.SEC_TYPE.DATA)return[];break;case"proc":if(l?.type!==Je.SEC_TYPE.PROC)return[]}let u,d=0;const p=this._getLastNotEmptyLine(e-1);if(void 0===p)return[];if(l)if(l?.startLine===e){u=p;const e=this.model.getLine(p),t=this.syntaxProvider.getFoldingBlock(p,e.length-1,!0,!0,!0);t?.startLine===p&&t?.startLine!==t?.endLine&&(d=n)}else u=l.startLine;else u=p;if(!c){let[o,a,h]=this._getPrevValidTokenInfo(e,t-1,!1,!0);if(a&&[qe.TOKEN_TYPES.COMMENT,qe.TOKEN_TYPES.MCOMMENT,qe.TOKEN_TYPES.STR].includes(a)&&this.model.getLine(e).trim().match(/(;|^\s*)(\s|\/\*.*\*\/|\*[^;]*;)*(run|quit|%mend)(\s|\/\*.*\*\/|\*[^;]*;)*;$/i)&&(c=!0),[o,a,h]=this._getPrevValidTokenInfo(e,t-1,!1),o&&["RUN","QUIT","%MEND"].includes(o.toUpperCase())){let t;if(h&&([t]=this._getPrevValidTokenInfo(e,h-1,!1)),!t){const[t]=this._getPrevValidTokenInfo(e-1,void 0);";"!==t&&(c=!0)}}if(c&&(u=p,l?.startLine===p&&(d=n)),!c&&(a===qe.TOKEN_TYPES.MSKEYWORD&&"%MEND"===o?.toUpperCase()&&(c=!0),"%MEND"!==o?.toUpperCase()&&h)){const[t,n]=this._getPrevValidTokenInfo(e,h-1);n!==qe.TOKEN_TYPES.MKEYWORD&&n!==qe.TOKEN_TYPES.MSKEYWORD||"%MEND"!==t?.toUpperCase()||(c=!0)}if(s!==i.GBL_STMT||r!==i.GBL_STMT||a!==qe.TOKEN_TYPES.SKEYWORD&&a!==qe.TOKEN_TYPES.KEYWORD||"RUN"!==o?.toUpperCase()||(c=!0,u=p),!c)return[]}const m=this.model.getLine(u),_=this._getIndentLength(m,n)+d,g=this.model.getLine(e),f=this._getIndentText(g);if(_===this._getIndentLength(g,n))return[];{const t=this._makeIndentText(_,o,n);return[h.TextEdit.replace({start:{line:e,character:0},end:{line:e,character:f.length}},t)]}}_getEnterTriggeredIndentEdit(e,t,n){const o=this._getLastNotEmptyLine(e);if(void 0===o)return[];const i=this.model.getLine(o),s=e<this.model.getLineCount()-1?this.model.getLine(e+1):"",r=this._getIndentText(s),a=this._getIndentLength(i,t),c=this._getIndentIncrementOfNextLine(o,a,t);if(void 0===c)return[];const l=a+c;if(l===this._getIndentLength(s,t))return[];{const o=this._makeIndentText(l,n,t);return[h.TextEdit.replace({start:{line:e+1,character:0},end:{line:e+1,character:r.length}},o)]}}_getIndentIncrementOfNextLine(e,t,n){let o=e,i=!1;for(;o>=0;){const s=this.syntaxProvider.getSyntax(o),r=this._cleanTokens(o,s),a=this.model.getLine(o);let c=r.length-1;for(;c>=0;){const s=r[c],l=this._getTokenText(r,c,a).trim();if(c--,i||";"===l){if(i=!0,s.style===qe.TOKEN_TYPES.SKEYWORD||s.style===qe.TOKEN_TYPES.KEYWORD||s.style===qe.TOKEN_TYPES.MKEYWORD||s.style===qe.TOKEN_TYPES.MSKEYWORD){if(s.style===qe.TOKEN_TYPES.KEYWORD&&/^(submit|interactive|i)$/i.test(l)){const e=this.syntaxProvider.getFoldingBlock(o,c,!0,!0,!0);if(e&&e.type===Je.SEC_TYPE.PROC&&"PROC PYTHON"===this.syntaxProvider.getSymbolName(e))return-t}if("DATA"===l.toUpperCase()||"PROC"===l.toUpperCase()||"%MACRO"===l.toUpperCase())return n-t%n;if("RUN"===l.toUpperCase()||"QUIT"===l.toUpperCase()||"%MEND"===l.toUpperCase())return 0}if(o<e&&";"===l)return 0}}c<0&&o--}return 0}_cleanTokens(e,t){const n=this.model.getLine(e),o=[];for(let e=0;e<t.length;e++){const i=t[e],s=this._getTokenText(t,e,n);this._isCommentOrBlankToken(i,s)||o.push(i)}return o}_getLastNotEmptyLine(e){let t,n="";for(let o=e;o>=0;o--)if(n=this.model.getLine(o),!this._isEmptyLine(n)){t=o;break}return t}_makeIndentText(e,t,n){let o;if(t)o=" ".repeat(e);else{const t=Math.floor(e/n);o="\t".repeat(t),o+=" ".repeat(e%n)}return o}_getIndentText(e){let t=0;for(;t<e.length&&(" "===e[t]||"\t"===e[t]);)t++;return e.substring(0,t)}_getIndentLength(e,t){let n=0;for(let o=0;o<e.length;o++)if(" "===e[o])n++;else{if("\t"!==e[o])break;n+=t-n%t}return n}_isEmptyLine(e){return!/\S/.test(e)}_getTokenText(e,t,n){if(t<0||t>=e.length)return"";const o=e[t];let i;return i=t===e.length-1?n.substring(o.start):n.substring(o.start,e[t+1].start),i}_getPrevValidTokenInfo(e,t,n=!0,o=!1){let i=e;for(;i>=0;){const s=this.syntaxProvider.getSyntax(i),r=this.model.getLine(i);for(let n=s.length-1;n>=0;n--){const a=s[n],c=this._getTokenText(s,n,r);if(a.start<=(i<e||!t?r.length:t)){if(!this._isCommentOrBlankToken(a,c))return[c,a.style,a.start];if(o&&(a.style===qe.TOKEN_TYPES.COMMENT||a.style===qe.TOKEN_TYPES.MCOMMENT))return[void 0,a.style,void 0]}}if(!n)return[];i--}return[]}_isCommentOrBlankToken(e,t){const n=qe.TOKEN_TYPES;return e.style===n.COMMENT||e.style===n.MCOMMENT||this._isEmptyLine(t)}}class Ot{constructor(e){this.doc=e}getLine(e){return this.doc.getText({start:{line:e,character:0},end:{line:e+1,character:0}})}getLineCount(){return this.doc.lineCount}getText(e){return this.doc.getText({start:{line:e.start.line,character:e.start.column},end:{line:e.end.line,character:e.end.column}})}getColumnCount(e){return this.doc.offsetAt({line:e+1,character:0})-this.doc.offsetAt({line:e,character:0})}}class Pt{constructor(e){this.model=e,this.parsingQueue=[],this.parsingState=2,this.syntaxTable=[],this.lastToken=null,this.currTokenIndex=0,this.parsedRange={},this.tailUnchangedSyntaxTable=[],this.removedSyntaxTable=[],this._multilineComments=[],this.blockComment={start:"/*",end:"*/"},this.lexer=new Je(e)}_push(e){this.parsingQueue.push(e)}_startParse(e){let t=0;this.currTokenIndex=0,this.lastToken=null,this._multilineComments=[],this.parsingState=1,this.parsedRange=this.lexer.start(e),t=this.parsedRange.endLine+1,this.tailUnchangedSyntaxTable=this.syntaxTable.splice(t,this.syntaxTable.length-t),this.removedSyntaxTable=this.syntaxTable.splice(this.parsedRange.startLine,t-this.parsedRange.startLine);const n=[];let o=0;const i=this.removedSyntaxTable[0];if(this.parsedRange.startCol>0&&i){for(;i[o]&&i[o].start<this.parsedRange.startCol;)n.push(i[o]),o++;i.splice(0,o);let e=this.parsedRange.startCol;i.length&&(e=i[0].start);const t=n[n.length-1];this.lastToken={start:{line:this.parsedRange.startLine,column:t.start},end:{line:this.parsedRange.startLine,column:e},type:t.style},this.currTokenIndex=n.length,this.syntaxTable[this.parsedRange.startLine]=n}if(o=0,this.parsedRange.startLine===this.parsedRange.endLine&&i){for(;i[o]&&i[o].start<this.parsedRange.endCol;)o++;i.splice(0,o)}this._parse(e)}_endParse(e){this.parsingState=2,this._schedule()}_schedule(){if(2===this.parsingState&&this.parsingQueue.length){const e=this.parsingQueue.shift();this._startParse(e)}}_parse(e){let t=null;try{for(;;)if(t=this.lexer.getNext(),this._addItem(t),!t||this.lexer.end()){this._endParse(e);break}}catch(n){if(!n||void 0===n.changedLineCount)throw n;{this.lastToken?t=this.lastToken:0===this.syntaxTable.length&&(t={type:"text",start:{line:0,column:0},end:{line:0,column:0}});let o,i=0;const s=this.removedSyntaxTable.length,r=n.token.start.line;s>=1&&r===this.parsedRange.endLine+n.changedLineCount&&(o=this.removedSyntaxTable[s-1],o.forEach(function(e){e.start+=n.changedColCount,e.start<n.token.start.column&&i++}),o.splice(0,i),this.syntaxTable[r]&&(this._tryToAddBlank(r,this.syntaxTable[r],o),this.syntaxTable[r]=this.syntaxTable[r].concat(o))),this.syntaxTable=this.syntaxTable.concat(this.tailUnchangedSyntaxTable),this._endParse(e)}}}_tryToAddBlank(e,t,n){if(t.length){const o=t[t.length-1];if(n.length){const i=this.model.getLine(e).substring(o.start,n[0].start),s=/\s+$/.exec(i);s&&t.push({start:o.start+i.length-s[0].length,state:null,style:"text"})}}}_addEndMarkForSkippedLines(e,t){let n=0,o=0,i=null;if(e.end.line!==t){n=e.end.line,o=e.end.column;do{i=this.syntaxTable[n]=this.syntaxTable[n]||[],this.currTokenIndex<i.length&&i.splice(this.currTokenIndex,i.length-this.currTokenIndex),i.push({start:o,state:0,style:"text"}),n++,o=0}while(n<t);this.currTokenIndex=0,this.lastToken=null}}_addItem(e){let t=0,n=null,o=!1,i=!0;if(this.lastToken&&this._addEndMarkForSkippedLines(this.lastToken,e?e.start.line:this.model.getLineCount()),e){t=e.start.line,(null===this.lastToken&&e.start.column>0||this.lastToken&&this.lastToken.end.column!==e.start.column&&this.lastToken.end.line===e.start.line)&&(n=this.syntaxTable[t]=this.syntaxTable[t]||[],this.currTokenIndex<n.length&&n.splice(this.currTokenIndex,n.length-this.currTokenIndex),n.push({start:this.lastToken?this.lastToken.end.column:0,state:null,style:"text"}),this.currTokenIndex++),e.end.line!==e.start.line&&(o=!0);do{n=this.syntaxTable[t]=this.syntaxTable[t]||[],this.currTokenIndex<n.length&&n.splice(this.currTokenIndex,n.length-this.currTokenIndex),n.push({start:t===e.start.line?e.start.column:0,state:i?o?{line:e.end.line,col:e.end.column}:1:null,style:e.type}),this.currTokenIndex++,o=!1,i=!1,t<e.end.line&&(n.push({start:this.model.getLine(t).length,state:0,style:"text"}),this.currTokenIndex=0),t++}while(t<=e.end.line);this.lastToken={type:e.type,start:{line:e.start.line,column:e.start.column},end:{line:e.end.line,column:e.end.column}},this._tokenCallback&&this._tokenCallback({text:this.model.getText(e),type:e.type,start:{line:e.start.line,column:e.start.column},end:{line:e.end.line,column:e.end.column}}),("comment"===e.type||"macro-comment"===e.type)&&e.end.line>e.start.line&&this._multilineComments.push({startLine:e.start.line,endLine:e.end.line})}}getSyntax(e){return this.syntaxTable[e]?this.syntaxTable[e]:[]}getParseRange(e){return this.lexer.getParseRange(e)}getFoldingBlock(e,t,n,o,i){return this.lexer.getFoldingBlock(e,t,n,o,i)}add(e){this._push(e),this._schedule()}type(e,t){const n=this.getSyntax(e),o=n.length;for(let e=1;e<o;e++)if(n[e].start>=t)return n[e-1].start<=t?n[e-1].style:"text";return n&&2===n.length&&0===n[0].start&&0===n[1].state?n[0].style:"text"}setTokenCallback(e){this._tokenCallback=e}getSymbolName(e){const t=e.startLine,n=this.getSyntax(t);for(let o=2;o<n.length;o++){const i=n[o];if(!(i.start<=e.startCol||"proc-name"!==i.style&&"text"!==i.style)){const s=o===n.length-1?this.model.getColumnCount(t):n[o+1].start,r=this.model.getText({start:{line:t,column:i.start},end:{line:t,column:s}});if(""===r.trim())continue;return`${e.name} ${"proc-name"===i.style?r.toUpperCase():r}`}}return e.name}getMultilineComments(){return this._multilineComments}}class Ct{constructor(e,t){this.model=e,this.syntaxProvider=t}format(){return console.warn("Formatting not implemented in browser version"),[]}}const Rt={tokenTypes:["sep","keyword","sec-keyword","proc-name","comment","macro-keyword","macro-comment","macro-ref","macro-sec-keyword","cards-data","string","date","time","dt","bitmask","namelit","hex","numeric","format"],tokenModifiers:[]};function kt(e){return Rt.tokenTypes.indexOf(e)}const Dt=[h.SymbolKind.Struct,h.SymbolKind.Function,h.SymbolKind.Module,h.SymbolKind.Module,h.SymbolKind.Module];class Nt{constructor(e){this.model=new Ot(e),this.syntaxProvider=new Pt(this.model),this.completionProvider=new St(this.model,this.syntaxProvider),this.formatOnTypeProvider=new yt(this.model,this.syntaxProvider),this.formatter=new Ct(this.model,this.syntaxProvider);const t=this.model.getLineCount();this.syntaxProvider.add({text:"",removedText:"",oldRange:{start:{line:0,column:0},end:{line:0,column:0}},newRange:{start:{line:0,column:0},end:{line:t-1,column:this.model.getColumnCount(t-1)}}})}getCodeZoneManager(){return this.completionProvider.getCodeZoneManager()}getTokens(){const e=this.model.getLineCount(),t=[];let n=0,o=0;for(let i=0;i<e;i++){const e=this.model.getLine(i),s=this.syntaxProvider.getSyntax(i);for(let r=0;r<s.length;r++){const a=kt(s[r].style),c=r===s.length-1?e.length:s[r+1].start;a<0||(t.push(i-n,n===i?s[r].start-o:s[r].start,c-s[r].start,a,0),n=i,o=s[r].start)}}return t}getDocumentSymbols(){const e=this.model.getLineCount(),t=[];for(let n=0;n<e;n++){const e=this.syntaxProvider.getFoldingBlock(n,void 0,!1,!1,!0);if(e&&e.startLine===n){const o=this._buildDocumentSymbol(e);o.name&&t.push(o),n=e.endFoldingLine;continue}}return t}_buildDocumentSymbol(e,t){const n={start:{line:e.startLine,character:e.startCol},end:{line:e.endFoldingLine,character:e.endFoldingCol}},o={name:this.syntaxProvider.getSymbolName(e),kind:Dt[e.type],range:n,selectionRange:n,children:[]};t&&o.name&&t.children.push(o);for(const t of e.innerBlocks)this._buildDocumentSymbol(t,o);return o}getFoldingRanges(){const e=this.model.getLineCount(),t=[];this.addCommentFolding(t);for(let n=0;n<e;n++){const e=this.syntaxProvider.getFoldingBlock(n,void 0,!1,!1,!0);if(e&&e.startLine===n){const o=this._flattenFoldingBlockTree(e);for(const e of o)t.push({startLine:e.startLine,endLine:e.endFoldingLine,kind:e.type===Je.SEC_TYPE.CUSTOM?"region":void 0});n=e.endFoldingLine;continue}}return t}addCommentFolding(e){const t=this.syntaxProvider.getMultilineComments();for(const n of t)e.push({startLine:n.startLine,endLine:n.endLine,kind:"comment"})}_flattenFoldingBlockTree(e){const t=[e],n=[];for(;t.length>0;){const e=t.pop();n.push(e);for(let n=e.innerBlocks.length-1;n>=0;n--){const o=e.innerBlocks[n];t.push(o)}}return n}getFoldingBlock(e,t,n,o,i){return this.syntaxProvider.getFoldingBlock(e,t,n,o,i)}toggleLineComment(e){const t=this.syntaxProvider.getSyntax(e.start.line)[0];if("embedded-code"===t?.style)return null;const n=this.model.getText({start:{line:e.start.line,column:0},end:{line:e.end.line,column:e.end.character}}).split(/\n|\r\n/);return n.some(e=>""!==e.trim()&&!/^\s*\/\*.*\*\/\s*$/.test(e))?n.map(e=>""!==e.trim()?`/* ${e} */`:e).join("\n"):n.map(e=>e.replace(/^(\s*)\/\* ?| ?\*\/(\s*)$/g,"$1")).join("\n")}setLibService(e){return this.syntaxProvider.lexer.syntaxDb.setLibService(e)}}const bt=new i.BrowserMessageReader(self),At=new i.BrowserMessageWriter(self);!function(e){const t={};function n(e){const n=t[e];if(!n)throw new Error(`Document not found: ${e}`);return n.service&&!n.changed||(n.service=new Nt(n.document),n.changed=!1),n.service}e.onInitialize(()=>({capabilities:{textDocumentSync:i.TextDocumentSyncKind.Incremental,semanticTokensProvider:{legend:Rt,full:!0},documentFormattingProvider:!0,foldingRangeProvider:!0,documentSymbolProvider:!0,hoverProvider:!0,completionProvider:{triggerCharacters:["."," ","("],resolveProvider:!1}}})),e.onDidOpenTextDocument(e=>{const n=o.create(e.textDocument.uri,e.textDocument.languageId,e.textDocument.version,e.textDocument.text);t[e.textDocument.uri]={document:n,changed:!0,service:void 0}}),e.onDidChangeTextDocument(e=>{const n=t[e.textDocument.uri];n&&(o.update(n.document,e.contentChanges,e.textDocument.version),n.changed=!0)}),e.onDidCloseTextDocument(e=>{delete t[e.textDocument.uri]}),e.languages.semanticTokens.on(e=>{try{return{data:n(e.textDocument.uri).getTokens()}}catch(e){return console.error("Error getting semantic tokens:",e),{data:[]}}}),e.onCompletion(async e=>{try{const t=n(e.textDocument.uri);return await t.completionProvider.getCompleteItems(e)}catch(e){return console.error("Error getting completions:",e),{isIncomplete:!1,items:[]}}}),e.onHover(async e=>{try{const t=n(e.textDocument.uri);return await t.completionProvider.getHelp(e.position)}catch(e){return console.error("Error getting hover:",e),null}}),e.onDocumentFormatting(e=>{try{return n(e.textDocument.uri).formatter.format()}catch(e){return console.error("Error formatting document:",e),[]}}),e.onFoldingRanges(e=>{try{return n(e.textDocument.uri).getFoldingRanges()}catch(e){return console.error("Error getting folding ranges:",e),[]}}),e.onDocumentSymbol(e=>{try{return n(e.textDocument.uri).getDocumentSymbols()}catch(e){return console.error("Error getting document symbols:",e),[]}}),e.listen()}((0,i.createConnection)(bt,At)),console.log("SAS Language Server running in WebWorker");